<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<title>pyWeb Literate Programming 3.1</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
<style type="text/css">

/* Page layout tweaks */
div.document { width: 7in; }
.small { font-size: smaller; }
.code
{
	color: #101080;
	display: block;
	border-color: black;
	border-width: thin;
	border-style: solid;
	background-color: #E0FFFF;
	/*#99FFFF*/
	padding: 0 0 0 1%;
	margin: 0 6% 0 6%;
	text-align: left;
	font-size: smaller;
}

</style>
</head>
<body>
<div class="document" id="pyweb-literate-programming-3-1">
<h1 class="title">pyWeb Literate Programming 3.1</h1>
<h2 class="subtitle" id="yet-another-literate-programming-tool">Yet Another Literate Programming Tool</h2>

<!-- This data file has been placed in the public domain. -->
<!-- Derived from the Unicode character mappings available from
<http://www.w3.org/2003/entities/xml/>.
Processed by unicode2rstsubs.py, part of Docutils:
<http://docutils.sourceforge.net>. -->
<!-- This data file has been placed in the public domain. -->
<!-- Derived from the Unicode character mappings available from
<http://www.w3.org/2003/entities/xml/>.
Processed by unicode2rstsubs.py, part of Docutils:
<http://docutils.sourceforge.net>. -->
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="toc-entry-1">Introduction</a><ul>
<li><a class="reference internal" href="#background" id="toc-entry-2">Background</a></li>
<li><a class="reference internal" href="#other-tools" id="toc-entry-3">Other Tools</a></li>
<li><a class="reference internal" href="#py-web-tool" id="toc-entry-4"><strong>py-web-tool</strong></a></li>
<li><a class="reference internal" href="#use-cases" id="toc-entry-5">Use Cases</a><ul>
<li><a class="reference internal" href="#tangle-source-files" id="toc-entry-6">Tangle Source Files</a></li>
<li><a class="reference internal" href="#weave-documentation" id="toc-entry-7">Weave Documentation</a></li>
<li><a class="reference internal" href="#tangle-test-and-weave-with-test-results" id="toc-entry-8">Tangle, Test, and Weave with Test Results</a></li>
</ul>
</li>
<li><a class="reference internal" href="#writing-py-web-tool-w-files" id="toc-entry-9">Writing <strong>py-web-tool</strong> <tt class="docutils literal">.w</tt> Files</a><ul>
<li><a class="reference internal" href="#structural-tags" id="toc-entry-10">Structural Tags</a></li>
<li><a class="reference internal" href="#inline-tags" id="toc-entry-11">Inline Tags</a></li>
<li><a class="reference internal" href="#content-tags" id="toc-entry-12">Content Tags</a></li>
<li><a class="reference internal" href="#additional-features" id="toc-entry-13">Additional Features</a></li>
<li><a class="reference internal" href="#controlling-indentation" id="toc-entry-14">Controlling Indentation</a></li>
<li><a class="reference internal" href="#tracking-source-line-numbers" id="toc-entry-15">Tracking Source Line Numbers</a></li>
<li><a class="reference internal" href="#expression-context" id="toc-entry-16">Expression Context</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-py-web-tool-to-tangle-and-weave" id="toc-entry-17">Running <strong>py-web-tool</strong> to Tangle and Weave</a><ul>
<li><a class="reference internal" href="#command-line-options" id="toc-entry-18">Command Line Options</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bootstrapping" id="toc-entry-19">Bootstrapping</a></li>
<li><a class="reference internal" href="#dependencies" id="toc-entry-20">Dependencies</a></li>
<li><a class="reference internal" href="#acknowledgements" id="toc-entry-21">Acknowledgements</a></li>
</ul>
</li>
<li><a class="reference internal" href="#architecture-and-design-overview" id="toc-entry-22">Architecture and Design Overview</a><ul>
<li><a class="reference internal" href="#representation" id="toc-entry-23">Representation</a></li>
<li><a class="reference internal" href="#reading-and-parsing" id="toc-entry-24">Reading and Parsing</a></li>
<li><a class="reference internal" href="#weaving" id="toc-entry-25">Weaving</a></li>
<li><a class="reference internal" href="#tangling" id="toc-entry-26">Tangling</a></li>
<li><a class="reference internal" href="#application" id="toc-entry-27">Application</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation" id="toc-entry-28">Implementation</a><ul>
<li><a class="reference internal" href="#base-class-definitions" id="toc-entry-29">Base Class Definitions</a></li>
<li><a class="reference internal" href="#emitters" id="toc-entry-30">Emitters</a><ul>
<li><a class="reference internal" href="#emitter-superclass" id="toc-entry-31">Emitter Superclass</a></li>
<li><a class="reference internal" href="#weaver-subclass-of-emitter" id="toc-entry-32">Weaver subclass of Emitter</a></li>
<li><a class="reference internal" href="#rst-subclass-of-weaver" id="toc-entry-33">RST subclass of Weaver</a></li>
<li><a class="reference internal" href="#latex-subclass-of-weaver" id="toc-entry-34">LaTeX subclass of Weaver</a></li>
<li><a class="reference internal" href="#html-subclasses-of-weaver" id="toc-entry-35">HTML subclasses of Weaver</a></li>
<li><a class="reference internal" href="#tangler-subclass-of-emitter" id="toc-entry-36">Tangler subclass of Emitter</a></li>
<li><a class="reference internal" href="#tanglermake-subclass-of-tangler" id="toc-entry-37">TanglerMake subclass of Tangler</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chunks" id="toc-entry-38">Chunks</a><ul>
<li><a class="reference internal" href="#chunk-superclass" id="toc-entry-39">Chunk Superclass</a></li>
<li><a class="reference internal" href="#namedchunk-class" id="toc-entry-40">NamedChunk class</a></li>
<li><a class="reference internal" href="#outputchunk-class" id="toc-entry-41">OutputChunk class</a></li>
<li><a class="reference internal" href="#nameddocumentchunk-class" id="toc-entry-42">NamedDocumentChunk class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#commands" id="toc-entry-43">Commands</a><ul>
<li><a class="reference internal" href="#command-superclass" id="toc-entry-44">Command Superclass</a></li>
<li><a class="reference internal" href="#textcommand-class" id="toc-entry-45">TextCommand class</a></li>
<li><a class="reference internal" href="#codecommand-class" id="toc-entry-46">CodeCommand class</a></li>
<li><a class="reference internal" href="#xrefcommand-superclass" id="toc-entry-47">XrefCommand superclass</a></li>
<li><a class="reference internal" href="#filexrefcommand-class" id="toc-entry-48">FileXrefCommand class</a></li>
<li><a class="reference internal" href="#macroxrefcommand-class" id="toc-entry-49">MacroXrefCommand class</a></li>
<li><a class="reference internal" href="#useridxrefcommand-class" id="toc-entry-50">UserIdXrefCommand class</a></li>
<li><a class="reference internal" href="#referencecommand-class" id="toc-entry-51">ReferenceCommand class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reference-strategy" id="toc-entry-52">Reference Strategy</a><ul>
<li><a class="reference internal" href="#reference-superclass" id="toc-entry-53">Reference Superclass</a></li>
<li><a class="reference internal" href="#simplereference-class" id="toc-entry-54">SimpleReference Class</a></li>
<li><a class="reference internal" href="#transitivereference-class" id="toc-entry-55">TransitiveReference Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#error-class" id="toc-entry-56">Error class</a></li>
<li><a class="reference internal" href="#the-web-and-webreader-classes" id="toc-entry-57">The Web and WebReader Classes</a><ul>
<li><a class="reference internal" href="#web-construction" id="toc-entry-58">Web Construction</a></li>
<li><a class="reference internal" href="#web-chunk-name-resolution" id="toc-entry-59">Web Chunk Name Resolution</a></li>
<li><a class="reference internal" href="#web-cross-reference-support" id="toc-entry-60">Web Cross-Reference Support</a></li>
<li><a class="reference internal" href="#loop-detection" id="toc-entry-61">Loop Detection</a></li>
<li><a class="reference internal" href="#tangle-and-weave-support" id="toc-entry-62">Tangle and Weave Support</a></li>
<li><a class="reference internal" href="#the-webreader-class" id="toc-entry-63">The WebReader Class</a></li>
<li><a class="reference internal" href="#the-tokenizer-class" id="toc-entry-64">The Tokenizer Class</a></li>
<li><a class="reference internal" href="#the-option-parser-class" id="toc-entry-65">The Option Parser Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#action-class-hierarchy" id="toc-entry-66">Action Class Hierarchy</a><ul>
<li><a class="reference internal" href="#action-class" id="toc-entry-67">Action Class</a></li>
<li><a class="reference internal" href="#actionsequence-class" id="toc-entry-68">ActionSequence Class</a></li>
<li><a class="reference internal" href="#weaveaction-class" id="toc-entry-69">WeaveAction Class</a></li>
<li><a class="reference internal" href="#tangleaction-class" id="toc-entry-70">TangleAction Class</a></li>
<li><a class="reference internal" href="#loadaction-class" id="toc-entry-71">LoadAction Class</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pyweb-module-file" id="toc-entry-72"><strong>pyWeb</strong> Module File</a><ul>
<li><a class="reference internal" href="#python-library-imports" id="toc-entry-73">Python Library Imports</a></li>
<li><a class="reference internal" href="#overheads" id="toc-entry-74">Overheads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-application-class" id="toc-entry-75">The Application Class</a></li>
<li><a class="reference internal" href="#logging-setup" id="toc-entry-76">Logging Setup</a></li>
<li><a class="reference internal" href="#the-main-function" id="toc-entry-77">The Main Function</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unit-tests" id="toc-entry-78">Unit Tests</a></li>
<li><a class="reference internal" href="#additional-files" id="toc-entry-79">Additional Files</a><ul>
<li><a class="reference internal" href="#tangle-py-script" id="toc-entry-80"><tt class="docutils literal">tangle.py</tt> Script</a></li>
<li><a class="reference internal" href="#weave-py-script" id="toc-entry-81"><tt class="docutils literal">weave.py</tt> Script</a></li>
<li><a class="reference internal" href="#the-setup-py-requirements-dev-txt-and-manifest-in-files" id="toc-entry-82">The <tt class="docutils literal">setup.py</tt>, <tt class="docutils literal"><span class="pre">requirements-dev.txt</span></tt> and <tt class="docutils literal">MANIFEST.in</tt> files</a></li>
<li><a class="reference internal" href="#the-readme-file" id="toc-entry-83">The <tt class="docutils literal">README</tt> file</a></li>
<li><a class="reference internal" href="#the-html-support-files" id="toc-entry-84">The HTML Support Files</a></li>
<li><a class="reference internal" href="#tox-and-makefile" id="toc-entry-85">Tox and Makefile</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jedit-configuration" id="toc-entry-86">JEdit Configuration</a></li>
<li><a class="reference internal" href="#python-3-10-migration" id="toc-entry-87">Python 3.10 Migration</a></li>
<li><a class="reference internal" href="#to-do" id="toc-entry-88">To Do</a><ul>
<li><a class="reference internal" href="#other-thoughts" id="toc-entry-89">Other Thoughts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#change-log" id="toc-entry-90">Change Log</a></li>
<li><a class="reference internal" href="#indices" id="toc-entry-91">Indices</a><ul>
<li><a class="reference internal" href="#files" id="toc-entry-92">Files</a></li>
<li><a class="reference internal" href="#macros" id="toc-entry-93">Macros</a></li>
<li><a class="reference internal" href="#user-identifiers" id="toc-entry-94">User Identifiers</a></li>
</ul>
</li>
</ul>
</div>
<!-- pyweb/intro.w -->
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#toc-entry-1">Introduction</a></h1>
<p>Literate programming was pioneered by Knuth as a method for
developing readable, understandable presentations of programs.
These would present a program in a literate fashion for people
to read and understand; this would be in parallel with presentation as source text
for a compiler to process and both would be generated from a common source file.</p>
<p>One intent is to synchronize the program source with the
documentation about that source.  If the program and the documentation
have a common origin, then the traditional gaps between intent
(expressed in the documentation) and action (expressed in the
working program) are significantly reduced.</p>
<p><strong>py-web-tool</strong> is a literate programming tool that combines the actions
of <em>weaving</em> a document with <em>tangling</em> source files.
It is independent of any source language.
While is designed to work with RST document markup, it should be amenable to any other
flavor of markup.
It uses a small set of markup tags to define chunks of code and
documentation.</p>
<div class="section" id="background">
<h2><a class="toc-backref" href="#toc-entry-2">Background</a></h2>
<p>The following is an almost verbatim quote from Briggs' <em>nuweb</em> documentation,
and provides an apt summary of Literate Programming.</p>
<blockquote>
<p>In 1984, Knuth introduced the idea of <em>literate programming</em> and
described a pair of tools to support the practise (Donald E. Knuth,
&quot;Literate Programming&quot;, <em>The Computer Journal</em> 27 (1984), no. 2, 97-111.)
His approach was to combine Pascal code with T<sub>e</sub>X documentation to
produce a new language, <tt class="docutils literal">WEB</tt>, that offered programmers a superior
approach to programming. He wrote several programs in <tt class="docutils literal">WEB</tt>,
including <tt class="docutils literal">weave</tt> and <tt class="docutils literal">tangle</tt>, the programs used to support
literate programming.
The idea was that a programmer wrote one document, the web file, that
combined documentation written in T<sub>e</sub>X (Donald E. Knuth,
T<sub>e</sub>X book, Computers and Typesetting, 1986) with code (written in Pascal).</p>
<p>Running <tt class="docutils literal">tangle</tt> on the web file would produce a complete
Pascal program, ready for compilation by an ordinary Pascal compiler.
The primary function of <tt class="docutils literal">tangle</tt> is to allow the programmer to
present elements of the program in any desired order, regardless of
the restrictions imposed by the programming language. Thus, the
programmer is free to present his program in a top-down fashion,
bottom-up fashion, or whatever seems best in terms of promoting
understanding and maintenance.</p>
<p>Running <tt class="docutils literal">weave</tt> on the web file would produce a  T<sub>e</sub>X file, ready
to be processed by  T<sub>e</sub>X. The resulting document included a variety of
automatically generated indices and cross-references that made it much
easier to navigate the code. Additionally, all of the code sections
were automatically prettyprinted, resulting in a quite impressive
document.</p>
<p>Knuth also wrote the programs for T<sub>e</sub>X and <tt class="docutils literal">METAFONT</tt>
entirely in <tt class="docutils literal">WEB</tt>, eventually publishing them in book
form. These are probably the
largest programs ever published in a readable form.</p>
</blockquote>
</div>
<div class="section" id="other-tools">
<h2><a class="toc-backref" href="#toc-entry-3">Other Tools</a></h2>
<p>Numerous tools have been developed based on Knuth's initial
work.  A relatively complete survey is available at sites
like <a class="reference external" href="http://www.literateprogramming.com">Literate Programming</a>,
and the OASIS
<a class="reference external" href="http://www.oasis-open.org/cover/xmlLitProg.html">XML Cover Pages: Literate Programming with SGML and XML</a>.</p>
<p>The immediate predecessors to this <strong>py-web-tool</strong> tool are
<a class="reference external" href="http://www.ross.net/funnelweb">FunnelWeb</a>,
<a class="reference external" href="http://www.eecs.harvard.edu/~nr/noweb/">noweb</a> and
<a class="reference external" href="http://sourceforge.net/projects/nuweb/">nuweb</a>.  The ideas lifted from these other
tools created the foundation for <strong>py-web-tool</strong>.</p>
<p>There are several Python-oriented literate programming tools.
These include
<a class="reference external" href="http://personalpages.tds.net/~edream/front.html&quot;">LEO</a>,
<a class="reference external" href="http://interscript.sourceforge.net/">interscript</a>,
<a class="reference external" href="http://www.danbala.com/python/lpy/">lpy</a>,
<a class="reference external" href="http://www.egenix.com/files/python/SoftwareDescriptions.html#py2html.py">py2html</a>,
<a class="reference external" href="https://github.com/slott56/PyLit-3">PyLit-3</a></p>
<p>The <em>FunnelWeb</em> tool is independent of any programming language
and only mildly dependent on T<sub>e</sub>X.
It has 19 commands, many of which duplicate features of HTML or
L<sub>a</sub>T<sub>e</sub>X.</p>
<p>The <em>noweb</em> tool was written by Norman Ramsey.
This tool uses a sophisticated multi-processing framework, via Unix
pipes, to permit flexible manipulation of the source file to tangle
and weave the programming language and documentation markup files.</p>
<p>The <em>nuweb</em> Simple Literate Programming Tool was developed by
Preston Briggs (<a class="reference external" href="mailto:preston&#64;tera.com">preston&#64;tera.com</a>).  His work was supported by ARPA,
through ONR grant N00014-91-J-1989.  It is written
in C, and very focused on producing L<sub>a</sub>T<sub>e</sub>X documents.  It can
produce HTML, but this is clearly added after the fact.  It cannot be
easily extended, and is not object-oriented.</p>
<p>The <em>LEO</em> tool is a structured GUI editor for creating
source.  It uses XML and <em>noweb</em>-style chunk management.  It is more
than a simple weave and tangle tool.</p>
<p>The <em>interscript</em> tool is very large and sophisticated, but doesn't gracefully
tolerate HTML markup in the document.  It can create a variety of
markup languages from the interscript source, making it suitable for
creating HTML as well as L<sub>a</sub>T<sub>e</sub>X.</p>
<p>The <em>lpy</em> tool can produce very complex HTML representations of
a Python program.  It works by locating documentation markup embedded
in Python comments and docstrings.  This is called &quot;inverted literate
programming&quot;.</p>
<p>The <em>py2html</em> tool does very sophisticated syntax coloring.</p>
<p>The <em>PyLit-3</em> tool is perhaps the very best approach to Literate
programming, since it leverages an existing lightweight markup language
and it's output formatting. However, it's limited in the presentation order,
making it difficult to present a complex Python module out of the proper
Python required presentation.</p>
</div>
<div class="section" id="py-web-tool">
<h2><a class="toc-backref" href="#toc-entry-4"><strong>py-web-tool</strong></a></h2>
<p><strong>py-web-tool</strong> works with any
programming language. It can work with any markup language, but is currently
configured to work with RST.  This philosophy
comes from <em>FunnelWeb</em>
<em>noweb</em>, <em>nuweb</em> and <em>interscript</em>.  The primary differences
between <strong>py-web-tool</strong> and other tools are the following.</p>
<ul class="simple">
<li><strong>py-web-tool</strong> is object-oriented, permitting easy extension.
<em>noweb</em> extensions
are separate processes that communicate through a sophisticated protocol.
<em>nuweb</em> is not easily extended without rewriting and recompiling
the C programs.</li>
<li><strong>py-web-tool</strong> is built in the very portable Python programming
language.  This allows it to run anywhere that Python 3.3 runs, with
only the addition of docutils.  This makes it a useful
tool for programmers in any language.</li>
<li><strong>py-web-tool</strong> is much simpler than <em>FunnelWeb</em>, <em>LEO</em> or <em>Interscript</em>.  It has
a very limited selection of commands, but can still produce
complex programs and HTML documents.</li>
<li><strong>py-web-tool</strong> does not invent a complex markup language like <em>Interscript</em>.
Because <em>Iterscript</em> has its own markup, it can generate L<sub>a</sub>T<sub>e</sub>X or HTML or other
output formats from a unique input format.  While powerful, it seems simpler to
avoid inventing yet another sophisticated markup language.  The language <strong>py-web-tool</strong>
uses is very simple, and the author's use their preferred markup language almost
exclusively.</li>
<li><strong>py-web-tool</strong> supports the forward literate programming philosophy,
where a source document creates programming language and markup language.
The alternative, deriving the document from markup embedded in
program comments (&quot;inverted literate programming&quot;), seems less appealing.
The disadvantage of inverted literate programming is that the final document
can't reflect the original author's preferred order of exposition,
since that informtion generally isn't part of the source code.</li>
<li><strong>py-web-tool</strong> also specifically rejects some features of <em>nuweb</em>
and <em>FunnelWeb</em>.  These include the macro capability with parameter
substitution, and multiple references to a chunk.  These two capabilities
can be used to grow object-like applications from non-object programming
languages (<em>e.g.</em> C or Pascal).  Since most modern languages (Python,
Java, C++) are object-oriented, this macro capability is more of a problem
than a help.</li>
<li>Since <strong>py-web-tool</strong> is built in the Python interpreter, a source document
can include Python expressions that are evaluated during weave operation to
produce time stamps, source file descriptions or other information in the woven
or tangled output.</li>
</ul>
<p><strong>py-web-tool</strong> works with any programming language; it can work with any markup language.
The initial release supports RST via simple templates.</p>
<p>The following is extensively quoted from Briggs' <em>nuweb</em> documentation,
and provides an excellent background in the advantages of the very
simple approach started by <em>nuweb</em> and adopted by <strong>py-web-tool</strong>.</p>
<blockquote>
<p>The need to support arbitrary
programming languages has many consequences:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">No prettyprinting:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">Both <tt class="docutils literal">WEB</tt> and <tt class="docutils literal">CWEB</tt> are able to
prettyprint the code sections of their documents because they
understand the language well enough to parse it. Since we want to use
<em>any</em> language, we've got to abandon this feature.
However, we do allow particular individual formulas or fragments
of L<sub>a</sub>T<sub>e</sub>X
or HTML code to be formatted and still be part of the output files.</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Limited index of identifiers:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">Because <tt class="docutils literal">WEB</tt> knows about Pascal,
it is able to construct an index of all the identifiers occurring in
the code sections (filtering out keywords and the standard type
identifiers). Unfortunately, this isn't as easy in our case. We don't
know what an identifier looks like in each language and we certainly
don't know all the keywords.  We provide a mechanism to mark
identifiers, and we use a pretty standard pattern for recognizing
identifiers almost most programming languages.</td>
</tr>
</tbody>
</table>
<p>Of course, we've got to have some compensation for our losses or the
whole idea would be a waste. Here are the advantages I [Briggs] can see:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Simplicity:</th><td class="field-body">The majority of the commands in <tt class="docutils literal">WEB</tt> are concerned with control of the
automatic prettyprinting. Since we don't prettyprint, many commands are
eliminated. A further set of commands is subsumed by L<sub>a</sub>T<sub>e</sub>X
and may also be eliminated. As a result, our set of commands is reduced to
only about seven members (explained in the next section).
This simplicity is also reflected in the size of this tool,
which is quite a bit smaller than the tools used with other approaches.</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">No prettyprinting:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">Everyone disagrees about how their code should look, so automatic
formatting annoys many people. One approach is to provide ways to
control the formatting. Our approach is simpler -- we perform no
automatic formatting and therefore allow the programmer complete
control of code layout.</td>
</tr>
<tr class="field"><th class="field-name">Control:</th><td class="field-body">We also offer the programmer reasonably complete control of the
layout of his output files (the files generated during tangling).
Of course, this is essential for languages that are sensitive to layout;
but it is also important in many practical situations, <em>e.g.</em>, debugging.</td>
</tr>
<tr class="field"><th class="field-name">Speed:</th><td class="field-body">Since [<strong>py-web-tool</strong>] doesn't do too much, it runs very quickly.
It combines the functions of <tt class="docutils literal">tangle</tt> and <tt class="docutils literal">weave</tt> into a single
program that performs both functions at once.</td>
</tr>
<tr class="field"><th class="field-name">Chunk numbers:</th><td class="field-body">Inspired by the example of <strong>noweb</strong>, [<strong>py-web-tool</strong>] refers to all program code
chunks by a simple, ascending sequence number through the file.
This becomes the HTML anchor name, also.</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Multiple file output:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">The programmer may specify more than one output file in a single [<strong>py-web-tool</strong>]
source file. This is required when constructing programs in a combination of
languages (say, Fortran and C). It's also an advantage when constructing
very large programs.</td>
</tr>
</tbody>
</table>
</blockquote>
</div>
<div class="section" id="use-cases">
<h2><a class="toc-backref" href="#toc-entry-5">Use Cases</a></h2>
<p><strong>py-web-tool</strong> supports two use cases, <a class="reference internal" href="#tangle-source-files">Tangle Source Files</a> and <a class="reference internal" href="#weave-documentation">Weave Documentation</a>.
These are often combined into a single request of the application that will both
weave and tangle.</p>
<div class="section" id="tangle-source-files">
<h3><a class="toc-backref" href="#toc-entry-6">Tangle Source Files</a></h3>
<p>A user initiates this process when they have a complete <tt class="docutils literal">.w</tt> file that contains
a description of source files.  These source files are described with <tt class="docutils literal">&#64;o</tt> commands
in the <tt class="docutils literal">.w</tt> file.</p>
<p>The use case is successful when the source files are produced.</p>
<p>Outside this use case, the user will debug those source files, possibly updating the
<tt class="docutils literal">.w</tt> file.  This will lead to a need to restart this use case.</p>
<p>The use case is a failure when the source files cannot be produced, due to
errors in the <tt class="docutils literal">.w</tt> file.  These must be corrected based on information in log messages.</p>
<p>The sequence is <tt class="docutils literal">./pyweb.py <span class="pre">*theFile*.w</span></tt>.</p>
</div>
<div class="section" id="weave-documentation">
<h3><a class="toc-backref" href="#toc-entry-7">Weave Documentation</a></h3>
<p>A user initiates this process when they have a <tt class="docutils literal">.w</tt> file that contains
a description of a document to produce.  The document is described by the entire
<tt class="docutils literal">.w</tt> file.</p>
<p>The use case is successful when the documentation file is produced.</p>
<p>Outside this use case, the user will edit the documentation file, possibly updating the
<tt class="docutils literal">.w</tt> file.  This will lead to a need to restart this use case.</p>
<p>The use case is a failure when the documentation file cannot be produced, due to
errors in the <tt class="docutils literal">.w</tt> file.  These must be corrected based on information in log messages.</p>
<p>The sequence is <tt class="docutils literal">./pyweb.py <span class="pre">*theFile*.w</span></tt>.</p>
</div>
<div class="section" id="tangle-test-and-weave-with-test-results">
<h3><a class="toc-backref" href="#toc-entry-8">Tangle, Test, and Weave with Test Results</a></h3>
<p>A user initiates this process when they have a <tt class="docutils literal">.w</tt> file that contains
a description of a document to produce.  The document is described by the entire
<tt class="docutils literal">.w</tt> file.  Further, their final document should include test output
from the source files created by the tangle operation.</p>
<p>The use case is successful when the documentation file is produced, including
current test output.</p>
<p>Outside this use case, the user will edit the documentation file, possibly updating the
<tt class="docutils literal">.w</tt> file.  This will lead to a need to restart this use case.</p>
<p>The use case is a failure when the documentation file cannot be produced, due to
errors in the <tt class="docutils literal">.w</tt> file.  These must be corrected based on information in log messages.</p>
<p>The use case is a failure when the documentation file does not include current
test output.</p>
<p>The sequence is as follows:</p>
<pre class="literal-block">
./pyweb.py -xw -pi <em>theFile</em>.w
python <em>theTest</em> &gt;<em>aLog</em>
./pyweb.py -xt <em>theFile</em>.w
</pre>
<p>Another possibility includes the following:</p>
<blockquote>
<pre class="literal-block">
./pyweb.py -xw -pi <em>theFile</em>.w
python -m pytest <em>theTestFile</em> &gt;<em>aLog</em>
./pyweb.py -xt <em>theFile</em>.w
</pre>
</blockquote>
<p>The first step excludes weaving and permits errors on the <tt class="docutils literal">&#64;i</tt> command.  The <tt class="docutils literal"><span class="pre">-pi</span></tt> option
is necessary in the event that the log file does not yet exist.  The second step
runs the test, creating a log file.  The third step weaves the final document,
including the test output.</p>
</div>
</div>
<div class="section" id="writing-py-web-tool-w-files">
<h2><a class="toc-backref" href="#toc-entry-9">Writing <strong>py-web-tool</strong> <tt class="docutils literal">.w</tt> Files</a></h2>
<p>The essence of literate programming is a markup language that distinguishes code
from documentation. For tangling, the code is relevant. For weaving, both code
and documentation are relevant.</p>
<p>The <strong>py-web-tool</strong> markup defines a sequence of <em>Chunks</em>.
Each Chunk is either program source code to
be <em>tangled</em> or it is documentation to be <em>woven</em>.  The bulk of
the file is typically documentation chunks that describe the program in
some human-oriented markup language like RST, HTML, or LaTeX.</p>
<p>The <strong>py-web-tool</strong> tool parses the input, and performs the
tangle and weave operations.  It <em>tangles</em> each individual output file
from the program source chunks.  It <em>weaves</em> a final documentation file
file from the entire sequence of chunks provided, mixing the author's
original documentation with some markup around the embedded program source.</p>
<p><strong>py-web-tool</strong> markup surrounds the code with tags. Everything else is documentation.
When tangling, the tagged code is assembled into the final file.
When weaving, the tags are replaced with output markup. This means that <strong>py-web-tool</strong>
is not <strong>totally</strong> independent of the output markup.</p>
<p>The code chunks will have their indentation adjusted to match the context in which
they were originally defined. This assures that Python (which relies on indentation)
parses correctly. For other languages, proper indentation is expected but not required.</p>
<p>The non-code chunks are not transformed up in any way.  Everything that's not
explicitly a code chunk is output without modification.</p>
<p>All of the <strong>py-web-tool</strong> tags begin with <tt class="docutils literal">&#64;</tt>.  This can be changed.</p>
<p>The <em>Structural</em> tags (historically called &quot;major commands&quot;) partition the input and define the
various chunks.  The <em>Inline</em> tags are (called &quot;minor commands&quot;) are used to control the
woven and tangled output from those chunks. There are <em>Content</em> tags which generate
summary cross-reference content in woven files.</p>
<div class="section" id="structural-tags">
<h3><a class="toc-backref" href="#toc-entry-10">Structural Tags</a></h3>
<p>There are two definitional tags; these define the various chunks
in an input file.</p>
<p><tt class="docutils literal">&#64;o</tt> <em>file</em> <tt class="docutils literal">&#64;{</tt> <em>text</em> <tt class="docutils literal">&#64;}</tt></p>
<blockquote>
<p>The <tt class="docutils literal">&#64;o</tt> (output) command defines a named output file chunk.
The text is tangled to the named
file with no alteration.  It is woven into the document
in an appropriate fixed-width font.</p>
<p>There are options available to specify comment conventions
for the tangled output; this allows inclusion of source
line numbers.</p>
</blockquote>
<p><tt class="docutils literal">&#64;d</tt> <em>name</em> <tt class="docutils literal">&#64;{</tt> <em>text</em> <tt class="docutils literal">&#64;}</tt></p>
<blockquote>
<p>The <tt class="docutils literal">&#64;d</tt> (define) command defines a named chunk of program source.
This text is tangled
or woven when it is referenced by the <em>reference</em> inline tag.</p>
<p>There are options available to specify the indentation for this
particular chunk. In rare cases, it can be helpful to override
the indentation context.</p>
</blockquote>
<p>Each <tt class="docutils literal">&#64;o</tt> and <tt class="docutils literal">&#64;d</tt> tag is followed by a chunk which is
delimited by <tt class="docutils literal">&#64;{</tt> and <tt class="docutils literal">&#64;}</tt> tags.
At the end of that chunk, there is an optional &quot;major&quot; tag.</p>
<p><tt class="docutils literal">&#64;|</tt></p>
<blockquote>
A chunk may define user identifiers.  The list of defined identifiers is placed
in the chunk, separated by the <tt class="docutils literal">&#64;|</tt> separator.</blockquote>
<p>Additionally, these tags provide for the inclusion of additional input files.
This is necessary for decomposing a long document into easy-to-edit sections.</p>
<p><tt class="docutils literal">&#64;i</tt> <em>file</em></p>
<blockquote>
The <tt class="docutils literal">&#64;i</tt> (include) command includes another file.  The previous chunk
is ended.  The file is processed completely, then a new chunk
is started for the text after the <tt class="docutils literal">&#64;i</tt> command.</blockquote>
<p>All material that is not explicitly in a <tt class="docutils literal">&#64;o</tt> or <tt class="docutils literal">&#64;d</tt> named chunk is
implicitly collected into a sequence of anonymous document source chunks.
These anonymous chunks form the backbone of the document that is woven.
The anonymous chunks are never tangled into output program source files.
They are woven into the document without any alteration.</p>
<p>Note that white space (line breaks (<tt class="docutils literal">'\n'</tt>), tabs and spaces) have no effect on the input parsing.
They are completely preserved on output.</p>
<p>The following example has three chunks:</p>
<pre class="literal-block">
Some RST-format documentation that describes the following piece of the
program.

&#64;o myFile.py
&#64;{
import math
print( math.pi )
&#64;| math math.pi
&#64;}

Some more RST documentation.
</pre>
<p>This starts with an anonymous chunk of
documentation. It includes a named output chunk which will write to <tt class="docutils literal">myFile.py</tt>.
It ends with an anonymous chunk of documentation.</p>
</div>
<div class="section" id="inline-tags">
<h3><a class="toc-backref" href="#toc-entry-11">Inline Tags</a></h3>
<p>There are several tags that are replaced by content in the woven output.</p>
<p><tt class="docutils literal">&#64;&#64;</tt></p>
<blockquote>
The <tt class="docutils literal">&#64;&#64;</tt> command creates a single <tt class="docutils literal">&#64;</tt> in the output file.
This is replaced in tangled as well as woven output.</blockquote>
<p><tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt></p>
<blockquote>
The <em>name</em> references a named chunk.
When tangling, the referenced chunk replaces the reference command.
When weaving, a reference marker is used.  For example, in RST, this can be
replaced with RST <tt class="docutils literal">`reference`_</tt> markup.
Note that the indentation prior to the <tt class="docutils literal">&#64;&lt;</tt> tag is preserved
for the tangled chunk that replaces the tag.</blockquote>
<p><tt class="docutils literal">&#64;(</tt><em>Python expression</em><tt class="docutils literal">&#64;)</tt></p>
<blockquote>
The <em>Python expression</em> is evaluated and the result is tangled or
woven in place.  A few global variables and modules are available.
These are described in <a class="reference internal" href="#expression-context">Expression Context</a>.</blockquote>
</div>
<div class="section" id="content-tags">
<h3><a class="toc-backref" href="#toc-entry-12">Content Tags</a></h3>
<p>There are three index creation tags that are replaced by content in the woven output.</p>
<p><tt class="docutils literal">&#64;f</tt></p>
<blockquote>
The <tt class="docutils literal">&#64;f</tt> command inserts a file cross reference.  This
lists the name of each file created by an <tt class="docutils literal">&#64;o</tt> command, and all of the various
chunks that are concatenated to create this file.</blockquote>
<p><tt class="docutils literal">&#64;m</tt></p>
<blockquote>
The <tt class="docutils literal">&#64;m</tt> command inserts a named chunk (&quot;macro&quot;) cross reference.  This
lists the name of each chunk created by a <tt class="docutils literal">&#64;d</tt> command, and all of the various
chunks that are concatenated to create the complete chunk.</blockquote>
<p><tt class="docutils literal">&#64;u</tt></p>
<blockquote>
The <tt class="docutils literal">&#64;u</tt> command inserts a user identifier cross reference.
This index lists the name of each chunk created by an <tt class="docutils literal">&#64;d</tt> command or <tt class="docutils literal">&#64;|</tt>,
and all of the various chunks that are concatenated to create the complete chunk.</blockquote>
</div>
<div class="section" id="additional-features">
<h3><a class="toc-backref" href="#toc-entry-13">Additional Features</a></h3>
<p><strong>Sequence Numbers</strong>. The named chunks (from both <tt class="docutils literal">&#64;o</tt> and <tt class="docutils literal">&#64;d</tt> commands) are assigned
unique sequence numbers to simplify cross references.</p>
<p><strong>Case Sensitive</strong>. Chunk names and file names are case sensitive.</p>
<p><strong>Abbreviations</strong>. Chunk names can be abbreviated.  A partial name can have a trailing ellipsis (...),
this will be resolved to the full name.  The most typical use for this
is shown in the following example:</p>
<pre class="literal-block">
Some RST-format documentation.

&#64;o myFile.py
&#64;{
&#64;&lt;imports of the various packages used&#64;&gt;
print(math.pi,time.time())
&#64;}

Some notes on the packages used.

&#64;d imports...
&#64;{
import math,time
&#64;| math time
&#64;}

Some more RST-format documentation.
</pre>
<p>This example shows five chunks.</p>
<ol class="arabic simple">
<li>An anonymous chunk of documentation.</li>
<li>A named chunk that tangles the <tt class="docutils literal">myFile.py</tt> output.  It has
a reference to the <tt class="docutils literal">imports of the various packages used</tt> chunk.
Note that the full name of the chunk is essentially a line of
documentation, traditionally done as a comment line in a non-literate
programming environment.</li>
<li>An anonymous chunk of documentation.</li>
<li>A named chunk with an abbreviated name.  The <tt class="docutils literal"><span class="pre">imports...</span></tt>
matches the name <tt class="docutils literal">imports of the various packages used</tt>.
Set off after the <tt class="docutils literal">&#64;|</tt> separator is
the list of user-specified identifiers defined in this chunk.</li>
<li>An anonymous chunk of documentation.</li>
</ol>
<p>Note that the first time a name appears (in a reference or definition),
it <strong>must</strong> be the full name.  All subsequent uses can be elisions.
Also not that ambiguous elision is an annoying problem when you
first start creating a document.</p>
<p><strong>Concatenation</strong>. Named chunks are concatenated from their various pieces.
This allows a named chunk to be broken into several pieces, simplifying
the description.  This is most often used when producing
fairly complex output files.</p>
<pre class="literal-block">
An anonymous chunk with some RST documentation.

&#64;o myFile.py
&#64;{
import math, time
&#64;}

Some notes on the packages used.

&#64;o myFile.py
&#64;{
print(math.pi, time.time())
&#64;}

Some more HTML documentation.
</pre>
<p>This example shows five chunks.</p>
<ol class="arabic simple">
<li>An anonymous chunk of documentation.</li>
<li>A named chunk that tangles the <tt class="docutils literal">myFile.py</tt> output.  It has
the first part of the file.  In the woven document
this is marked with <tt class="docutils literal">&quot;=&quot;</tt>.</li>
<li>An anonymous chunk of documentation.</li>
<li>A named chunk that also tangles the <tt class="docutils literal">myFile.py</tt> output. This
chunk's content is appended to the first chunk.  In the woven document
this is marked with <tt class="docutils literal"><span class="pre">&quot;+=&quot;</span></tt>.</li>
<li>An anonymous chunk of documentation.</li>
</ol>
<p><strong>Newline Preservation</strong>. Newline characters are preserved on input.
Because of this the output may appear to have excessive newlines.
In all of the above examples, each
named chunk was defined with the following.</p>
<pre class="literal-block">
&#64;{
import math, time
&#64;}
</pre>
<p>This puts a newline character before and after the import line.</p>
</div>
<div class="section" id="controlling-indentation">
<h3><a class="toc-backref" href="#toc-entry-14">Controlling Indentation</a></h3>
<p>We have two choices in indentation:</p>
<ul class="simple">
<li>Context-Sensitive.</li>
<li>Consistent.</li>
</ul>
<p>If we have context-sensitive indentation, then the indentation of a chunk reference
is applied to the entire chunk when expanded in place of the reference.  This makes it
simpler to prepare source for languages (like Python) where indentation
is important.</p>
<p>There are cases, however, when this is not desirable. There are some places in Python
where we want to create long, triple-quoted strings with indentation that does
not follow the prevailing indentations of the surrounding code.</p>
<p>Here's how the context-sensitive indentation works.</p>
<pre class="literal-block">
&#64;o myFile.py
&#64;{
def aFunction(a, b):
    &#64;&lt;body of aFunction&#64;&gt;
&#64;| aFunction &#64;}

&#64;d body...
&#64;{
&quot;&quot;&quot;doc string&quot;&quot;&quot;
return a + b
&#64;}
</pre>
<p>The tangled output from this will look like the following.
All of the newline characters are preserved, and the reference to
<em>body of the aFunction</em> is indented to match the prevailing
indent where it was referenced.  In the following example,
explicit line markers of <tt class="docutils literal">~</tt> are provided to make the blank lines
more obvious.</p>
<pre class="literal-block">
~
~def aFunction(a, b):
~
~    &quot;&quot;&quot;doc string&quot;&quot;&quot;
~    return a + b
~
</pre>
<p>[The <tt class="docutils literal">&#64;|</tt> command shows that this chunk defines the identifier <tt class="docutils literal">aFunction</tt>.]</p>
<p>This leads to a difficult design choice.</p>
<ul>
<li><p class="first">Do we use context-sensitive indentation without any exceptions?
This is the current implementation.</p>
</li>
<li><p class="first">Do we use consistent indentation and require the author to get it right?
This seems to make Python awkward, since we might indent our outdent a
<tt class="docutils literal">&#64;&lt;</tt> <em>name</em> <tt class="docutils literal">&#64;&gt;</tt> command, expecting the chunk to indent properly.</p>
</li>
<li><p class="first">Do we use context-sensitive indentation with an exception indicator?
This seems to go against the utter simplicity we're cribbing from <strong>noweb</strong>.
However, it makes a great deal of sense to add an option for <tt class="docutils literal">&#64;d</tt> chunks to
supersede context-sensitive indentation. The author must then get it right.</p>
<p>The syntax to define a section looks like this:</p>
</li>
</ul>
<pre class="literal-block">
&#64;d -noindent some chunk name
&#64;{<em>First partial line</em>
<em>More that uses &quot;&quot;&quot;</em>
&#64;}
</pre>
<p>We might reference such a section like this.</p>
<pre class="literal-block">
&#64;d some bigger chunk...
&#64;{<em>code</em>
    &#64;&lt;some chunk name&#64;&gt;
&#64;}
</pre>
<p>This will include the <tt class="docutils literal"><span class="pre">-noindent</span></tt> section by resetting the contextual indentation
to zero. The <em>First partial line</em> line will be output after the four spaces
provided by the <tt class="docutils literal">some bigger chunk</tt> context.</p>
<p>After the first newline (<em>More that uses &quot;&quot;&quot;</em>) will be at the left margin.</p>
</div>
<div class="section" id="tracking-source-line-numbers">
<h3><a class="toc-backref" href="#toc-entry-15">Tracking Source Line Numbers</a></h3>
<p>Since the tangled output files are -- well -- tangled, it can be difficult to
trace back from a Python error stack to the original line in the <tt class="docutils literal">.w</tt> file that
needs to be fixed.</p>
<p>To facilitate this, there is a two-step operation to get more detailed information
on how tangling worked.</p>
<ol class="arabic simple">
<li>Use the -n command-line option to get line numbers.</li>
<li>Include comment indicators on the <tt class="docutils literal">&#64;o</tt> commands that define output files.</li>
</ol>
<p>The expanded syntax for <tt class="docutils literal">&#64;o</tt> looks like this.</p>
<pre class="literal-block">
&#64;o -start /* -end <em>/ page-layout.css
&#64;{
*Some CSS code</em>
&#64;}
</pre>
<p>We've added two options: <tt class="docutils literal"><span class="pre">-start</span> /*</tt> and <tt class="docutils literal"><span class="pre">-end</span> */</tt> which define comment
start and end syntax. This will lead to comments embedded in the tangled output
which contain source line numbers for every (every!) chunk.</p>
</div>
<div class="section" id="expression-context">
<h3><a class="toc-backref" href="#toc-entry-16">Expression Context</a></h3>
<p>There are two possible implementations for evaluation of a Python
expression in the input.</p>
<ol class="arabic simple">
<li>Create an <tt class="docutils literal">ExpressionCommand</tt>, and append this to the current <tt class="docutils literal">Chunk</tt>.
This will allow evaluation during weave processing and during tangle processing.  This
makes the entire weave (or tangle) context available to the expression, including
completed cross reference information.</li>
<li>Evaluate the expression during input parsing, and append the resulting text
as a <tt class="docutils literal">TextCommand</tt> to the current <tt class="docutils literal">Chunk</tt>.  This provides a common result
available to both weave and parse, but the only context available is the <tt class="docutils literal">WebReader</tt> and
the incomplete <tt class="docutils literal">Web</tt>, built up to that point.</li>
</ol>
<p>In this implementation, we adopt the latter approach, and evaluate expressions immediately.
A global context is created with the following variables defined.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">os.path:</th><td class="field-body">This is the standard <tt class="docutils literal">os.path</tt> module.</td>
</tr>
<tr class="field"><th class="field-name">os.getcwd:</th><td class="field-body">The complete <tt class="docutils literal">os</tt> module is not available. Just this function.</td>
</tr>
<tr class="field"><th class="field-name">datetime:</th><td class="field-body">This is the standard <tt class="docutils literal">datetime</tt> module.</td>
</tr>
<tr class="field"><th class="field-name">time:</th><td class="field-body">The standard <tt class="docutils literal">time</tt> module.</td>
</tr>
<tr class="field"><th class="field-name">platform:</th><td class="field-body">This is the standard <tt class="docutils literal">platform</tt> module.</td>
</tr>
<tr class="field"><th class="field-name">__builtins__:</th><td class="field-body">Most of the built-ins are available, too. Not all.
<tt class="docutils literal">exec()</tt>, <tt class="docutils literal">eval()</tt>, <tt class="docutils literal">open()</tt> and <tt class="docutils literal">__import__()</tt> aren't available.</td>
</tr>
<tr class="field"><th class="field-name">theLocation:</th><td class="field-body">A tuple with the file name, first line number and last line number
for the original expression's location.</td>
</tr>
<tr class="field"><th class="field-name">theWebReader:</th><td class="field-body">The <tt class="docutils literal">WebReader</tt> instance doing the parsing.</td>
</tr>
<tr class="field"><th class="field-name">theFile:</th><td class="field-body">The <tt class="docutils literal">.w</tt> file being processed.</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">thisApplication:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">The name of the running <strong>py-web-tool</strong> application. It may not be pyweb.py,
if some other script is being used.</td>
</tr>
<tr class="field"><th class="field-name">__version__:</th><td class="field-body">The version string in the <strong>py-web-tool</strong> application.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="running-py-web-tool-to-tangle-and-weave">
<h2><a class="toc-backref" href="#toc-entry-17">Running <strong>py-web-tool</strong> to Tangle and Weave</a></h2>
<p>Assuming that you have marked <tt class="docutils literal">pyweb.py</tt> as executable,
you do the following.</p>
<pre class="literal-block">
./pyweb.py <em>file</em>...
</pre>
<p>This will tangle the <tt class="docutils literal">&#64;o</tt> commands in each <em>file</em>.
It will also weave the output, and create <em>file</em>.txt.</p>
<div class="section" id="command-line-options">
<h3><a class="toc-backref" href="#toc-entry-18">Command Line Options</a></h3>
<p>Currently, the following command line options are accepted.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">-v:</th><td class="field-body">Verbose logging.</td>
</tr>
<tr class="field"><th class="field-name">-s:</th><td class="field-body">Silent operation.</td>
</tr>
<tr class="field"><th class="field-name">-c<em>x</em>:</th><td class="field-body">Change the command character from <tt class="docutils literal">&#64;</tt> to <tt class="docutils literal">*x*</tt>.</td>
</tr>
<tr class="field"><th class="field-name">-w<em>weaver</em>:</th><td class="field-body">Choose a particular documentation weaver template. Currently the choices
are RST and HTML.</td>
</tr>
<tr class="field"><th class="field-name">-xw:</th><td class="field-body">Exclude weaving.  This does tangling of source program files only.</td>
</tr>
<tr class="field"><th class="field-name">-xt:</th><td class="field-body">Exclude tangling.  This does weaving of the document file only.</td>
</tr>
<tr class="field"><th class="field-name">-p<em>command</em>:</th><td class="field-body">Permit errors in the given list of commands.  The most common
version is <tt class="docutils literal"><span class="pre">-pi</span></tt> to permit errors in locating an include file.
This is done in the following scenario: pass 1 uses <tt class="docutils literal"><span class="pre">-xw</span> <span class="pre">-pi</span></tt> to exclude
weaving and permit include-file errors;
the tangled program is run to create test results; pass 2 uses
<tt class="docutils literal"><span class="pre">-xt</span></tt> to exclude tangling and include the test results.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="bootstrapping">
<h2><a class="toc-backref" href="#toc-entry-19">Bootstrapping</a></h2>
<p><strong>py-web-tool</strong> is written using <strong>py-web-tool</strong>. The distribution includes the original <tt class="docutils literal">.w</tt>
files as well as a <tt class="docutils literal">.py</tt> module.</p>
<p>The bootstrap procedure is this.</p>
<pre class="literal-block">
python pyweb.py pyweb.w
rst2html.py pyweb.rst pyweb.html
</pre>
<p>The resulting <tt class="docutils literal">pyweb.html</tt> file is the final documentation.</p>
<p>Similarly, the tests are bootstrapped from <tt class="docutils literal">.w</tt> files.</p>
<pre class="literal-block">
cd test
python ../pyweb.py pyweb_test.w
PYTHONPATH=.. python test.py
rst2html.py pyweb_test.rst pyweb_test.html
</pre>
</div>
<div class="section" id="dependencies">
<h2><a class="toc-backref" href="#toc-entry-20">Dependencies</a></h2>
<p><strong>py-web-tool</strong> requires Python 3.10 or newer.</p>
<p>If you create RST output, you'll want to use docutils to translate
the RST to HTML or LaTeX or any of the other formats supported by docutils.</p>
</div>
<div class="section" id="acknowledgements">
<h2><a class="toc-backref" href="#toc-entry-21">Acknowledgements</a></h2>
<dl class="docutils">
<dt>This application is very directly based on (derived from?) work that</dt>
<dd>preceded this, particularly the following:</dd>
</dl>
<ul class="simple">
<li>Ross N. Williams' <em>FunnelWeb</em> <a class="reference external" href="http://www.ross.net/funnelweb/">http://www.ross.net/funnelweb/</a></li>
<li>Norman Ramsey's <em>noweb</em> <a class="reference external" href="http://www.eecs.harvard.edu/~nr/noweb/">http://www.eecs.harvard.edu/~nr/noweb/</a></li>
<li>Preston Briggs' <em>nuweb</em> <a class="reference external" href="http://sourceforge.net/projects/nuweb/">http://sourceforge.net/projects/nuweb/</a>
Currently supported by Charles Martin and Marc W. Mengel</li>
</ul>
<p>Also, after using John Skaller's <em>interscript</em> <a class="reference external" href="http://interscript.sourceforge.net/">http://interscript.sourceforge.net/</a>
for two large development efforts, I finally understood the feature set I really wanted.</p>
<p>Jason Fruit and others contributed to the previous version.</p>
<!-- pyweb/overview.w -->
</div>
</div>
<div class="section" id="architecture-and-design-overview">
<h1><a class="toc-backref" href="#toc-entry-22">Architecture and Design Overview</a></h1>
<p>This application breaks the overall problem into the following sub-problems.</p>
<ol class="arabic simple">
<li>Representation of the Web as Chunks and Commands</li>
<li>Reading and parsing the input.</li>
<li>Weaving a document file.</li>
<li>Tangling the desired program source files.</li>
</ol>
<div class="section" id="representation">
<h2><a class="toc-backref" href="#toc-entry-23">Representation</a></h2>
<p>The basic parse tree has three layers. The source document is transformed into a web,
which is the overall container. The source is
decomposed into a simple sequence of Chunks.  Each Chunk is a simple sequence
of Commands.</p>
<p>Chunks and Commands cannot be nested, leading to delightful simplification.</p>
<p>The overall Web
includes the sequence of Chunks as well as an index for the named chunks.</p>
<p>Note that a named chunk may be created through a number of <tt class="docutils literal">&#64;d</tt> commands.
This means that
each named chunk may be a sequence of Chunks with a common name.
They are concatenated in order to permit decomposing a single concept into sequentially described pieces.</p>
<p>Because a Chunk is composed of a sequence Commands, the weave and tangle actions can be
delegated to each Chunk, and in turn, delegated to each Command that
composes a Chunk.</p>
<p>There is a small interaction between Tanglers and Chunks to work out the indentation.
Otherwise, the output and input work is largely independent of the Web itself.</p>
</div>
<div class="section" id="reading-and-parsing">
<h2><a class="toc-backref" href="#toc-entry-24">Reading and Parsing</a></h2>
<p>A solution to the reading and parsing problem depends on a convenient
tool for breaking up the input stream and a representation for the chunks of input.
Input decomposition is done with the Python Splitter pattern.</p>
<p>The <strong>Splitter</strong> pattern is widely used in text processing, and has a long legacy
in a variety of languages and libraries.  A Splitter decomposes a string into
a sequence of strings using the split pattern.  There are many variant implementations.
One variant locates only a single occurence (usually the left-most); this is
commonly implemented as a Find or Search string function.  Another variant locates all
occurrences of a specific string or character, and discards the matching string or
character.</p>
<p>The variation on <strong>Splitter</strong> that we use in this application
creates each element in the resulting sequence as either (1) an instance of the
split regular expression or (2) the text between split patterns.</p>
<p>We define our splitting pattern with the regular
expression <tt class="docutils literal"><span class="pre">'&#64;.|\n'</span></tt>.  This will split on either of these patterns:</p>
<ul class="simple">
<li><tt class="docutils literal">&#64;</tt> followed by a single character,</li>
<li>or, a newline.</li>
</ul>
<p>For the most part, <tt class="docutils literal">\n</tt> is just text. The exception is the
<tt class="docutils literal">&#64;i</tt> <em>filename</em> command, which ends at the end of the line, making the <tt class="docutils literal">\n</tt>
significant syntax.</p>
<p>We could be a tad more specific and use the following as a split pattern:
<tt class="docutils literal"><span class="pre">'&#64;[doOifmu\|&lt;&gt;(){}\[\]]|\n'</span></tt>.  This would silently ignore unknown commands,
merging them in with the surrounding text.  This would leave the <tt class="docutils literal"><span class="pre">'&#64;&#64;'</span></tt> sequences
completely alone, allowing us to replace <tt class="docutils literal"><span class="pre">'&#64;&#64;'</span></tt> with <tt class="docutils literal">'&#64;'</tt> in
every text chunk.</p>
<p>Within the <tt class="docutils literal">&#64;d</tt> and <tt class="docutils literal">&#64;o</tt> commands, we also parse options. These follow
the syntax rules for Tcl or the shell. Optional fields are prefaced with <tt class="docutils literal">-</tt>.
All options come before all positional arguments.</p>
</div>
<div class="section" id="weaving">
<h2><a class="toc-backref" href="#toc-entry-25">Weaving</a></h2>
<p>The weaving operation depends on the target document markup language.
There are several approaches to this problem.</p>
<ul class="simple">
<li>We can use a markup language unique to <strong>py-web-tool</strong>,
and weave using markup in the desired target language.</li>
<li>We can use a standard markup language and use converters to transform
the standard markup to the desired target markup. We could adopt
XML or RST or some other generic markup that can be converted.</li>
</ul>
<p>The problem with the second method is the mixture of background document
in some standard markup and the code elements, which need to be bracketed
with common templates. We hate to repeat these templates; that's the
job of a literate programming tool. Also, certain code characters must
be properly escaped.</p>
<p>Since <strong>py-web-tool</strong> must transform the code into a specific markup language,
we opt using a <strong>Strategy</strong> pattern to encapsulate markup language details.
Each alternative markup strategy is then a subclass of <strong>Weaver</strong>.  This
simplifies adding additional markup languages without inventing a
markup language unique to <strong>py-web-tool</strong>.
The author uses their preferred markup, and their preferred
toolset to convert to other output languages.</p>
<p>The templates used to wrap code sections can be tweaked relatively easily.</p>
</div>
<div class="section" id="tangling">
<h2><a class="toc-backref" href="#toc-entry-26">Tangling</a></h2>
<p>The tangling operation produces output files.  In other tools,
some care was taken to understand the source code context for tangling, and
provide a correct indentation.  This required a command-line parameter
to turn off indentation for languages like Fortran, where identation
is not used.</p>
<p>In <strong>py-web-tool</strong>, there are two options. The default behavior is that the
indent of a <tt class="docutils literal">&#64;&lt;</tt> command is used to set the indent of the
material is expanded in place of this reference.  If all <tt class="docutils literal">&#64;&lt;</tt> commands are presented at the
left margin, no indentation will be done.  This is helpful simplification,
particularly for users of Python, where indentation is significant.</p>
<p>In rare cases, we might need both, and a <tt class="docutils literal">&#64;d</tt> chunk can override the indentation
rule to force the material to be placed at the left margin.</p>
</div>
<div class="section" id="application">
<h2><a class="toc-backref" href="#toc-entry-27">Application</a></h2>
<p>The overall application has two layers to it. There are actions (Load, Tangle, Weave)
as well as a top-level main function that parses the command line, creates
and configures the actions, and then closes up shop when all done.</p>
<p>The idea is that the Weaver Action should be visible to tools like <a class="reference external" href="https://docs.pyinvoke.org/en/stable/index.html">PyInvoke</a>.
We want <tt class="docutils literal"><span class="pre">Weave(&quot;someFile.w&quot;)</span></tt> to be a sensible task.</p>
<!-- pyweb/impl.w -->
</div>
</div>
<div class="section" id="implementation">
<h1><a class="toc-backref" href="#toc-entry-28">Implementation</a></h1>
<p>The implementation is contained in a file that both defines
the base classes and provides an overall <tt class="docutils literal">main()</tt> function.  The <tt class="docutils literal">main()</tt>
function uses these base classes to weave and tangle the output files.</p>
<p>The broad outline of the presentation is as follows:</p>
<ul class="simple">
<li><a class="reference internal" href="#base-class-definitions">Base Class Definitions</a> is largely an overview of the important features.</li>
<li><a class="reference internal" href="#emitters">Emitters</a> write various kinds of files. We'll present this first because
the output shapes other parts of what the program does.</li>
<li><a class="reference internal" href="#chunks">Chunks</a> are pieces of the source document, built into a Web.</li>
<li><a class="reference internal" href="#commands">Commands</a> are the items within a <tt class="docutils literal">Chunk</tt>.</li>
<li><a class="reference internal" href="#the-web-and-webreader-classes">The Web and WebReader Classes</a> includes the web and the parser which produces a web.<ul>
<li><a class="reference internal" href="#the-webreader-class">The WebReader class</a> which parses the Web structure.</li>
<li><a class="reference internal" href="#the-tokenizer-class">The Tokenizer class</a> which tokenizes the raw input.</li>
<li><a class="reference internal" href="#the-option-parser-class">The Option Parser Class</a> which tokenizes just the arguments to <tt class="docutils literal">&#64;d</tt> and <tt class="docutils literal">&#64;o</tt>
commands.</li>
</ul>
</li>
<li><a class="reference internal" href="#error-class">Error class</a> defines an application-specific Error.</li>
<li><a class="reference internal" href="#reference-strategy">Reference Strategy</a> defines ways to manage cross-references among chunks.
These support the <tt class="docutils literal">Weaver</tt> subclasses of the <tt class="docutils literal">Emitters</tt>.</li>
<li><a class="reference internal" href="#action-class-hierarchy">Action class hierarchy</a> defines things this program does.</li>
<li><a class="reference internal" href="#pyweb-module-file">pyWeb Module File</a> defines the final module file that's created.</li>
<li><a class="reference internal" href="#the-application-class">The Application class</a>. This is an overall class definition that includes
command line parsing, picking an Action, configuring and executing the Action.
It could be a set of related functions, but we've bound them into a class.</li>
<li><a class="reference internal" href="#logging-setup">Logging setup</a>. This includes a simple context manager for logging.</li>
<li><a class="reference internal" href="#the-main-function">The Main Function</a>.</li>
</ul>
<div class="section" id="base-class-definitions">
<h2><a class="toc-backref" href="#toc-entry-29">Base Class Definitions</a></h2>
<p>There are the core classes that define the enduring application objects. These form
fairly complex hierarchies.</p>
<ul class="simple">
<li><strong>Commands</strong>. A <tt class="docutils literal">Command</tt> contains user input and creates output.
This can be a block of text from the input file,
one of the various kinds of cross reference commands (<tt class="docutils literal">&#64;f</tt>, <tt class="docutils literal">&#64;m</tt>, or <tt class="docutils literal">&#64;u</tt>)
or a reference to a chunk (via the <tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt> sequence.)</li>
<li><strong>Chunks</strong>. A <tt class="docutils literal">Chunk</tt> is a collection of <tt class="docutils literal">Command</tt> instances.  This can be
either an anonymous chunk that will be sent directly to the output,
or one the classes of named chunks delimited by the
structural <tt class="docutils literal">&#64;d</tt> or <tt class="docutils literal">&#64;o</tt> commands.</li>
</ul>
<p>There are classes for reading the input. These don't form a complex hierarchy.</p>
<p>The <tt class="docutils literal">Web</tt> as a whole is a collection of <tt class="docutils literal">Chunk</tt> instances. It's built by
a <tt class="docutils literal">WebReader</tt> which uses a <tt class="docutils literal">Tokenizer</tt>.</p>
<p>There is a hierarchy for the various kinds of output.</p>
<ul>
<li><p class="first"><strong>Emitters</strong>. An <tt class="docutils literal">Emitter</tt> creates an output file, either tangled code or some kind of markup from
the chunks that make up the source file.  Two major subclasses are the <tt class="docutils literal">Weaver</tt>, which
has a focus on markup output, and <tt class="docutils literal">Tangler</tt> which has a focus on pure source output.</p>
<p>We have further specialization of the weavers for RST,  HTML or LaTeX. The issue is
generating proper markup to surround the code and include cross-references among code
blocks. A number of simple templates are used for this.</p>
</li>
<li><p class="first"><strong>Reference Strategy</strong>. We can have references resolved transitively or simply. A transitive
reference becomes a list of parent <tt class="docutils literal">&#64;d</tt> <tt class="docutils literal">NamedChunk</tt> instances.</p>
</li>
</ul>
<p>Hovering at the edge of the base class definitions is the Action Class Hierarchy.
It's not an essential part of the base class definitions. But it doesn't seem to
fit elsewhere</p>
<p class="rubric" id="target-1">Base Class Definitions (1) =</p>
<pre class="code literal-block">
→Error class - defines the errors raised (<a class="reference internal" href="#target-96">96</a>)

→Command class hierarchy - used to describe individual commands (<a class="reference internal" href="#target-78">78</a>)

→Chunk class hierarchy - used to describe input chunks (<a class="reference internal" href="#target-52">52</a>)

→Web class - describes the overall &quot;web&quot; of chunks (<a class="reference internal" href="#target-97">97</a>)

→Tokenizer class - breaks input into tokens (<a class="reference internal" href="#target-135">135</a>)

→Option Parser class - locates optional values on commands (<a class="reference internal" href="#target-137">137</a>), →(<a class="reference internal" href="#target-138">138</a>), →(<a class="reference internal" href="#target-139">139</a>)

→WebReader class - parses the input file, building the Web structure (<a class="reference internal" href="#target-116">116</a>)

→Emitter class hierarchy - used to control output files (<a class="reference internal" href="#target-2">2</a>)

→Reference class hierarchy - strategies for references to a chunk (<a class="reference internal" href="#target-93">93</a>), →(<a class="reference internal" href="#target-94">94</a>), →(<a class="reference internal" href="#target-95">95</a>)

→Action class hierarchy - used to describe actions of the application (<a class="reference internal" href="#target-140">140</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Base Class Definitions (1)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>The above order is reasonably helpful for Python and minimizes forward
references. A <tt class="docutils literal">Chunk</tt> and a <tt class="docutils literal">Web</tt> do have a circular relationship.
We'll present the designs from the most important first, the Emitters`_.</p>
</div>
<div class="section" id="emitters">
<h2><a class="toc-backref" href="#toc-entry-30">Emitters</a></h2>
<p>An <tt class="docutils literal">Emitter</tt> instance is responsible for control of an output file format.
This includes the necessary file naming, opening, writing and closing operations.
It also includes providing the correct markup for the file type.</p>
<p>There are several subclasses of the <tt class="docutils literal">Emitter</tt> superclass, specialized for various file
formats.</p>
<p class="rubric" id="target-2">Emitter class hierarchy - used to control output files (2) =</p>
<pre class="code literal-block">
→Emitter superclass (<a class="reference internal" href="#target-4">4</a>)

→Weaver subclass of Emitter to create documentation (<a class="reference internal" href="#target-13">13</a>)
→RST subclass of Weaver (<a class="reference internal" href="#target-23">23</a>)
→LaTeX subclass of Weaver (<a class="reference internal" href="#target-24">24</a>)
→HTML subclass of Weaver (<a class="reference internal" href="#target-32">32</a>), →(<a class="reference internal" href="#target-33">33</a>)

→Tangler subclass of Emitter to create source files with no markup (<a class="reference internal" href="#target-44">44</a>)
→TanglerMake subclass which is make-sensitive (<a class="reference internal" href="#target-49">49</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Emitter class hierarchy - used to control output files (2)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
<p>An <tt class="docutils literal">Emitter</tt> instance is created to contain the various details of
writing an output file.  Emitters are created as follows:</p>
<ul class="simple">
<li>A <tt class="docutils literal">Web</tt> object will create a <tt class="docutils literal">Weaver</tt> to <strong>weave</strong> a final document file.</li>
<li>A <tt class="docutils literal">Web</tt> object will create a <tt class="docutils literal">Tangler</tt> to <strong>tangle</strong> each source code file.</li>
</ul>
<p>Since each <tt class="docutils literal">Emitter</tt> instance is responsible for the details of one file
type, different subclasses of <tt class="docutils literal">Emitter</tt> are used when tangling source code files
(<tt class="docutils literal">Tangler</tt>) and  weaving files that include source code plus markup (<tt class="docutils literal">Weaver</tt>).</p>
<p>Further specialization is required when weaving HTML or LaTeX or some other markup language.
Generally, this is a matter of providing three things:</p>
<ul class="simple">
<li>Templates with markup to replace various <strong>py-web-tool</strong> constructs,</li>
<li>Escape rules to make source code amenable to the markup language,</li>
<li>A header to provide overall includes or other setup.</li>
</ul>
<p>An additional part of the escape rules could be expanded to include using a syntax coloring
toolset instead of simply applying escapes.</p>
<p>In the case of <strong>tangle</strong>, the following algorithm is used:</p>
<blockquote>
<p>Visit each each output <tt class="docutils literal">Chunk</tt> (<tt class="docutils literal">&#64;o</tt> command), doing the following:</p>
<ol class="arabic simple">
<li>Open the <tt class="docutils literal">Tangler</tt> instance using the target file name.</li>
<li>Visit each <tt class="docutils literal">Chunk</tt> directed to the file, calling the chunk's <tt class="docutils literal">tangle()</tt> method.<ol class="arabic">
<li>Call the Tangler's <tt class="docutils literal">docBegin()</tt> method.  This sets the Tangler's indents.</li>
<li>Visit each <tt class="docutils literal">Command</tt>, call the command's <tt class="docutils literal">tangle()</tt> method.
For the text of the chunk, the
text is written to the tangler using the <tt class="docutils literal">codeBlock()</tt> method.  For
references to other chunks, the referenced chunk is tangled using the
referenced chunk's <tt class="docutils literal">tangler()</tt> method.</li>
<li>Call the Tangler's <tt class="docutils literal">docEnd()</tt> method.  This clears the Tangler's indents.</li>
</ol>
</li>
</ol>
</blockquote>
<p>In the case of <strong>weave</strong>, the following algorithm is used:</p>
<blockquote>
<ol class="arabic simple">
<li>Open the <tt class="docutils literal">Weaver</tt> instance using the target file name.  This name is transformed
by the weaver to an output file name appropriate to the target markup language.</li>
<li>Visit each each sequential <tt class="docutils literal">Chunk</tt> (anonymous, <tt class="docutils literal">&#64;d</tt> or <tt class="docutils literal">&#64;o</tt>), doing the following:<ol class="arabic">
<li>When visiting each <tt class="docutils literal">Chunk</tt>, call the Chunk's <tt class="docutils literal">weave()</tt> method.<ol class="arabic">
<li>Call the Weaver's <tt class="docutils literal">docBegin()</tt>, <tt class="docutils literal">fileBegin()</tt> or <tt class="docutils literal">codeBegin()</tt> method,
depending on the subclass of Chunk.  For
<tt class="docutils literal">fileBegin()</tt> and <tt class="docutils literal">codeBegin()</tt>, this writes the header for
a code chunk in the weaver's markup language.</li>
<li>Visit each <tt class="docutils literal">Command</tt>, calling the Command's <tt class="docutils literal">weave()</tt> method.
For ordinary text, the
text is written to the Weaver using the <tt class="docutils literal">codeBlock()</tt> method.  For
references to other chunks, the referenced chunk is woven using
the Weaver's <tt class="docutils literal">referenceTo()</tt> method.</li>
<li>Call the Weaver's <tt class="docutils literal">docEnd()</tt>, <tt class="docutils literal">fileEnd()</tt> or <tt class="docutils literal">codeEnd()</tt> method.
For <tt class="docutils literal">fileEnd()</tt> or <tt class="docutils literal">codeEnd()</tt>, this writes a trailer for
a code chunk in the Weaver's markup language.</li>
</ol>
</li>
</ol>
</li>
</ol>
</blockquote>
<div class="section" id="emitter-superclass">
<h3><a class="toc-backref" href="#toc-entry-31">Emitter Superclass</a></h3>
<p>The <tt class="docutils literal">Emitter</tt> class is an abstract base class.  It
contains common features factored out of the <tt class="docutils literal">Weaver</tt> and <tt class="docutils literal">Tangler</tt> subclasses.</p>
<p>Inheriting from the <tt class="docutils literal">Emitter</tt> class generally requires overriding one or more
of the core methods: <tt class="docutils literal">doOpen()</tt>, and <tt class="docutils literal">doClose()</tt>.
A subclass of Tangler, might override the code writing methods:
<tt class="docutils literal">quote()</tt>, <tt class="docutils literal">codeBlock()</tt> or <tt class="docutils literal">codeFinish()</tt>.</p>
<p>The <tt class="docutils literal">Emitter</tt> class defines the basic
framework used to create and write to an output file.
This class follows the <strong>Template</strong> design pattern.  This design pattern
directs us to factor the basic <tt class="docutils literal">open()</tt>, <tt class="docutils literal">close()</tt> and <tt class="docutils literal">write()</tt> methods into two step algorithms.</p>
<pre class="literal-block">
def open(self) -&gt; &quot;Emitter&quot;:
    <em>common preparation</em>
    self.doOpen()  <em># overridden by subclasses</em>
    return self
</pre>
<p>The <em>common preparation</em> section is generally internal
housekeeping.  The <tt class="docutils literal">doOpen()</tt> method is overridden by subclasses to change the
basic behavior.</p>
<p>The class has the following attributes:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">filePath:</th><td class="field-body">the <tt class="docutils literal">Path</tt> object for the target file created by the
<tt class="docutils literal">open()</tt> method.</td>
</tr>
<tr class="field"><th class="field-name">theFile:</th><td class="field-body">the current open file object created by the
open method.</td>
</tr>
<tr class="field"><th class="field-name">linesWritten:</th><td class="field-body">the total number of <tt class="docutils literal">'\n'</tt> characters written to the file.</td>
</tr>
<tr class="field"><th class="field-name">totalFiles:</th><td class="field-body">count of total number of files processed.</td>
</tr>
<tr class="field"><th class="field-name">totalLines:</th><td class="field-body">count of total number of lines.</td>
</tr>
</tbody>
</table>
<p>Additionally, an <tt class="docutils literal">Emitter</tt> object tracks an indentation context used by
The <tt class="docutils literal">codeBlock()</tt> method to indent each line written.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">context:</th><td class="field-body">the indentation context stack, updated by <tt class="docutils literal">addIndent()</tt>,
<tt class="docutils literal">clrIndent()</tt> and <tt class="docutils literal">readdIndent()</tt> methods.</td>
</tr>
<tr class="field"><th class="field-name">lastIndent:</th><td class="field-body">the last indent used after writing a line of source code;
this is used to track places where a partial line of code has a substitution into it.</td>
</tr>
<tr class="field"><th class="field-name">fragment:</th><td class="field-body">the last line written was a fragment and needs a <tt class="docutils literal">'\n'</tt>.</td>
</tr>
<tr class="field"><th class="field-name">code_indent:</th><td class="field-body">Any initial code indent. RST weavers needs additional code indentation.
Other weavers don't care. Tanglers must have this set to zero.</td>
</tr>
</tbody>
</table>
<p class="rubric" id="target-3">Imports (3) =</p>
<pre class="code literal-block">
from pathlib import Path
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (3)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p class="rubric" id="target-4">Emitter superclass (4) =</p>
<pre class="code literal-block">
class Emitter:
    &quot;&quot;&quot;Emit an output file; handling indentation context.&quot;&quot;&quot;
    code_indent = 0 # Used by a Tangler
    filePath : Path

    theFile: TextIO
    def __init__(self) -&gt; None:
        self.logger = logging.getLogger(self.__class__.__qualname__)
        self.log_indent = logging.getLogger(&quot;indent.&quot; + self.__class__.__qualname__)
        # Summary
        self.linesWritten = 0
        self.totalFiles = 0
        self.totalLines = 0
        # Working State
        self.lastIndent = 0
        self.fragment = False
        self.context: list[int] = []
        self.readdIndent(self.code_indent)  # Create context and initial lastIndent values

    def __str__(self) -&gt; str:
        return self.__class__.__name__

    →Emitter core open, close and write (<a class="reference internal" href="#target-5">5</a>)
    →Emitter write a block of code (<a class="reference internal" href="#target-8">8</a>), →(<a class="reference internal" href="#target-9">9</a>), →(<a class="reference internal" href="#target-10">10</a>)
    →Emitter indent control: set, clear and reset (<a class="reference internal" href="#target-11">11</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Emitter superclass (4)</em>. Used by: Emitter class hierarchy... (<a class="reference internal" href="#target-2">2</a>)</p>
</blockquote>
<p>The core <tt class="docutils literal">open()</tt> method tracks the open files.
A subclass overrides a <tt class="docutils literal">doOpen()</tt> method to name the output file, and
then actually open the file.  The Weaver will create an output file with
a name that's based on the overall project.  The Tangler will open the given file
name.</p>
<p>The <tt class="docutils literal">close()</tt> method closes the file.  As with  <tt class="docutils literal">open()</tt>, a
<tt class="docutils literal">doClose()</tt> method actually closes the file.  This allows subclasses
to do overrides on the actual file processing.</p>
<p>The <tt class="docutils literal">write()</tt> method is the lowest-level, unadorned write.
This does some additional counting as well as writing the
characters to the file.</p>
<p class="rubric" id="target-5">Emitter core open, close and write (5) =</p>
<pre class="code literal-block">
def open(self, aPath: Path) -&gt; &quot;Emitter&quot;:
    &quot;&quot;&quot;Open a file.&quot;&quot;&quot;
    self.filePath = aPath
    self.linesWritten = 0
    self.doOpen(aPath)
    return self

→Emitter doOpen, to be overridden by subclasses (<a class="reference internal" href="#target-6">6</a>)

def close(self) -&gt; None:
    self.codeFinish() # Trailing newline for tangler only.
    self.doClose()
    self.totalFiles += 1
    self.totalLines += self.linesWritten

→Emitter doClose, to be overridden by subclasses (<a class="reference internal" href="#target-7">7</a>)

def write(self, text: str) -&gt; None:
    if text is None: return
    self.theFile.write(text)
    self.linesWritten += text.count('\n')

# Context Manager Interface -- used by ``open()`` method
def __enter__(self) -&gt; &quot;Emitter&quot;:
    return self

def __exit__(self, *exc: Any) -&gt; Literal[False]:
    self.close()
    return False
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Emitter core open, close and write (5)</em>. Used by: Emitter superclass (<a class="reference internal" href="#target-4">4</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">doOpen()</tt>, and <tt class="docutils literal">doClose()</tt>
methods are overridden by the various subclasses to
perform the unique operation for the subclass.</p>
<p class="rubric" id="target-6">Emitter doOpen, to be overridden by subclasses (6) =</p>
<pre class="code literal-block">
def doOpen(self, aFile: Path) -&gt; None:
    self.logger.debug(&quot;creating %r&quot;, self.filePath)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Emitter doOpen, to be overridden by subclasses (6)</em>. Used by: Emitter core... (<a class="reference internal" href="#target-5">5</a>)</p>
</blockquote>
<p class="rubric" id="target-7">Emitter doClose, to be overridden by subclasses (7) =</p>
<pre class="code literal-block">
def doClose(self) -&gt; None:
    self.logger.debug(&quot;wrote %d lines to %r&quot;, self.linesWritten, self.filePath)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Emitter doClose, to be overridden by subclasses (7)</em>. Used by: Emitter core... (<a class="reference internal" href="#target-5">5</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">codeBlock()</tt> method writes several lines of code.  It calls
the <tt class="docutils literal">quote()</tt> method to quote each line of code after doing the correct indentation.
Often, the last line of code is incomplete, so it is left unterminated.
This last line of code also sets the indentation for any
additional code to be tangled into this section.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last">Tab characters confuse the indent algorithm.  Tabs are
not expanded to spaces in this application.  They should be expanded
prior to creating a <tt class="docutils literal">.w</tt> file.</p>
</div>
<p>The algorithm is as follows:</p>
<ol class="arabic">
<li><p class="first">Save the topmost value of the context stack as the current indent.</p>
</li>
<li><p class="first">Split the block of text on <tt class="docutils literal">'\n'</tt> boundaries.
There are two cases.</p>
<ul>
<li><p class="first">One line only, no newline.</p>
<p>Write this with the saved lastIndent.
The lastIndent is reset to zero since we've only written a fragmentary line.</p>
</li>
<li><p class="first">Multiple lines.</p>
<ol class="arabic">
<li><p class="first">Write the first line with saved lastIndent.</p>
</li>
<li><p class="first">For each remaining line (except the last), write with the indented text,
ending with a newline.</p>
</li>
<li><p class="first">The string <tt class="docutils literal">split()</tt> method will put a trailing
zero-length element in the list if the original block ended with a
newline.  We drop this zero length piece to prevent writing a useless fragment
of indent-only after the final <tt class="docutils literal">'\n'</tt>.</p>
</li>
<li><p class="first">If the last line has content: Write with the indented text,
but do not write a trailing <tt class="docutils literal">'\n'</tt>. Set lastIndent to zero because
the next <tt class="docutils literal">codeBlock()</tt> will continue this fragmentary line.</p>
<p>If the last line has no content: Write nothing.
Save the length of the last line as the most recent indent for any <tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt>
reference to.</p>
</li>
</ol>
</li>
</ul>
</li>
</ol>
<p>This feels a bit too complex. Indentation is a feature of a tangling a reference to
a NamedChunk. It's not really a general feature of emitters or even tanglers.</p>
<p class="rubric" id="target-8">Emitter write a block of code (8) =</p>
<pre class="code literal-block">
def codeBlock(self, text: str) -&gt; None:
    &quot;&quot;&quot;Indented write of a block of code.
    Buffers the spaces from the last line provided to act as the indent for the next line.
    &quot;&quot;&quot;
    indent = self.context[-1]
    lines = text.split('\n')
    if len(lines) == 1:
        # Fragment with no newline.
        self.logger.debug(&quot;Fragment: %d, %r&quot;, self.lastIndent, lines[0])
        self.write(f&quot;{self.lastIndent*' '!s}{lines[0]!s}&quot;)
        self.lastIndent = 0
        self.fragment = True
    else:
        # Multiple lines with one or more newlines.
        first, rest = lines[:1], lines[1:]
        self.logger.debug(&quot;First Line: %d, %r&quot;, self.lastIndent, first[0])
        self.write(f&quot;{self.lastIndent*' '!s}{first[0]!s}\n&quot;)
        for l in rest[:-1]:
            self.logger.debug(&quot;Next Line: %d, %r&quot;, indent, l)
            self.write(f&quot;{indent*' '!s}{l!s}\n&quot;)
        if rest[-1]:
            # Last line is non-empty.
            self.logger.debug(&quot;Last (Partial) Line: %d, %r&quot;, indent, rest[-1])
            self.write(f&quot;{indent*' '!s}{rest[-1]!s}&quot;)
            self.lastIndent = 0
            self.fragment = True
        else:
            # Last line was empty, a trailing newline.
            self.logger.debug(&quot;Last (Empty) Line: indent is %d&quot;, len(rest[-1]) + indent)
            # Buffer the next indent
            self.lastIndent = len(rest[-1]) + indent
            self.fragment = False
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Emitter write a block of code (8)</em>. Used by: Emitter superclass (<a class="reference internal" href="#target-4">4</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">quote()</tt> method quotes a single line of source code.
This is used by Weaver subclasses to transform source into
a form acceptable by the final weave file format.</p>
<p>In the case of an HTML weaver, the HTML reserved characters --
<tt class="docutils literal">&lt;</tt>, <tt class="docutils literal">&gt;</tt>, <tt class="docutils literal">&amp;</tt>, and <tt class="docutils literal">&quot;</tt> -- must be replaced in the output
of code with <tt class="docutils literal">&amp;lt;</tt>, <tt class="docutils literal">&amp;gt;</tt>, <tt class="docutils literal">&amp;amp;</tt>, and <tt class="docutils literal">&amp;quot;</tt>.
However, since the author's original document sections contain
HTML these will not be altered.</p>
<p class="rubric" id="target-9">Emitter write a block of code (9) +=</p>
<pre class="code literal-block">
quoted_chars: list[tuple[str, str]] = [
    # Must be empty for tangling.
]

def quote(self, aLine: str) -&gt; str:
    &quot;&quot;&quot;Each individual line of code; often overridden by weavers to quote the code.&quot;&quot;&quot;
    clean = aLine
    for from_, to_ in self.quoted_chars:
        clean = clean.replace(from_, to_)
    return clean
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Emitter write a block of code (9)</em>. Used by: Emitter superclass (<a class="reference internal" href="#target-4">4</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">codeFinish()</tt> method handles a trailing fragmentary line when tangling.</p>
<p class="rubric" id="target-10">Emitter write a block of code (10) +=</p>
<pre class="code literal-block">
def codeFinish(self) -&gt; None:
    if self.fragment:
        self.write('\n')
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Emitter write a block of code (10)</em>. Used by: Emitter superclass (<a class="reference internal" href="#target-4">4</a>)</p>
</blockquote>
<p>These three methods are used when to be sure that the included text is indented correctly with respect to the
surrounding text.</p>
<p>The <tt class="docutils literal">addIndent()</tt> method pushes the next indent on the context stack
using an increment to the previous indent.</p>
<p>When tangling, a &quot;previous&quot; value is set from the indent left over from the
previous command. This allows <tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt> references to be indented
properly. A tangle must track all nested <tt class="docutils literal">&#64;d</tt> contexts to create a proper
global indent.</p>
<p>Weaving, however, is entirely localized to the block of code. There's no
real context tracking. Just &quot;lastIndent&quot; from the previous command's <tt class="docutils literal">codeBlock()</tt>.</p>
<p>The <tt class="docutils literal">setIndent()</tt> pushes a fixed indent instead adding an increment.</p>
<p>The <tt class="docutils literal">clrIndent()</tt> method discards the most recent indent from the context stack.
This is used when finished
tangling a source chunk.  This restores the indent to the prevailing indent.</p>
<p>The <tt class="docutils literal">readdIndent()</tt> method removes all indent context information and resets the indent
to a default.</p>
<p>Weaving may use an initial offset.
It's an additional indent for woven code; not used for tangled code. In particular, RST
requires this. <tt class="docutils literal">readdIndent()</tt> uses this initial offset for weaving.</p>
<p class="rubric" id="target-11">Emitter indent control: set, clear and reset (11) =</p>
<pre class="code literal-block">
def addIndent(self, increment: int) -&gt; None:
    self.lastIndent = self.context[-1]+increment
    self.context.append(self.lastIndent)
    self.log_indent.debug(&quot;addIndent %d: %r&quot;, increment, self.context)

def setIndent(self, indent: int) -&gt; None:
    self.context.append(indent)
    self.lastIndent = self.context[-1]
    self.log_indent.debug(&quot;setIndent %d: %r&quot;, indent, self.context)

def clrIndent(self) -&gt; None:
    if len(self.context) &gt; 1:
        self.context.pop()
    self.lastIndent = self.context[-1]
    self.log_indent.debug(&quot;clrIndent %r&quot;, self.context)

def readdIndent(self, indent: int = 0) -&gt; None:
    &quot;&quot;&quot;Resets the indentation context.&quot;&quot;&quot;
    self.lastIndent = indent
    self.context = [self.lastIndent]
    self.log_indent.debug(&quot;readdIndent %d: %r&quot;, indent, self.context)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Emitter indent control: set, clear and reset (11)</em>. Used by: Emitter superclass (<a class="reference internal" href="#target-4">4</a>)</p>
</blockquote>
</div>
<div class="section" id="weaver-subclass-of-emitter">
<h3><a class="toc-backref" href="#toc-entry-32">Weaver subclass of Emitter</a></h3>
<p>A Weaver is an Emitter that produces the final user-focused document.
This will include the source document with the code blocks surrounded by
markup to present that code properly.  In effect, the <strong>py-web-tool</strong>  <tt class="docutils literal">&#64;</tt> commands
are replaced by markup.</p>
<p>The Weaver class uses a simple set of templates to product RST markup as the default
Subclasses can introduce other templates to produce HTML or LaTeX output.</p>
<p>Most Weaver languages don't rely on special indentation rules.
The woven code samples usually start right on the left margin of
the source document.  However, the RST markup language does rely
on extra indentation of code blocks.  For that reason, the weavers
have an additional indent for code blocks.  This is generally
set to zero, except when generating RST where 4 spaces is good.</p>
<p>The <tt class="docutils literal">Weaver</tt> subclass extends an <tt class="docutils literal">Emitter</tt> to <strong>weave</strong> the final
documentation.  This involves decorating source code to make it
displayable.  It also involves creating references and cross
references among the various chunks.</p>
<p>The <tt class="docutils literal">Weaver</tt> class adds several methods to the basic <tt class="docutils literal">Emitter</tt> methods.  These
additional methods are also included that are used exclusively when weaving, never when tangling.</p>
<p>This class hierarch depends heavily on the <tt class="docutils literal">string</tt> module.</p>
<p>Class-level variables include the following</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">extension:</th><td class="field-body">The Path's suffix used by this weaver.</td>
</tr>
<tr class="field"><th class="field-name">code_indent:</th><td class="field-body">The number of spaces to indent code to separate code blocks from
surrounding text. Mostly this is used by RST where a non-zero value
is required.</td>
</tr>
<tr class="field"><th class="field-name">header:</th><td class="field-body">Any additional header material this weaver requires.</td>
</tr>
</tbody>
</table>
<p>Instance-level configuration values:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">reference_style:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">Either an instance of <tt class="docutils literal">TransitiveReference()</tt> or <tt class="docutils literal">SimpleReference()</tt></td>
</tr>
</tbody>
</table>
<p class="rubric" id="target-12">Imports (12) +=</p>
<pre class="code literal-block">
import string
from textwrap import dedent
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (12)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p class="rubric" id="target-13">Weaver subclass of Emitter to create documentation (13) =</p>
<pre class="code literal-block">
class Weaver(Emitter):
    &quot;&quot;&quot;Format various types of XRef's and code blocks when weaving.

    For RST format we splice in the following two lines
    ::

        ..  include:: &lt;isoamsa.txt&gt;
        ..  include:: &lt;isopub.txt&gt;
    &quot;&quot;&quot;
    extension = &quot;.rst&quot;
    code_indent = 4
    header = &quot;&quot;&quot;\n..  include:: &lt;isoamsa.txt&gt;\n..  include:: &lt;isopub.txt&gt;\n&quot;&quot;&quot;

    reference_style : &quot;Reference&quot;

    def __init__(self) -&gt; None:
        super().__init__()

    →Weaver doOpen, doClose and addIndent overrides (<a class="reference internal" href="#target-14">14</a>)

    # Template Expansions.

    →Weaver quoted characters (<a class="reference internal" href="#target-15">15</a>)
    →Weaver document chunk begin-end (<a class="reference internal" href="#target-16">16</a>)
    →Weaver reference summary, used by code chunk and file chunk (<a class="reference internal" href="#target-17">17</a>)
    →Weaver code chunk begin-end (<a class="reference internal" href="#target-18">18</a>)
    →Weaver file chunk begin-end (<a class="reference internal" href="#target-19">19</a>)
    →Weaver reference command output (<a class="reference internal" href="#target-20">20</a>)
    →Weaver cross reference output methods (<a class="reference internal" href="#target-21">21</a>), →(<a class="reference internal" href="#target-22">22</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver subclass of Emitter to create documentation (13)</em>. Used by: Emitter class hierarchy... (<a class="reference internal" href="#target-2">2</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">doOpen()</tt> method opens the file for writing.  For weavers, the file extension
is specified part of the target markup language being created.</p>
<p>The <tt class="docutils literal">doClose()</tt> method extends the <tt class="docutils literal">Emitter</tt> class <tt class="docutils literal">close()</tt> method by closing the
actual file created by the open() method.</p>
<p>The <tt class="docutils literal">addIndent()</tt> reflects the fact that we're not tracking global indents, merely
the local indentation required to weave a code chunk. The &quot;indent&quot; can vary because
we're not always starting a fresh line with <tt class="docutils literal">weaveReferenceTo()</tt>.</p>
<p class="rubric" id="target-14">Weaver doOpen, doClose and addIndent overrides (14) =</p>
<pre class="code literal-block">
def doOpen(self, basename: Path) -&gt; None:
    self.filePath = basename.with_suffix(self.extension)
    self.logger.info(&quot;Weaving %r&quot;, self.filePath)
    self.theFile = self.filePath.open(&quot;w&quot;)
    self.readdIndent(self.code_indent)

def doClose(self) -&gt; None:
    self.theFile.close()
    self.logger.info(&quot;Wrote %d lines to %r&quot;, self.linesWritten, self.filePath)

def addIndent(self, increment: int = 0) -&gt; None:
    &quot;&quot;&quot;increment not used when weaving&quot;&quot;&quot;
    self.context.append(self.context[-1])
    self.log_indent.debug(&quot;addIndent %d: %r&quot;, self.lastIndent, self.context)

def codeFinish(self) -&gt; None:
    pass # Not needed when weaving
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver doOpen, doClose and addIndent overrides (14)</em>. Used by: Weaver subclass of Emitter... (<a class="reference internal" href="#target-13">13</a>)</p>
</blockquote>
<p>The following list of markup escapes for RST may not be <strong>all</strong> that are requiresd.
The general template for cude uses <tt class="docutils literal"><span class="pre">parsed-literal</span></tt>
directive because it can include links comingled with the code.
We have to quote certain inline markup -- but only when the
characters are paired in a way that might confuse RST.</p>
<p>We could use patterns like <tt class="docutils literal"><span class="pre">`.*?`</span></tt>, <tt class="docutils literal"><span class="pre">_.*?_</span></tt>, <tt class="docutils literal"><span class="pre">\*.*?\*</span></tt>, and <tt class="docutils literal"><span class="pre">\|.*?\|</span></tt>
to look for paired RST inline markup and quote just these special character occurrences.</p>
<p class="rubric" id="target-15">Weaver quoted characters (15) =</p>
<pre class="code literal-block">
# Prevent some RST markup from being recognized (and processed) in code.
quoted_chars: list[tuple[str, str]] = [
    ('\\', r'\\'), # Must be first.
    ('`', r'\`'),
    ('_', r'\_'),
    ('*', r'\*'),
    ('|', r'\|'),
]
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver quoted characters (15)</em>. Used by: Weaver subclass of Emitter... (<a class="reference internal" href="#target-13">13</a>)</p>
</blockquote>
<p>The remaining methods apply a chunk to a template.</p>
<p>The <tt class="docutils literal">docBegin()</tt> and <tt class="docutils literal">docEnd()</tt>
methods are used when weaving a document text chunk.
Typically, nothing is done before emitting these kinds of chunks.
However, putting a <tt class="docutils literal">.. line line number</tt> RST comment is an example
of possible additional processing.</p>
<p class="rubric" id="target-16">Weaver document chunk begin-end (16) =</p>
<pre class="code literal-block">
def docBegin(self, aChunk: Chunk) -&gt; None:
    pass

def docEnd(self, aChunk: Chunk) -&gt; None:
    pass
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver document chunk begin-end (16)</em>. Used by: Weaver subclass of Emitter... (<a class="reference internal" href="#target-13">13</a>)</p>
</blockquote>
<p>Each code chunk includes the places where the chunk is referenced.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>This may be one of the rare places where <tt class="docutils literal"><span class="pre">for...</span> else:</tt> could be the correct statement.</p>
<p class="last">Currently, something more complex is used.</p>
</div>
<p class="rubric" id="target-17">Weaver reference summary, used by code chunk and file chunk (17) =</p>
<pre class="code literal-block">
ref_template = string.Template(&quot;${refList}&quot;)
ref_separator = &quot;; &quot;
ref_item_template = string.Template(&quot;$fullName (`${seq}`_)&quot;)

def references(self, aChunk: Chunk) -&gt; str:
    references = aChunk.references(self)
    if len(references) != 0:
        refList = [
            self.ref_item_template.substitute(seq=s, fullName=n)
            for n,s in references ]
        return self.ref_template.substitute(refList=self.ref_separator.join(refList))
    else:
        return &quot;&quot;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver reference summary, used by code chunk and file chunk (17)</em>. Used by: Weaver subclass of Emitter... (<a class="reference internal" href="#target-13">13</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">codeBegin()</tt> method emits the necessary material prior to
a chunk of source code, defined with the <tt class="docutils literal">&#64;d</tt> command.</p>
<p>The <tt class="docutils literal">codeEnd()</tt> method emits the necessary material subsequent to
a chunk of source code, defined with the <tt class="docutils literal">&#64;d</tt> command.
Links or cross references to chunks that
refer to this chunk can be emitted.</p>
<p class="rubric" id="target-18">Weaver code chunk begin-end (18) =</p>
<pre class="code literal-block">
cb_template = string.Template(&quot;\n..  _`${seq}`:\n..  rubric:: ${fullName} (${seq}) ${concat}\n..  parsed-literal::\n    :class: code\n\n&quot;)

def codeBegin(self, aChunk: Chunk) -&gt; None:
    txt = self.cb_template.substitute(
        seq=aChunk.seq,
        lineNumber=aChunk.lineNumber,
        fullName=aChunk.fullName,
        concat=&quot;=&quot; if aChunk.initial else &quot;+=&quot;,
    )
    self.write(txt)

ce_template = string.Template(&quot;\n..\n\n    ..  class:: small\n\n        |loz| *${fullName} (${seq})*. Used by: ${references}\n&quot;)

def codeEnd(self, aChunk: Chunk) -&gt; None:
    txt = self.ce_template.substitute(
        seq = aChunk.seq,
        lineNumber = aChunk.lineNumber,
        fullName = aChunk.fullName,
        references = self.references(aChunk),
    )
    self.write(txt)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver code chunk begin-end (18)</em>. Used by: Weaver subclass of Emitter... (<a class="reference internal" href="#target-13">13</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">fileBegin()</tt> method emits the necessary material prior to
a chunk of source code, defined with the <tt class="docutils literal">&#64;o</tt> command.
A subclass would override this to provide specific text
for the intended file type.</p>
<p>The <tt class="docutils literal">fileEnd()</tt> method emits the necessary material subsequent to
a chunk of source code, defined with the <tt class="docutils literal">&#64;o</tt> command.</p>
<p>There shouldn't be a list of references to a file. We assert that this
list is always empty.</p>
<p class="rubric" id="target-19">Weaver file chunk begin-end (19) =</p>
<pre class="code literal-block">
fb_template = string.Template(&quot;\n..  _`${seq}`:\n..  rubric:: ${fullName} (${seq}) ${concat}\n..  parsed-literal::\n    :class: code\n\n&quot;)

def fileBegin(self, aChunk: Chunk) -&gt; None:
    txt = self.fb_template.substitute(
        seq=aChunk.seq,
        lineNumber=aChunk.lineNumber,
        fullName=aChunk.fullName,
        concat=&quot;=&quot; if aChunk.initial else &quot;+=&quot;,
    )
    self.write(txt)

fe_template = string.Template(&quot;\n..\n\n    ..  class:: small\n\n        |loz| *${fullName} (${seq})*.\n&quot;)

def fileEnd(self, aChunk: Chunk) -&gt; None:
    assert len(self.references(aChunk)) == 0
    txt = self.fe_template.substitute(
        seq=aChunk.seq,
        lineNumber=aChunk.lineNumber,
        fullName=aChunk.fullName,
        references=[])
    self.write(txt)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver file chunk begin-end (19)</em>. Used by: Weaver subclass of Emitter... (<a class="reference internal" href="#target-13">13</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">referenceTo()</tt> method emits a reference to
a chunk of source code.  There reference is made with a
<tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt> reference  within a <tt class="docutils literal">&#64;d</tt> or <tt class="docutils literal">&#64;o</tt> chunk.
The references are defined with the <tt class="docutils literal">&#64;d</tt> or <tt class="docutils literal">&#64;o</tt> commands.
A subclass would override this to provide specific text
for the intended file type.</p>
<p>The <tt class="docutils literal">referenceSep()</tt> method emits a separator to be used
in a sequence of references. It's usually a <tt class="docutils literal">&quot;, &quot;</tt>, but that might be changed to
a simple <tt class="docutils literal">&quot; &quot;</tt> because it looks better.</p>
<p class="rubric" id="target-20">Weaver reference command output (20) =</p>
<pre class="code literal-block">
refto_name_template = string.Template(r&quot;|srarr|\ ${fullName} (`${seq}`_)&quot;)
refto_seq_template = string.Template(&quot;|srarr|\ (`${seq}`_)&quot;)
refto_seq_separator = &quot;, &quot;

def referenceTo(self, aName: str | None, seq: int) -&gt; str:
    &quot;&quot;&quot;Weave a reference to a chunk.
    Provide name to get a full reference.
    name=None to get a short reference.&quot;&quot;&quot;
    if aName:
        return self.refto_name_template.substitute(fullName=aName, seq=seq)
    else:
        return self.refto_seq_template.substitute(seq=seq)

def referenceSep(self) -&gt; str:
    &quot;&quot;&quot;Separator between references.&quot;&quot;&quot;
    return self.refto_seq_separator
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver reference command output (20)</em>. Used by: Weaver subclass of Emitter... (<a class="reference internal" href="#target-13">13</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">xrefHead()</tt> method puts decoration in front of cross-reference
output.  A subclass may override this to change the look of the final
woven document.</p>
<p>The <tt class="docutils literal">xrefFoot()</tt> method puts decoration after cross-reference
output.  A subclass may override this to change the look of the final
woven document.</p>
<p>The <tt class="docutils literal">xrefLine()</tt> method is used for both
file and chunk (&quot;macro&quot;) cross-references to show a name (either file name
or chunk name) and a list of chunks that reference the file or chunk.</p>
<p>The <tt class="docutils literal">xrefDefLine()</tt> method is used for the user identifier cross-reference.
This shows a name and a list of chunks that
reference or define the name.  One of the chunks is identified as the
defining chunk, all others are referencing chunks.</p>
<p>An <tt class="docutils literal">xrefEmpty()</tt> is used in the rare case of no user identifiers present.</p>
<p>The default behavior simply writes the Python data structure used
to represent cross reference information.  A subclass may override this
to change the look of the final woven document.</p>
<p class="rubric" id="target-21">Weaver cross reference output methods (21) =</p>
<pre class="code literal-block">
xref_head_template = string.Template(&quot;\n&quot;)
xref_foot_template = string.Template(&quot;\n&quot;)
xref_item_template = string.Template(&quot;:${fullName}:\n    ${refList}\n&quot;)
xref_empty_template = string.Template(&quot;(None)\n&quot;)

def xrefHead(self) -&gt; None:
    txt = self.xref_head_template.substitute()
    self.write(txt)

def xrefFoot(self) -&gt; None:
    txt = self.xref_foot_template.substitute()
    self.write(txt)

def xrefLine(self, name: str, refList: list[int]) -&gt; None:
    refList_txt = [self.referenceTo(None, r) for r in refList]
    txt = self.xref_item_template.substitute(fullName=name, refList = &quot; &quot;.join(refList_txt)) # RST Separator
    self.write(txt)

def xrefEmpty(self) -&gt; None:
    self.write(self.xref_empty_template.substitute())
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver cross reference output methods (21)</em>. Used by: Weaver subclass of Emitter... (<a class="reference internal" href="#target-13">13</a>)</p>
</blockquote>
<p>Cross-reference definition line</p>
<p class="rubric" id="target-22">Weaver cross reference output methods (22) +=</p>
<pre class="code literal-block">
name_def_template = string.Template('[`${seq}`_]')
name_ref_template = string.Template('`${seq}`_')

def xrefDefLine(self, name: str, defn: int, refList: list[int]) -&gt; None:
    &quot;&quot;&quot;Special template for the definition, default reference for all others.&quot;&quot;&quot;
    templates = {defn: self.name_def_template}
    refTxt = [
        templates.get(r, self.name_ref_template).substitute(seq=r)
        for r in sorted(refList + [defn])
    ]
    # Generic space separator
    txt = self.xref_item_template.substitute(fullName=name, refList=&quot; &quot;.join(refTxt))
    self.write(txt)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Weaver cross reference output methods (22)</em>. Used by: Weaver subclass of Emitter... (<a class="reference internal" href="#target-13">13</a>)</p>
</blockquote>
</div>
<div class="section" id="rst-subclass-of-weaver">
<h3><a class="toc-backref" href="#toc-entry-33">RST subclass of Weaver</a></h3>
<p>A degenerate case: the base <tt class="docutils literal">Weaver</tt> class does <tt class="docutils literal">RST</tt>.
Using this class name slightly simplifies the configuration and makes the output
look a little nicer.</p>
<p class="rubric" id="target-23">RST subclass of Weaver (23) =</p>
<pre class="code literal-block">
class RST(Weaver):
    pass
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>RST subclass of Weaver (23)</em>. Used by: Emitter class hierarchy... (<a class="reference internal" href="#target-2">2</a>)</p>
</blockquote>
</div>
<div class="section" id="latex-subclass-of-weaver">
<h3><a class="toc-backref" href="#toc-entry-34">LaTeX subclass of Weaver</a></h3>
<p>Experimental, at best.</p>
<p>An instance of <tt class="docutils literal">LaTeX</tt> can be used by the <tt class="docutils literal">Web</tt> object to
weave an output document.  The instance is created outside the Web, and
given to the <tt class="docutils literal">weave()</tt> method of the Web.</p>
<pre class="literal-block">
w = Web()
WebReader().load(w, &quot;somefile.w&quot;)
weave_latex = LaTeX()
w.weave(weave_latex)
</pre>
<p>Note that the template language and LaTeX both use <tt class="docutils literal">$</tt>.
This means that all  <tt class="docutils literal">$</tt> that are intended to be output to LaTeX
must appear as <tt class="docutils literal">$$</tt> in the template.</p>
<p>The <tt class="docutils literal">LaTeX</tt> subclass defines a Weaver that is customized to
produce LaTeX output of code sections and cross reference information.
Its markup is pretty rudimentary, but it's also distinctive enough to
function pretty well in most L!sub:<cite>A</cite>T!sub:<cite>E</cite>X documents.</p>
<p class="rubric" id="target-24">LaTeX subclass of Weaver (24) =</p>
<pre class="code literal-block">
class LaTeX(Weaver):
    &quot;&quot;&quot;LaTeX formatting for XRef's and code blocks when weaving.
    Requires ``\\usepackage{fancyvrb}``
    &quot;&quot;&quot;
    extension = &quot;.tex&quot;
    code_indent = 0
    header = &quot;&quot;&quot;\n\\usepackage{fancyvrb}\n&quot;&quot;&quot;

    →LaTeX code chunk begin (<a class="reference internal" href="#target-25">25</a>)
    →LaTeX code chunk end (<a class="reference internal" href="#target-26">26</a>)
    →LaTeX file output begin (<a class="reference internal" href="#target-27">27</a>)
    →LaTeX file output end (<a class="reference internal" href="#target-28">28</a>)
    →LaTeX references summary at the end of a chunk (<a class="reference internal" href="#target-29">29</a>)
    →LaTeX write a line of code (<a class="reference internal" href="#target-30">30</a>)
    →LaTeX reference to a chunk (<a class="reference internal" href="#target-31">31</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LaTeX subclass of Weaver (24)</em>. Used by: Emitter class hierarchy... (<a class="reference internal" href="#target-2">2</a>)</p>
</blockquote>
<p>The LaTeX <tt class="docutils literal">open()</tt> method opens the woven file by replacing the
source file's suffix with <tt class="docutils literal">&quot;.tex&quot;</tt> and creating the resulting file.</p>
<p>The LaTeX <tt class="docutils literal">codeBegin()</tt> template writes the header prior to a
chunk of source code.  It aligns the block to the left, prints an
italicised header, and opens a preformatted block.</p>
<p>There's no leading <tt class="docutils literal">\n</tt> -- we're trying to avoid an indent when weaving.</p>
<p class="rubric" id="target-25">LaTeX code chunk begin (25) =</p>
<pre class="code literal-block">
cb_template = string.Template(
&quot;&quot;&quot;\\label{pyweb${seq}}
\\begin{flushleft}
\\textit{Code example ${fullName} (${seq})}
\\begin{Verbatim}[commandchars=\\\\\\{\\},codes={\\catcode`$$=3\\catcode`^=7},frame=single]\n&quot;&quot;&quot;
)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LaTeX code chunk begin (25)</em>. Used by: LaTeX subclass... (<a class="reference internal" href="#target-24">24</a>)</p>
</blockquote>
<p>The LaTeX <tt class="docutils literal">codeEnd()</tt> template writes the trailer subsequent to
a chunk of source code.  This first closes the preformatted block and
then calls the <tt class="docutils literal">references()</tt> method to write a reference
to the chunk that invokes this chunk; finally, it restores paragraph
indentation.</p>
<p class="rubric" id="target-26">LaTeX code chunk end (26) =</p>
<pre class="code literal-block">
ce_template = string.Template(&quot;&quot;&quot;
\\end{Verbatim}
${references}
\\end{flushleft}\n&quot;&quot;&quot;)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LaTeX code chunk end (26)</em>. Used by: LaTeX subclass... (<a class="reference internal" href="#target-24">24</a>)</p>
</blockquote>
<p>The LaTeX <tt class="docutils literal">fileBegin()</tt> template writes the header prior to a
the creation of a tangled file.  Its formatting is identical to the
start of a code chunk.</p>
<p class="rubric" id="target-27">LaTeX file output begin (27) =</p>
<pre class="code literal-block">
fb_template = cb_template
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LaTeX file output begin (27)</em>. Used by: LaTeX subclass... (<a class="reference internal" href="#target-24">24</a>)</p>
</blockquote>
<p>The LaTeX <tt class="docutils literal">fileEnd()</tt> template writes the trailer subsequent to
a tangled file.  This closes the preformatted block, calls the LaTeX
<tt class="docutils literal">references()</tt> method to write a reference to the chunk that
invokes this chunk, and restores normal indentation.</p>
<p class="rubric" id="target-28">LaTeX file output end (28) =</p>
<pre class="code literal-block">
fe_template = ce_template
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LaTeX file output end (28)</em>. Used by: LaTeX subclass... (<a class="reference internal" href="#target-24">24</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">references()</tt> template writes a list of references after a
chunk of code.  Each reference includes the example number, the title,
and a reference to the LaTeX section and page numbers on which the
referring block appears.</p>
<p class="rubric" id="target-29">LaTeX references summary at the end of a chunk (29) =</p>
<pre class="code literal-block">
ref_item_template = string.Template(&quot;&quot;&quot;
\\item Code example ${fullName} (${seq}) (Sect. \\ref{pyweb${seq}}, p. \\pageref{pyweb${seq}})\n&quot;&quot;&quot;)

ref_template = string.Template(&quot;&quot;&quot;
\\footnotesize
Used by:
\\begin{list}{}{}
${refList}
\\end{list}
\\normalsize\n&quot;&quot;&quot;)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LaTeX references summary at the end of a chunk (29)</em>. Used by: LaTeX subclass... (<a class="reference internal" href="#target-24">24</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">quote()</tt> method quotes a single line of code to the
weaver; since these lines are always in preformatted blocks, no
special formatting is needed, except to avoid ending the preformatted
block.  Our one compromise is a thin space if the phrase
<tt class="docutils literal">\\end{Verbatim}</tt> is used in a code block.</p>
<p class="rubric" id="target-30">LaTeX write a line of code (30) =</p>
<pre class="code literal-block">
quoted_chars: list[tuple[str, str]] = [
    (&quot;\\end{Verbatim}&quot;, &quot;\\end\,{Verbatim}&quot;),  # Allow \end{Verbatim} in a Verbatim context
    (&quot;\\{&quot;, &quot;\\\,{&quot;), # Prevent unexpected commands in Verbatim
    (&quot;$&quot;, &quot;\\$&quot;), # Prevent unexpected math in Verbatim
]
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LaTeX write a line of code (30)</em>. Used by: LaTeX subclass... (<a class="reference internal" href="#target-24">24</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">referenceTo()</tt> template writes a reference to another chunk of
code.  It uses write directly as to follow the current indentation on
the current line of code.</p>
<p class="rubric" id="target-31">LaTeX reference to a chunk (31) =</p>
<pre class="code literal-block">
refto_name_template = string.Template(&quot;&quot;&quot;$$\\triangleright$$ Code Example ${fullName} (${seq})&quot;&quot;&quot;)

refto_seq_template = string.Template(&quot;&quot;&quot;(${seq})&quot;&quot;&quot;)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LaTeX reference to a chunk (31)</em>. Used by: LaTeX subclass... (<a class="reference internal" href="#target-24">24</a>)</p>
</blockquote>
</div>
<div class="section" id="html-subclasses-of-weaver">
<h3><a class="toc-backref" href="#toc-entry-35">HTML subclasses of Weaver</a></h3>
<p>An instance of <tt class="docutils literal">HTML</tt> can be used by the <tt class="docutils literal">Web</tt> object to
weave an output document.  The instance is created outside the Web, and
given to the <tt class="docutils literal">weave()</tt> method of the Web.</p>
<pre class="literal-block">
w = Web()
WebReader().load(w,&quot;somefile.w&quot;)
weave_html = HTML()
w.weave(weave_html)
</pre>
<p>Variations in the output formatting are accomplished by having
variant subclasses of HTML.  In this implementation, we have two
variations: full path references, and short references.  The base class
produces complete reference paths; a subclass produces abbreviated references.</p>
<p>The <tt class="docutils literal">HTML</tt> subclass defines a Weaver that is customized to
produce HTML output of code sections and cross reference information.</p>
<p>All HTML chunks are identified by anchor names of the form <tt class="docutils literal">pyweb*n*</tt>.  Each
<em>n</em> is the unique chunk number, in sequential order.</p>
<p>An <tt class="docutils literal">HTMLShort</tt> subclass defines a Weaver that produces HTML output
with abbreviated (no name) cross references at the end of the chunk.</p>
<p class="rubric" id="target-32">HTML subclass of Weaver (32) =</p>
<pre class="code literal-block">
class HTML(Weaver):
    &quot;&quot;&quot;HTML formatting for XRef's and code blocks when weaving.&quot;&quot;&quot;
    extension = &quot;.html&quot;
    code_indent = 0
    header = &quot;&quot;

    →HTML code chunk begin (<a class="reference internal" href="#target-34">34</a>)
    →HTML code chunk end (<a class="reference internal" href="#target-35">35</a>)
    →HTML output file begin (<a class="reference internal" href="#target-36">36</a>)
    →HTML output file end (<a class="reference internal" href="#target-37">37</a>)
    →HTML references summary at the end of a chunk (<a class="reference internal" href="#target-38">38</a>)
    →HTML write a line of code (<a class="reference internal" href="#target-39">39</a>)
    →HTML reference to a chunk (<a class="reference internal" href="#target-40">40</a>)
    →HTML simple cross reference markup (<a class="reference internal" href="#target-41">41</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML subclass of Weaver (32)</em>. Used by: Emitter class hierarchy... (<a class="reference internal" href="#target-2">2</a>)</p>
</blockquote>
<p class="rubric" id="target-33">HTML subclass of Weaver (33) +=</p>
<pre class="code literal-block">
class HTMLShort(HTML):
    &quot;&quot;&quot;HTML formatting for XRef's and code blocks when weaving with short references.&quot;&quot;&quot;
    →HTML short references summary at the end of a chunk (<a class="reference internal" href="#target-43">43</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML subclass of Weaver (33)</em>. Used by: Emitter class hierarchy... (<a class="reference internal" href="#target-2">2</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">codeBegin()</tt> template starts a chunk of code, defined with <tt class="docutils literal">&#64;d</tt>, providing a label
and HTML tags necessary to set the code off visually.</p>
<p class="rubric" id="target-34">HTML code chunk begin (34) =</p>
<pre class="code literal-block">
cb_template = string.Template(&quot;&quot;&quot;
&lt;a name=&quot;pyweb${seq}&quot;&gt;&lt;/a&gt;
&lt;!--line number ${lineNumber}--&gt;
&lt;p&gt;&lt;em&gt;${fullName}&lt;/em&gt; (${seq})&amp;nbsp;${concat}&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;\n&quot;&quot;&quot;)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML code chunk begin (34)</em>. Used by: HTML subclass... (<a class="reference internal" href="#target-32">32</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">codeEnd()</tt> template ends a chunk of code, providing a HTML tags necessary
to finish the code block visually.  This calls the references method to
write the list of chunks that reference this chunk.</p>
<p class="rubric" id="target-35">HTML code chunk end (35) =</p>
<pre class="code literal-block">
ce_template = string.Template(&quot;&quot;&quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;loz; &lt;em&gt;${fullName}&lt;/em&gt; (${seq}).
${references}
&lt;/p&gt;\n&quot;&quot;&quot;)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML code chunk end (35)</em>. Used by: HTML subclass... (<a class="reference internal" href="#target-32">32</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">fileBegin()</tt> template starts a chunk of code, defined with <tt class="docutils literal">&#64;o</tt>, providing a label
and HTML tags necessary to set the code off visually.</p>
<p class="rubric" id="target-36">HTML output file begin (36) =</p>
<pre class="code literal-block">
fb_template = string.Template(&quot;&quot;&quot;&lt;a name=&quot;pyweb${seq}&quot;&gt;&lt;/a&gt;
&lt;!--line number ${lineNumber}--&gt;
&lt;p&gt;``${fullName}`` (${seq})&amp;nbsp;${concat}&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;\n&quot;&quot;&quot;) # Prevent indent
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML output file begin (36)</em>. Used by: HTML subclass... (<a class="reference internal" href="#target-32">32</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">fileEnd()</tt> template ends a chunk of code, providing a HTML tags necessary
to finish the code block visually.  This calls the references method to
write the list of chunks that reference this chunk.</p>
<p class="rubric" id="target-37">HTML output file end (37) =</p>
<pre class="code literal-block">
fe_template = string.Template( &quot;&quot;&quot;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&amp;loz; ``${fullName}`` (${seq}).
${references}
&lt;/p&gt;\n&quot;&quot;&quot;)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML output file end (37)</em>. Used by: HTML subclass... (<a class="reference internal" href="#target-32">32</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">references()</tt> template writes the list of chunks that refer to this chunk.
Note that this list could be rather long because of the possibility of
transitive references.</p>
<p class="rubric" id="target-38">HTML references summary at the end of a chunk (38) =</p>
<pre class="code literal-block">
ref_item_template = string.Template('&lt;a href=&quot;#pyweb${seq}&quot;&gt;&lt;em&gt;${fullName}&lt;/em&gt;&amp;nbsp;(${seq})&lt;/a&gt;')

ref_template = string.Template('  Used by ${refList}.')
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML references summary at the end of a chunk (38)</em>. Used by: HTML subclass... (<a class="reference internal" href="#target-32">32</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">quote()</tt> method quotes an individual line of code for HTML purposes.
This encodes the four basic HTML entities (<tt class="docutils literal">&lt;</tt>, <tt class="docutils literal">&gt;</tt>, <tt class="docutils literal">&amp;</tt>, <tt class="docutils literal">&quot;</tt>) to prevent code from being interpreted
as HTML.</p>
<p class="rubric" id="target-39">HTML write a line of code (39) =</p>
<pre class="code literal-block">
quoted_chars: list[tuple[str, str]] = [
    (&quot;&amp;&quot;, &quot;&amp;amp;&quot;),  # Must be first
    (&quot;&lt;&quot;, &quot;&amp;lt;&quot;),
    (&quot;&gt;&quot;, &quot;&amp;gt;&quot;),
    ('&quot;', &quot;&amp;quot;&quot;),
]
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML write a line of code (39)</em>. Used by: HTML subclass... (<a class="reference internal" href="#target-32">32</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">referenceTo()</tt> template writes a reference to another chunk.  It uses the
direct <tt class="docutils literal">write()</tt> method so that the reference is indented properly with the
surrounding source code.</p>
<p class="rubric" id="target-40">HTML reference to a chunk (40) =</p>
<pre class="code literal-block">
refto_name_template = string.Template('&lt;a href=&quot;#pyweb${seq}&quot;&gt;&amp;rarr;&lt;em&gt;${fullName}&lt;/em&gt; (${seq})&lt;/a&gt;')

refto_seq_template = string.Template('&lt;a href=&quot;#pyweb${seq}&quot;&gt;(${seq})&lt;/a&gt;')
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML reference to a chunk (40)</em>. Used by: HTML subclass... (<a class="reference internal" href="#target-32">32</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">xrefHead()</tt> method writes the heading for any of the cross reference blocks created by
<tt class="docutils literal">&#64;f</tt>, <tt class="docutils literal">&#64;m</tt>, or <tt class="docutils literal">&#64;u</tt>.  In this implementation, the cross references are simply unordered lists.</p>
<p>The <tt class="docutils literal">xrefFoot()</tt> method writes the footing for any of the cross reference blocks created by
<tt class="docutils literal">&#64;f</tt>, <tt class="docutils literal">&#64;m</tt>, or <tt class="docutils literal">&#64;u</tt>.  In this implementation, the cross references are simply unordered lists.</p>
<p>The <tt class="docutils literal">xrefLine()</tt> method writes a line for the file or macro cross reference blocks created by
<tt class="docutils literal">&#64;f</tt> or <tt class="docutils literal">&#64;m</tt>.  In this implementation, the cross references are simply unordered lists.</p>
<p class="rubric" id="target-41">HTML simple cross reference markup (41) =</p>
<pre class="code literal-block">
xref_head_template = string.Template(&quot;&lt;dl&gt;\n&quot;)
xref_foot_template = string.Template(&quot;&lt;/dl&gt;\n&quot;)
xref_item_template = string.Template(&quot;&lt;dt&gt;${fullName}&lt;/dt&gt;&lt;dd&gt;${refList}&lt;/dd&gt;\n&quot;)

→HTML write user id cross reference line (<a class="reference internal" href="#target-42">42</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML simple cross reference markup (41)</em>. Used by: HTML subclass... (<a class="reference internal" href="#target-32">32</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">xrefDefLine()</tt> method writes a line for the user identifier cross reference blocks created by
&#64;u.  In this implementation, the cross references are simply unordered lists.  The defining instance
is included in the correct order with the other instances, but is bold and marked with a bullet (&amp;bull;).</p>
<p class="rubric" id="target-42">HTML write user id cross reference line (42) =</p>
<pre class="code literal-block">
name_def_template = string.Template('&lt;a href=&quot;#pyweb${seq}&quot;&gt;&lt;b&gt;&amp;bull;${seq}&lt;/b&gt;&lt;/a&gt;')

name_ref_template = string.Template('&lt;a href=&quot;#pyweb${seq}&quot;&gt;${seq}&lt;/a&gt;')
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML write user id cross reference line (42)</em>. Used by: HTML simple cross reference markup (<a class="reference internal" href="#target-41">41</a>)</p>
</blockquote>
<p>The HTMLShort subclass enhances the HTML class to provide short
cross references.
The <tt class="docutils literal">references()</tt> method writes the list of chunks that refer to this chunk.
Note that this list could be rather long because of the possibility of
transitive references.</p>
<p class="rubric" id="target-43">HTML short references summary at the end of a chunk (43) =</p>
<pre class="code literal-block">
ref_item_template = string.Template('&lt;a href=&quot;#pyweb${seq}&quot;&gt;(${seq})&lt;/a&gt;')
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>HTML short references summary at the end of a chunk (43)</em>. Used by: HTML subclass... (<a class="reference internal" href="#target-33">33</a>)</p>
</blockquote>
</div>
<div class="section" id="tangler-subclass-of-emitter">
<h3><a class="toc-backref" href="#toc-entry-36">Tangler subclass of Emitter</a></h3>
<p>The <tt class="docutils literal">Tangler</tt> class is concrete, and can tangle source files.  An
instance of <tt class="docutils literal">Tangler</tt> is given to the <tt class="docutils literal">Web</tt> class <tt class="docutils literal">tangle()</tt> method.</p>
<pre class="literal-block">
w = Web()
WebReader().load(w,&quot;somefile.w&quot;)
t = Tangler()
w.tangle(t)
</pre>
<p>The <tt class="docutils literal">Tangler</tt> subclass extends an Emitter to <strong>tangle</strong> the various
program source files.  The superclass is used to simply emit correctly indented
source code and do very little else that could corrupt or alter the output.</p>
<p>Language-specific subclasses could be used to provide additional decoration.
For example, inserting <tt class="docutils literal">#line</tt> directives showing the line number
in the original source file.</p>
<p>For Python, where indentation matters, the indent rules are relatively
simple.  The whitespace berfore a <tt class="docutils literal">&#64;&lt;</tt> command is preserved as
the prevailing indent for the block tangled as a replacement for the  <tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt>.</p>
<p>There are three configurable values:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">comment_start:</th><td class="field-body">If not None, this is the leading character for a line-number comment</td>
</tr>
<tr class="field"><th class="field-name">comment_end:</th><td class="field-body">This is the trailing character for a line-number comment</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">include_line_numbers:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">Show the source line numbers in the output via additional comments.</td>
</tr>
</tbody>
</table>
<p class="rubric" id="target-44">Tangler subclass of Emitter to create source files with no markup (44) =</p>
<pre class="code literal-block">
class Tangler(Emitter):
    &quot;&quot;&quot;Tangle output files.&quot;&quot;&quot;
    def __init__(self) -&gt; None:
        super().__init__()
        self.comment_start: str = &quot;#&quot;
        self.comment_end: str = &quot;&quot;
        self.include_line_numbers = False

    →Tangler doOpen, and doClose overrides (<a class="reference internal" href="#target-45">45</a>)
    →Tangler code chunk begin (<a class="reference internal" href="#target-46">46</a>)
    →Tangler code chunk end (<a class="reference internal" href="#target-47">47</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Tangler subclass of Emitter to create source files with no markup (44)</em>. Used by: Emitter class hierarchy... (<a class="reference internal" href="#target-2">2</a>)</p>
</blockquote>
<p>The default for all tanglers is to create the named file.
In order to handle paths, we will examine the file name for any <tt class="docutils literal">&quot;/&quot;</tt>
characters and perform the required <tt class="docutils literal">os.makedirs</tt> functions to
allow creation of files with a path.  We don't use Windows <tt class="docutils literal">&quot;\&quot;</tt>
characters, but rely on Python to handle this automatically.</p>
<p>This <tt class="docutils literal">doClose()</tt> method overrides the <tt class="docutils literal">Emitter</tt> class <tt class="docutils literal">doClose()</tt> method by closing the
actual file created by open.</p>
<p class="rubric" id="target-45">Tangler doOpen, and doClose overrides (45) =</p>
<pre class="code literal-block">
def checkPath(self) -&gt; None:
    self.filePath.parent.mkdir(parents=True, exist_ok=True)

def doOpen(self, aFile: Path) -&gt; None:
    self.filePath = aFile
    self.checkPath()
    self.theFile = self.filePath.open(&quot;w&quot;)
    self.logger.info(&quot;Tangling %r&quot;, aFile)
def doClose(self) -&gt; None:
    self.theFile.close()
    self.logger.info(&quot;Wrote %d lines to %r&quot;, self.linesWritten, self.filePath)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Tangler doOpen, and doClose overrides (45)</em>. Used by: Tangler subclass of Emitter... (<a class="reference internal" href="#target-44">44</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">codeBegin()</tt> method starts emitting a new chunk of code.
It does this by setting the Tangler's indent to the
prevailing indent at the start of the <tt class="docutils literal">&#64;&lt;</tt> reference command.</p>
<p class="rubric" id="target-46">Tangler code chunk begin (46) =</p>
<pre class="code literal-block">
def codeBegin(self, aChunk: Chunk) -&gt; None:
    self.log_indent.debug(&quot;&lt;tangle %r:&quot;, aChunk.fullName)
    if self.include_line_numbers:
        self.write(
            f&quot;\n{self.comment_start!s} Web: &quot;
            f&quot;{aChunk.filePath.name!s}:{aChunk.lineNumber!r} &quot;
            f&quot;{aChunk.fullName!s}({aChunk.seq:d}) {self.comment_end!s}\n&quot;
        )
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Tangler code chunk begin (46)</em>. Used by: Tangler subclass of Emitter... (<a class="reference internal" href="#target-44">44</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">codeEnd()</tt> method ends emitting a new chunk of code.
It does this by resetting the Tangler's indent to the previous
setting.</p>
<p class="rubric" id="target-47">Tangler code chunk end (47) =</p>
<pre class="code literal-block">
def codeEnd(self, aChunk: Chunk) -&gt; None:
    self.log_indent.debug(&quot;&gt;%r&quot;, aChunk.fullName)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Tangler code chunk end (47)</em>. Used by: Tangler subclass of Emitter... (<a class="reference internal" href="#target-44">44</a>)</p>
</blockquote>
</div>
<div class="section" id="tanglermake-subclass-of-tangler">
<h3><a class="toc-backref" href="#toc-entry-37">TanglerMake subclass of Tangler</a></h3>
<p>The <tt class="docutils literal">TanglerMake</tt> class is can tangle source files.  An
instance of <tt class="docutils literal">TanglerMake</tt> is given to the <tt class="docutils literal">Web</tt> class <tt class="docutils literal">tangle()</tt> method.</p>
<pre class="literal-block">
w = Web()
WebReader().load(w,&quot;somefile.w&quot;)
t = TanglerMake()
w.tangle(t)
</pre>
<p>The <tt class="docutils literal">TanglerMake</tt> subclass extends <tt class="docutils literal">Tangler</tt> to make the source files
more make-friendly.  This subclass of <tt class="docutils literal">Tangler</tt>
does not <strong>touch</strong> an output file
where there is no change.  This is helpful when <strong>py-web-tool</strong>'s output is
sent to <strong>make</strong>.  Using <tt class="docutils literal">TanglerMake</tt> assures that only files with real changes
are rewritten, minimizing recompilation of an application for changes to
the associated documentation.</p>
<p>This subclass of <tt class="docutils literal">Tangler</tt> changes how files
are opened and closed.</p>
<p class="rubric" id="target-48">Imports (48) +=</p>
<pre class="code literal-block">
import tempfile
import filecmp
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (48)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p class="rubric" id="target-49">TanglerMake subclass which is make-sensitive (49) =</p>
<pre class="code literal-block">
class TanglerMake(Tangler):
    &quot;&quot;&quot;Tangle output files, leaving files untouched if there are no changes.&quot;&quot;&quot;
    tempname : str
    def __init__(self, *args: Any) -&gt; None:
        super().__init__(*args)

    →TanglerMake doOpen override, using a temporary file (<a class="reference internal" href="#target-50">50</a>)

    →TanglerMake doClose override, comparing temporary to original (<a class="reference internal" href="#target-51">51</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>TanglerMake subclass which is make-sensitive (49)</em>. Used by: Emitter class hierarchy... (<a class="reference internal" href="#target-2">2</a>)</p>
</blockquote>
<p>A <tt class="docutils literal">TanglerMake</tt> creates a temporary file to collect the
tangled output.  When this file is completed, we can compare
it with the original file in this directory, avoiding
a &quot;touch&quot; if the new file is the same as the original.</p>
<p class="rubric" id="target-50">TanglerMake doOpen override, using a temporary file (50) =</p>
<pre class="code literal-block">
def doOpen(self, aFile: Path) -&gt; None:
    fd, self.tempname = tempfile.mkstemp(dir=os.curdir)
    self.theFile = os.fdopen(fd, &quot;w&quot;)
    self.logger.info(&quot;Tangling %r&quot;, aFile)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>TanglerMake doOpen override, using a temporary file (50)</em>. Used by: TanglerMake subclass... (<a class="reference internal" href="#target-49">49</a>)</p>
</blockquote>
<p>If there is a previous file: compare the temporary file and the previous file.</p>
<p>If there was no previous file or the files are different: rename temporary to replace previous;
else there was a previous file and the files were the same: unlink temporary and discard it.</p>
<p>This preserves the original (with the original date
and time) if nothing has changed.</p>
<p class="rubric" id="target-51">TanglerMake doClose override, comparing temporary to original (51) =</p>
<pre class="code literal-block">
def doClose(self) -&gt; None:
    self.theFile.close()
    try:
        same = filecmp.cmp(self.tempname, self.filePath)
    except OSError as e:
        same = False  # Doesn't exist. (Could check for errno.ENOENT)
    if same:
        self.logger.info(&quot;No change to %r&quot;, self.filePath)
        os.remove(self.tempname)
    else:
        # Windows requires the original file name be removed first.
        try:
            self.filePath.unlink()
        except OSError as e:
            pass  # Doesn't exist. (Could check for errno.ENOENT)
        self.checkPath()
        self.filePath.hardlink_to(self.tempname)  # type: ignore [attr-defined]
        os.remove(self.tempname)
        self.logger.info(&quot;Wrote %e lines to %s&quot;, self.linesWritten, self.filePath)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>TanglerMake doClose override, comparing temporary to original (51)</em>. Used by: TanglerMake subclass... (<a class="reference internal" href="#target-49">49</a>)</p>
</blockquote>
</div>
</div>
<div class="section" id="chunks">
<h2><a class="toc-backref" href="#toc-entry-38">Chunks</a></h2>
<p>A <tt class="docutils literal">Chunk</tt> is a piece of the input file.  It is a collection of <tt class="docutils literal">Command</tt> instances.
A chunk can be woven or tangled to create output.</p>
<p>The two most important methods are the <tt class="docutils literal">weave()</tt> and <tt class="docutils literal">tangle()</tt> methods.  These
visit the commands of this chunk, producing the required output file.</p>
<p>Additional methods (<tt class="docutils literal">startswith()</tt>, <tt class="docutils literal">searchForRE()</tt> and <tt class="docutils literal">usedBy()</tt>)
are used to examine the text of the <tt class="docutils literal">Command</tt> instances within
the chunk.</p>
<p>A <tt class="docutils literal">Chunk</tt> instance is created by the <tt class="docutils literal">WebReader</tt> as the input file is parsed.
Each <tt class="docutils literal">Chunk</tt> instance has one or more pieces of the original input text.
This text can be program source, a reference command, or the documentation source.</p>
<p class="rubric" id="target-52">Chunk class hierarchy - used to describe input chunks (52) =</p>
<pre class="code literal-block">
→Chunk class (<a class="reference internal" href="#target-53">53</a>)
→NamedChunk class (<a class="reference internal" href="#target-65">65</a>), →(<a class="reference internal" href="#target-70">70</a>)
→OutputChunk class (<a class="reference internal" href="#target-71">71</a>)
→NamedDocumentChunk class (<a class="reference internal" href="#target-75">75</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk class hierarchy - used to describe input chunks (52)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">Chunk</tt> class is both the superclass for this hierarchy and the implementation
for anonymous chunks.  An anonymous chunk is always documentation in the
target markup language.  No transformation is ever done on anonymous chunks.</p>
<p>A <tt class="docutils literal">NamedChunk</tt> is a chunk created with a <tt class="docutils literal">&#64;d</tt> command.
This is a chunk of source programming language, bracketed with <tt class="docutils literal">&#64;{</tt> and <tt class="docutils literal">&#64;}</tt>.</p>
<p>An <tt class="docutils literal">OutputChunk</tt> is a named chunk created with a <tt class="docutils literal">&#64;o</tt> command.
This must be a chunk of source programming language, bracketed with <tt class="docutils literal">&#64;{</tt> and <tt class="docutils literal">&#64;}</tt>.</p>
<p>A <tt class="docutils literal">NamedDocumentChunk</tt> is a named chunk created with a <tt class="docutils literal">&#64;d</tt> command.
This is a chunk of documentation in the target markup language,
bracketed with <tt class="docutils literal">&#64;[</tt> and <tt class="docutils literal">&#64;]</tt>.</p>
<div class="section" id="chunk-superclass">
<h3><a class="toc-backref" href="#toc-entry-39">Chunk Superclass</a></h3>
<p>An instance of the <tt class="docutils literal">Chunk</tt> class has a life that includes four important events:</p>
<ul class="simple">
<li>creation,</li>
<li>cross-reference,</li>
<li>weave,</li>
<li>and tangle.</li>
</ul>
<p>A <tt class="docutils literal">Chunk</tt> is created by a <tt class="docutils literal">WebReader</tt>, and associated with a <tt class="docutils literal">Web</tt>.
There are several web append methods, depending on the exact subclass of <tt class="docutils literal">Chunk</tt>.
The <tt class="docutils literal">WebReader</tt> calls the chunk's <tt class="docutils literal">webAdd()</tt> method select the correct method
for appending and indexing the chunk.
Individual instances of <tt class="docutils literal">Command</tt> are appended to the chunk.
The basic outline for creating a <tt class="docutils literal">Chunk</tt> instance is as follows:</p>
<pre class="literal-block">
w = Web()
c = Chunk()
c.webAdd(w)
c.append(<em>...some Command...</em>)
c.append(<em>...some Command...</em>)
</pre>
<p>Before weaving or tangling, a cross reference is created for all
user identifiers in all of the <tt class="docutils literal">Chunk</tt> instances.
This is done by: (1) visit each <tt class="docutils literal">Chunk</tt> and call the
<tt class="docutils literal">getUserIDRefs()</tt> method to gather all identifiers; (2) for each identifier,
visit each <tt class="docutils literal">Chunk</tt> and call the <tt class="docutils literal">searchForRE()</tt> method to find uses of
the identifier.</p>
<pre class="literal-block">
ident = []
for c in <em>the Web's named chunk list</em>:
    ident.extend(c.getUserIDRefs())
for i in ident:
    pattern = re.compile(f'\W{i!s}\W' )
    for c in <em>the Web's named chunk list</em>:
        c.searchForRE(pattern)
</pre>
<p>A <tt class="docutils literal">Chunk</tt> is woven or tangled by the <tt class="docutils literal">Web</tt>.  The basic outline for weaving is
as follows.  The tangling action is essentially the same.</p>
<pre class="literal-block">
for c in <em>the Web's chunk list</em>:
    c.weave(aWeaver)
</pre>
<p>The <tt class="docutils literal">Chunk</tt> class contains the overall definitions for all of the
various specialized subclasses.  In particular, it contains the <tt class="docutils literal">append()</tt>,
and <tt class="docutils literal">appendText()</tt> methods used by all of the various <tt class="docutils literal">Chunk</tt> subclasses.</p>
<p>When a <tt class="docutils literal">&#64;&#64;</tt> construct is located in the input stream, the stream contains
three text tokens: material before the <tt class="docutils literal">&#64;&#64;</tt>, the <tt class="docutils literal">&#64;&#64;</tt>,
and the material after the <tt class="docutils literal">&#64;&#64;</tt>.
These three tokens are reassembled into a single block of text.  This reassembly
is accomplished by changing the chunk's state so that the next <tt class="docutils literal">TextCommand</tt> is
appended onto the previous <tt class="docutils literal">TextCommand</tt>.</p>
<p>The <tt class="docutils literal">appendText()</tt> method either:</p>
<ul class="simple">
<li>appends to a previous <tt class="docutils literal">TextCommand</tt>  instance,</li>
<li>or finds that there are no commands at all, and creates an initial
<tt class="docutils literal">TextCommand</tt> instance,</li>
<li>or finds that the last <tt class="docutils literal">Command</tt> isn't a subclass of <tt class="docutils literal">TextCommand</tt>
and creates a <tt class="docutils literal">TextCommand</tt> instance.</li>
</ul>
<p>Each subclass of <tt class="docutils literal">Chunk</tt> has a particular type of text that it will process.  Anonymous chunks
only handle document text.  The <tt class="docutils literal">NamedChunk</tt> subclass that handles program source
will override this method to create a different command type.  The <tt class="docutils literal">makeContent()</tt> method
creates the appropriate <tt class="docutils literal">Command</tt> instance for this <tt class="docutils literal">Chunk</tt> subclass.</p>
<p>The <tt class="docutils literal">weave()</tt> method of an anonymous <tt class="docutils literal">Chunk</tt> uses the weaver's
<tt class="docutils literal">docBegin()</tt> and <tt class="docutils literal">docEnd()</tt>
methods to insert text that is source markup.  Other subclasses will override this to
use different <tt class="docutils literal">Weaver</tt> methods for different kinds of text.</p>
<p>A <tt class="docutils literal">Chunk</tt> has a <strong>Strategy</strong> object which is a subclass of <tt class="docutils literal">Reference</tt>.  This is
either an instance of <tt class="docutils literal">SimpleReference</tt> or <tt class="docutils literal">TransitiveReference</tt>.
A <tt class="docutils literal">SimpleRerence</tt> does no additional processing, and locates the proximate reference to
this chunk.  The <tt class="docutils literal">TransitiveReference</tt> walks &quot;up&quot; the web toward top-level file
definitions that reference this <tt class="docutils literal">Chunk</tt>.</p>
<p>The <tt class="docutils literal">Chunk</tt> constructor initializes the following instance variables:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">commands:</th><td class="field-body">is a sequence of the various <tt class="docutils literal">Command</tt> instances the comprise this
chunk.</td>
</tr>
<tr class="field"><th class="field-name">user_id_list:</th><td class="field-body">is used the list of user identifiers associated with
this chunk.  This attribute is always <tt class="docutils literal">None</tt> for this class.
The <tt class="docutils literal">NamedChunk</tt> subclass, however, can have user identifiers.</td>
</tr>
<tr class="field"><th class="field-name">initial:</th><td class="field-body">is True if this is the first
definition (display with <tt class="docutils literal">'='</tt>) or a subsequent definition (display with <tt class="docutils literal"><span class="pre">'+='</span></tt>).</td>
</tr>
<tr class="field"><th class="field-name">web:</th><td class="field-body">A weakref to the web which contains this Chunk. We want to inherit information
from the <tt class="docutils literal">Web</tt> overall.</td>
</tr>
<tr class="field"><th class="field-name">filePath:</th><td class="field-body">The file which contained this chunk's initial <tt class="docutils literal">&#64;o</tt> or <tt class="docutils literal">&#64;d</tt>.</td>
</tr>
<tr class="field"><th class="field-name">name:</th><td class="field-body">has the name of the chunk.  This is '' for anonymous chunks.</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>!seq:</dt>
<dd>has the sequence number associated with this chunk.  This is None
for anonymous chunks.</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">referencedBy:</th><td class="field-body">is the list of Chunks which reference this chunk.</td>
</tr>
<tr class="field"><th class="field-name">references:</th><td class="field-body">is the list of Chunks this chunk references.</td>
</tr>
</tbody>
</table>
<p class="rubric" id="target-53">Chunk class (53) =</p>
<pre class="code literal-block">
class Chunk:
    &quot;&quot;&quot;Anonymous piece of input file: will be output through the weaver only.&quot;&quot;&quot;
    web : weakref.ReferenceType[&quot;Web&quot;]
    previous_command : &quot;Command&quot;
    initial: bool
    filePath: Path
    def __init__(self) -&gt; None:
        self.logger = logging.getLogger(self.__class__.__qualname__)
        self.commands: list[&quot;Command&quot;] = [ ]  # The list of children of this chunk
        self.user_id_list: list[str] = []
        self.name: str = ''
        self.fullName: str = &quot;&quot;
        self.seq: int = 0
        self.referencedBy: list[Chunk] = []  # Chunks which reference this chunk.  Ideally just one.
        self.references_list: list[str] = []  # Names that this chunk references
        self.refCount = 0

    def __str__(self) -&gt; str:
        return &quot;\n&quot;.join(map(str, self.commands))
    def __repr__(self) -&gt; str:
        return f&quot;{self.__class__.__name__!s}({self.name!r})&quot;

    →Chunk append a command (<a class="reference internal" href="#target-54">54</a>)
    →Chunk append text (<a class="reference internal" href="#target-55">55</a>)
    →Chunk add to the web (<a class="reference internal" href="#target-56">56</a>)

    →Chunk generate references from this Chunk (<a class="reference internal" href="#target-60">60</a>)
    →Chunk superclass make Content definition (<a class="reference internal" href="#target-57">57</a>)
    →Chunk examination: starts with, matches pattern (<a class="reference internal" href="#target-59">59</a>)
    →Chunk references to this Chunk (<a class="reference internal" href="#target-61">61</a>)

    →Chunk weave this Chunk into the documentation (<a class="reference internal" href="#target-62">62</a>)
    →Chunk tangle this Chunk into a code file (<a class="reference internal" href="#target-63">63</a>)
    →Chunk indent adjustments (<a class="reference internal" href="#target-64">64</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk class (53)</em>. Used by: Chunk class hierarchy... (<a class="reference internal" href="#target-52">52</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">append()</tt> method simply appends a <tt class="docutils literal">Command</tt> instance to this chunk.</p>
<p class="rubric" id="target-54">Chunk append a command (54) =</p>
<pre class="code literal-block">
def append(self, command: Command) -&gt; None:
    &quot;&quot;&quot;Add another Command to this chunk.&quot;&quot;&quot;
    self.commands.append(command)
    command.chunk = self
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk append a command (54)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">appendText()</tt> method appends a <tt class="docutils literal">TextCommand</tt> to this chunk,
or it concatenates it to the most recent <tt class="docutils literal">TextCommand</tt>.</p>
<p>When an <tt class="docutils literal">&#64;&#64;</tt> construct is located, the <tt class="docutils literal">appendText()</tt> method is
used to accumulate this character.  This means that it will be appended to
any previous TextCommand, or  new TextCommand will be built.</p>
<p>The reason for appending is that a <tt class="docutils literal">TextCommand</tt> has an implicit indentation.  The &quot;&#64;&quot; cannot
be a separate <tt class="docutils literal">TextCommand</tt> because it will wind up indented.</p>
<p class="rubric" id="target-55">Chunk append text (55) =</p>
<pre class="code literal-block">
def appendText(self, text: str, lineNumber: int = 0) -&gt; None:
    &quot;&quot;&quot;Append a single character to the most recent TextCommand.&quot;&quot;&quot;
    try:
        # Works for TextCommand, otherwise breaks
        self.commands[-1].text += text
    except IndexError as e:
        # First command?  Then the list will have been empty.
        self.commands.append(self.makeContent(text,lineNumber))
    except AttributeError as e:
        # Not a TextCommand?  Then there won't be a text attribute.
        self.commands.append(self.makeContent(text,lineNumber))
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk append text (55)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">webAdd()</tt> method adds this chunk to the given document web.
Each subclass of the <tt class="docutils literal">Chunk</tt> class must override this to be sure that the various
<tt class="docutils literal">Chunk</tt> subclasses are indexed properly.  The
<tt class="docutils literal">Chunk</tt> class uses the <tt class="docutils literal">add()</tt> method
of the <tt class="docutils literal">Web</tt> class to append an anonymous, unindexed chunk.</p>
<p class="rubric" id="target-56">Chunk add to the web (56) =</p>
<pre class="code literal-block">
def webAdd(self, web: &quot;Web&quot;) -&gt; None:
    &quot;&quot;&quot;Add self to a Web as anonymous chunk.&quot;&quot;&quot;
    web.add(self)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk add to the web (56)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
<p>This superclass creates a specific Command for a given piece of content.
A subclass can override this to change the underlying assumptions of that Chunk.
The generic chunk doesn't contain code, it contains text and can only be woven,
never tangled.  A Named Chunk using <tt class="docutils literal">&#64;{</tt> and <tt class="docutils literal">&#64;}</tt> creates code.
A Named Chunk using <tt class="docutils literal">&#64;[</tt> and <tt class="docutils literal">&#64;]</tt> creates text.</p>
<p class="rubric" id="target-57">Chunk superclass make Content definition (57) =</p>
<pre class="code literal-block">
def makeContent(self, text: str, lineNumber: int = 0) -&gt; Command:
    return TextCommand(text, lineNumber)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk superclass make Content definition (57)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">startsWith()</tt> method examines a the first <tt class="docutils literal">Command</tt> instance this
<tt class="docutils literal">Chunk</tt> instance to see if it starts
with the given prefix string.</p>
<p>The <tt class="docutils literal">lineNumber()</tt> method returns the line number of the first
<tt class="docutils literal">Command</tt> in this chunk.  This provides some context for where the chunk
occurs in the original input file.</p>
<p>A <tt class="docutils literal">NamedChunk</tt> instance may define one or more identifiers.  This parent class
provides a dummy version of the <tt class="docutils literal">getUserIDRefs</tt> method.  The <tt class="docutils literal">NamedChunk</tt>
subclass overrides this to provide actual results.  By providing this
at the superclass-level, the <tt class="docutils literal">Web</tt> can easily gather identifiers without
knowing the actual subclass of <tt class="docutils literal">Chunk</tt>.</p>
<p>The <tt class="docutils literal">searchForRE()</tt> method examines each <tt class="docutils literal">Command</tt> instance to see if it matches
with the given regular expression.  If so, this can be reported to the Web instance
and accumulated as part of a cross reference for this <tt class="docutils literal">Chunk</tt>.</p>
<p class="rubric" id="target-58">Imports (58) +=</p>
<pre class="code literal-block">
from typing import Pattern, Match, Optional, Any, Literal
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (58)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p class="rubric" id="target-59">Chunk examination: starts with, matches pattern (59) =</p>
<pre class="code literal-block">
def startswith(self, prefix: str) -&gt; bool:
    &quot;&quot;&quot;Examine the first command's starting text.&quot;&quot;&quot;
    return len(self.commands) &gt;= 1 and self.commands[0].startswith(prefix)

def searchForRE(self, rePat: Pattern[str]) -&gt; Optional[&quot;Chunk&quot;]:
    &quot;&quot;&quot;Visit each command, applying the pattern.&quot;&quot;&quot;
    for c in self.commands:
        if c.searchForRE(rePat):
            return self
    return None

&#64;property
def lineNumber(self) -&gt; int | None:
    &quot;&quot;&quot;Return the first command's line number or None.&quot;&quot;&quot;
    return self.commands[0].lineNumber if len(self.commands) &gt;= 1 else None

def setUserIDRefs(self, text: str) -&gt; None:
    &quot;&quot;&quot;Used by NamedChunk subclass.&quot;&quot;&quot;
    pass

def getUserIDRefs(self) -&gt; list[str]:
    &quot;&quot;&quot;Used by NamedChunk subclass.&quot;&quot;&quot;
    return []
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk examination: starts with, matches pattern (59)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
<p>The chunk search in the <tt class="docutils literal">searchForRE()</tt> method parallels weaving and tangling a <tt class="docutils literal">Chunk</tt>.
The operation is delegated to each <tt class="docutils literal">Command</tt> instance within the <tt class="docutils literal">Chunk</tt> instance.</p>
<p>The <tt class="docutils literal">genReferences()</tt> method visits each <tt class="docutils literal">Command</tt> instance inside this chunk;
a <tt class="docutils literal">Command</tt> will yield the references.</p>
<p>Note that an exception may be raised by this operation if a referenced
<tt class="docutils literal">Chunk</tt> does not actually exist.  If a reference <tt class="docutils literal">Command</tt> does raise an error,
we append this <tt class="docutils literal">Chunk</tt> information and reraise the error with the additional
context information.</p>
<p class="rubric" id="target-60">Chunk generate references from this Chunk (60) =</p>
<pre class="code literal-block">
def genReferences(self, aWeb: &quot;Web&quot;) -&gt; Iterator[str]:
    &quot;&quot;&quot;Generate references from this Chunk.&quot;&quot;&quot;
    try:
        for t in self.commands:
            ref = t.ref(aWeb)
            if ref is not None:
                yield ref
    except Error as e:
        raise
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk generate references from this Chunk (60)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
<p>The list of references to a Chunk uses a <strong>Strategy</strong> plug-in
to either generate a simple parent or a transitive closure of all parents.</p>
<p>Note that we need to get the <tt class="docutils literal">Weaver.reference_style</tt> which is a
configuration item. This is a <strong>Strategy</strong> showing how to compute the list of references.
The Weaver pushed it into the Web so that it is available for each <tt class="docutils literal">Chunk</tt>.</p>
<p class="rubric" id="target-61">Chunk references to this Chunk (61) =</p>
<pre class="code literal-block">
def references(self, theWeaver: &quot;Weaver&quot;) -&gt; list[tuple[str, int]]:
    &quot;&quot;&quot;Extract name, sequence from Chunks into a list.&quot;&quot;&quot;
    return [
        (c.name, c.seq)
        for c in theWeaver.reference_style.chunkReferencedBy(self)
    ]
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk references to this Chunk (61)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">weave()</tt> method weaves this chunk into the final document as follows:</p>
<ol class="arabic simple">
<li>Call the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">docBegin()</tt> method.  This method does nothing for document content.</li>
<li>Visit each <tt class="docutils literal">Command</tt> instance: call the <tt class="docutils literal">Command</tt> instance <tt class="docutils literal">weave()</tt> method to
emit the content of the <tt class="docutils literal">Command</tt> instance</li>
<li>Call the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">docEnd()</tt> method.  This method does nothing for document content.</li>
</ol>
<p>Note that an exception may be raised by this action if a referenced
<tt class="docutils literal">Chunk</tt> does not actually exist.  If a reference <tt class="docutils literal">Command</tt> does raise an error,
we append this <tt class="docutils literal">Chunk</tt> information and reraise the error with the additional
context information.</p>
<p class="rubric" id="target-62">Chunk weave this Chunk into the documentation (62) =</p>
<pre class="code literal-block">
def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;Create the nicely formatted document from an anonymous chunk.&quot;&quot;&quot;
    aWeaver.docBegin(self)
    for cmd in self.commands:
        cmd.weave(aWeb, aWeaver)
    aWeaver.docEnd(self)
def weaveReferenceTo(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;Create a reference to this chunk -- except for anonymous chunks.&quot;&quot;&quot;
    raise Exception( &quot;Cannot reference an anonymous chunk.&quot;&quot;&quot;)
def weaveShortReferenceTo(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;Create a short reference to this chunk -- except for anonymous chunks.&quot;&quot;&quot;
    raise Exception( &quot;Cannot reference an anonymous chunk.&quot;&quot;&quot;)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk weave this Chunk into the documentation (62)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
<p>Anonymous chunks cannot be tangled.  Any attempt indicates a serious
problem with this program or the input file.</p>
<p class="rubric" id="target-63">Chunk tangle this Chunk into a code file (63) =</p>
<pre class="code literal-block">
def tangle(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
    &quot;&quot;&quot;Create source code -- except anonymous chunks should not be tangled&quot;&quot;&quot;
    raise Error('Cannot tangle an anonymous chunk', self)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk tangle this Chunk into a code file (63)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
<p>Generally, a Chunk with a reference will adjust the indentation for
that referenced material. However, this is not universally true,
a subclass may not indent when tangling and may -- instead -- put stuff flush at the
left margin by forcing the local indent to zero.</p>
<p class="rubric" id="target-64">Chunk indent adjustments (64) =</p>
<pre class="code literal-block">
def reference_indent(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;, amount: int) -&gt; None:
    aTangler.addIndent(amount)  # Or possibly set indent to local zero.

def reference_dedent(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
    aTangler.clrIndent()
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Chunk indent adjustments (64)</em>. Used by: Chunk class (<a class="reference internal" href="#target-53">53</a>)</p>
</blockquote>
</div>
<div class="section" id="namedchunk-class">
<h3><a class="toc-backref" href="#toc-entry-40">NamedChunk class</a></h3>
<p>A <tt class="docutils literal">NamedChunk</tt> is created and used almost identically to an anonymous <tt class="docutils literal">Chunk</tt>.
The most significant difference is that a name is provided when the <tt class="docutils literal">NamedChunk</tt> is created.
This name is used by the <tt class="docutils literal">Web</tt> to organize the chunks.</p>
<p>A <tt class="docutils literal">NamedChunk</tt> is created with a <tt class="docutils literal">&#64;d</tt> or <tt class="docutils literal">&#64;o</tt> command.
A <tt class="docutils literal">NamedChunk</tt> contains programming language source
when the brackets are <tt class="docutils literal">&#64;{</tt> and <tt class="docutils literal">&#64;}</tt>.  A
separate subclass of <tt class="docutils literal">NamedDocumentChunk</tt> is used when
the brackets are <tt class="docutils literal">&#64;[</tt> and <tt class="docutils literal">&#64;]</tt>.</p>
<p>A <tt class="docutils literal">NamedChunk</tt> can be both tangled into the output program files, and
woven into the output document file.</p>
<p>The <tt class="docutils literal">weave()</tt> method of a <tt class="docutils literal">NamedChunk</tt> uses the Weaver's
<tt class="docutils literal">codeBegin()</tt> and <tt class="docutils literal">codeEnd()</tt>
methods to insert text that is program source and requires additional
markup to make it stand out from documentation.  Other subclasses can override this to
use different <tt class="docutils literal">Weaver</tt> methods for different kinds of text.</p>
<p>By inheritance from the superclass, this class indents. A separate subclass provides a no-indent
implementation of a <tt class="docutils literal">NamedChunk</tt>.</p>
<p>This class introduces some additional attributes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">fullName:</th><td class="field-body">is the full name of the chunk.  It's possible for a
chunk to be an abbreviated forward reference; full names cannot be resolved
until all chunks have been seen.</td>
</tr>
<tr class="field"><th class="field-name">user_id_list:</th><td class="field-body">is the list of user identifiers associated with this chunk.</td>
</tr>
<tr class="field"><th class="field-name">refCount:</th><td class="field-body">is the count of references to this chunk.  If this is
zero, the chunk is unused; if this is more than one, this chunk is
multiply used.  Either of these conditions is a possible error in the input.
This is set by the <tt class="docutils literal">usedBy()</tt> method.</td>
</tr>
<tr class="field"><th class="field-name">name:</th><td class="field-body">has the name of the chunk.  Names can be abbreviated.</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>!seq:</dt>
<dd>has the sequence number associated with this chunk.  This
is set by the Web by the <tt class="docutils literal">webAdd()</tt> method.</dd>
</dl>
<p class="rubric" id="target-65">NamedChunk class (65) =</p>
<pre class="code literal-block">
class NamedChunk(Chunk):
    &quot;&quot;&quot;Named piece of input file: will be output as both tangler and weaver.&quot;&quot;&quot;
    def __init__(self, name: str) -&gt; None:
        super().__init__()
        self.name = name
        self.user_id_list = []
        self.refCount = 0

    def __str__(self) -&gt; str:
        return f&quot;{self.name!r}: {self!s}&quot;

    def makeContent(self, text: str, lineNumber: int = 0) -&gt; Command:
        return CodeCommand(text, lineNumber)

    →NamedChunk user identifiers set and get (<a class="reference internal" href="#target-66">66</a>)
    →NamedChunk add to the web (<a class="reference internal" href="#target-67">67</a>)
    →NamedChunk weave into the documentation (<a class="reference internal" href="#target-68">68</a>)
    →NamedChunk tangle into the source file (<a class="reference internal" href="#target-69">69</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>NamedChunk class (65)</em>. Used by: Chunk class hierarchy... (<a class="reference internal" href="#target-52">52</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">setUserIDRefs()</tt> method accepts a list of user identifiers that are
associated with this chunk.  These are provided after the <tt class="docutils literal">&#64;|</tt> separator
in a <tt class="docutils literal">&#64;d</tt> named chunk.  These are used by the <tt class="docutils literal">&#64;u</tt> cross reference generator.</p>
<p class="rubric" id="target-66">NamedChunk user identifiers set and get (66) =</p>
<pre class="code literal-block">
def setUserIDRefs(self, text: str) -&gt; None:
    &quot;&quot;&quot;Save user ID's associated with this chunk.&quot;&quot;&quot;
    self.user_id_list = text.split()
def getUserIDRefs(self) -&gt; list[str]:
    return self.user_id_list
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>NamedChunk user identifiers set and get (66)</em>. Used by: NamedChunk class (<a class="reference internal" href="#target-65">65</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">webAdd()</tt> method adds this chunk to the given document <tt class="docutils literal">Web</tt> instance.
Each class of <tt class="docutils literal">Chunk</tt> must override this to be sure that the various
<tt class="docutils literal">Chunk</tt> classes are indexed properly.  This class uses the <tt class="docutils literal">Web.addNamed()</tt> method
of the <tt class="docutils literal">Web</tt> class to append a named chunk.</p>
<p class="rubric" id="target-67">NamedChunk add to the web (67) =</p>
<pre class="code literal-block">
def webAdd(self, web: &quot;Web&quot;) -&gt; None:
    &quot;&quot;&quot;Add self to a Web as named chunk, update xrefs.&quot;&quot;&quot;
    web.addNamed(self)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>NamedChunk add to the web (67)</em>. Used by: NamedChunk class (<a class="reference internal" href="#target-65">65</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">weave()</tt> method weaves this chunk into the final document as follows:</p>
<ol class="arabic simple">
<li>call the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">codeBegin()</tt> method.  This method emits the necessary markup
for code appearing in the woven output.</li>
<li>visit each <tt class="docutils literal">Command</tt>, calling the command's <tt class="docutils literal">weave()</tt> method to emit the command's content.</li>
<li>call the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">CodeEnd()</tt> method.  This method emits the necessary markup
for code appearing in the woven output.</li>
</ol>
<p>For an RST weaver this becomes a <tt class="docutils literal"><span class="pre">parsed-literal</span></tt>, which requires a extra indent.
For an HTML weaver this becomes a <tt class="docutils literal">&lt;pre&gt;</tt> in a different-colored box.</p>
<p>References generate links in a woven document. In a tangled document, they create the actual
code. The <tt class="docutils literal">weaveRefenceTo()</tt> method weaves a reference to a chunk using both name and sequence number.
The <tt class="docutils literal">weaveShortReferenceTo()</tt> method weaves a reference to a chunk using only the sequence number.
These references are created by <tt class="docutils literal">ReferenceCommand</tt> instances within a chunk being woven.</p>
<p>The woven references simply follow whatever preceded them on the line; the indent
(if any) doesn't change from the default.</p>
<p class="rubric" id="target-68">NamedChunk weave into the documentation (68) =</p>
<pre class="code literal-block">
def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;Create the nicely formatted document from a chunk of code.&quot;&quot;&quot;
    self.fullName = aWeb.fullNameFor(self.name)
    aWeaver.addIndent()
    aWeaver.codeBegin(self)
    for cmd in self.commands:
        cmd.weave(aWeb, aWeaver)
    aWeaver.clrIndent( )
    aWeaver.codeEnd(self)
def weaveReferenceTo(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;Create a reference to this chunk.&quot;&quot;&quot;
    self.fullName = aWeb.fullNameFor(self.name)
    txt = aWeaver.referenceTo(self.fullName, self.seq)
    aWeaver.codeBlock(txt)
def weaveShortReferenceTo(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;Create a shortened reference to this chunk.&quot;&quot;&quot;
    txt = aWeaver.referenceTo(None, self.seq)
    aWeaver.codeBlock(txt)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>NamedChunk weave into the documentation (68)</em>. Used by: NamedChunk class (<a class="reference internal" href="#target-65">65</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">tangle()</tt> method tangles this chunk into the final document as follows:</p>
<ol class="arabic simple">
<li>call the <tt class="docutils literal">Tangler</tt> class <tt class="docutils literal">codeBegin()</tt> method to set indents properly.</li>
<li>visit each Command, calling the Command's <tt class="docutils literal">tangle()</tt> method to emit the Command's content.</li>
<li>call the <tt class="docutils literal">Tangler</tt> class <tt class="docutils literal">codeEnd()</tt> method to restore indents.</li>
</ol>
<p>If a <tt class="docutils literal">ReferenceCommand</tt> does raise an error during tangling,
we append this Chunk information and reraise the error with the additional
context information.</p>
<p class="rubric" id="target-69">NamedChunk tangle into the source file (69) =</p>
<pre class="code literal-block">
def tangle(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
    &quot;&quot;&quot;Create source code.
    Use aWeb to resolve &#64;&lt;namedChunk&#64;&gt;.
    Format as correctly indented source text
    &quot;&quot;&quot;
    self.previous_command = TextCommand(&quot;&quot;, self.commands[0].lineNumber)
    aTangler.codeBegin(self)
    for t in self.commands:
        try:
            t.tangle(aWeb, aTangler)
        except Error as e:
            raise
        self.previous_command = t
    aTangler.codeEnd(self)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>NamedChunk tangle into the source file (69)</em>. Used by: NamedChunk class (<a class="reference internal" href="#target-65">65</a>)</p>
</blockquote>
<p>There's a second variation on NamedChunk, one that doesn't indent based on
context. It simply sets an indent at the left margin.</p>
<p class="rubric" id="target-70">NamedChunk class (70) +=</p>
<pre class="code literal-block">
class NamedChunk_Noindent(NamedChunk):
    &quot;&quot;&quot;Named piece of input file: will be output as both tangler and weaver.&quot;&quot;&quot;
    def reference_indent(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;, amount: int) -&gt; None:
        aTangler.setIndent(0)

    def reference_dedent(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
        aTangler.clrIndent()
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>NamedChunk class (70)</em>. Used by: Chunk class hierarchy... (<a class="reference internal" href="#target-52">52</a>)</p>
</blockquote>
</div>
<div class="section" id="outputchunk-class">
<h3><a class="toc-backref" href="#toc-entry-41">OutputChunk class</a></h3>
<p>A <tt class="docutils literal">OutputChunk</tt> is created and used identically to a <tt class="docutils literal">NamedChunk</tt>.
The difference between this class and the parent class is the decoration of
the markup when weaving.</p>
<p>The <tt class="docutils literal">OutputChunk</tt> class is a subclass of <tt class="docutils literal">NamedChunk</tt> that handles
file output chunks defined with <tt class="docutils literal">&#64;o</tt>.</p>
<p>The <tt class="docutils literal">weave()</tt> method of a <tt class="docutils literal">OutputChunk</tt> uses the Weaver's
<tt class="docutils literal">fileBegin()</tt> and <tt class="docutils literal">fileEnd()</tt>
methods to insert text that is program source and requires additional
markup to make it stand out from documentation.  Other subclasses could override this to
use different <tt class="docutils literal">Weaver</tt> methods for different kinds of text.</p>
<p>All other methods, including the tangle method are identical to <tt class="docutils literal">NamedChunk</tt>.</p>
<p class="rubric" id="target-71">OutputChunk class (71) =</p>
<pre class="code literal-block">
class OutputChunk(NamedChunk):
    &quot;&quot;&quot;Named piece of input file, defines an output tangle.&quot;&quot;&quot;
    def __init__(self, name: str, comment_start: str = &quot;&quot;, comment_end: str = &quot;&quot;) -&gt; None:
        super().__init__(name)
        self.comment_start = comment_start
        self.comment_end = comment_end
    →OutputChunk add to the web (<a class="reference internal" href="#target-72">72</a>)
    →OutputChunk weave (<a class="reference internal" href="#target-73">73</a>)
    →OutputChunk tangle (<a class="reference internal" href="#target-74">74</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>OutputChunk class (71)</em>. Used by: Chunk class hierarchy... (<a class="reference internal" href="#target-52">52</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">webAdd()</tt> method adds this chunk to the given document <tt class="docutils literal">Web</tt>.
Each class of <tt class="docutils literal">Chunk</tt> must override this to be sure that the various
<tt class="docutils literal">Chunk</tt> classes are indexed properly.  This class uses the <tt class="docutils literal">addOutput()</tt> method
of the <tt class="docutils literal">Web</tt> class to append a file output chunk.</p>
<p class="rubric" id="target-72">OutputChunk add to the web (72) =</p>
<pre class="code literal-block">
def webAdd(self, web: &quot;Web&quot;) -&gt; None:
    &quot;&quot;&quot;Add self to a Web as output chunk, update xrefs.&quot;&quot;&quot;
    web.addOutput(self)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>OutputChunk add to the web (72)</em>. Used by: OutputChunk class (<a class="reference internal" href="#target-71">71</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">weave()</tt> method weaves this chunk into the final document as follows:</p>
<ol class="arabic simple">
<li>call the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">codeBegin()</tt> method to emit proper markup for an output file chunk.</li>
<li>visit each <tt class="docutils literal">Command</tt>, call the Command's <tt class="docutils literal">weave()</tt> method to emit the Command's content.</li>
<li>call the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">codeEnd()</tt> method to emit proper markup for an output file chunk.</li>
</ol>
<p>These chunks of documentation are never tangled.  Any attempt is an
error.</p>
<p>If a <tt class="docutils literal">ReferenceCommand</tt> does raise an error during weaving,
we append this <tt class="docutils literal">Chunk</tt> information and reraise the error with the additional
context information.</p>
<p class="rubric" id="target-73">OutputChunk weave (73) =</p>
<pre class="code literal-block">
def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;Create the nicely formatted document from a chunk of code.&quot;&quot;&quot;
    self.fullName = aWeb.fullNameFor(self.name)
    aWeaver.fileBegin(self)
    for cmd in self.commands:
        cmd.weave(aWeb, aWeaver)
    aWeaver.fileEnd(self)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>OutputChunk weave (73)</em>. Used by: OutputChunk class (<a class="reference internal" href="#target-71">71</a>)</p>
</blockquote>
<p>When we tangle, we provide the output Chunk's comment information to the Tangler
to be sure that -- if line numbers were requested -- they can be included properly.</p>
<p class="rubric" id="target-74">OutputChunk tangle (74) =</p>
<pre class="code literal-block">
def tangle(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
    aTangler.comment_start = self.comment_start
    aTangler.comment_end = self.comment_end
    super().tangle(aWeb, aTangler)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>OutputChunk tangle (74)</em>. Used by: OutputChunk class (<a class="reference internal" href="#target-71">71</a>)</p>
</blockquote>
</div>
<div class="section" id="nameddocumentchunk-class">
<h3><a class="toc-backref" href="#toc-entry-42">NamedDocumentChunk class</a></h3>
<p>A <tt class="docutils literal">NamedDocumentChunk</tt> is created and used identically to a <tt class="docutils literal">NamedChunk</tt>.
The difference between this class and the parent class is that this chunk
is only woven when referenced.  The original definition is silently skipped.</p>
<p>The <tt class="docutils literal">NamedDocumentChunk</tt> class is a subclass of <tt class="docutils literal">NamedChunk</tt> that handles
named chunks defined with <tt class="docutils literal">&#64;d</tt> and the <tt class="docutils literal">&#64;[</tt>...<tt class="docutils literal">&#64;]</tt> delimiters.
These are woven slightly
differently, since they are document source, not programming language source.</p>
<p>We're not as interested in the cross reference of named document chunks.
They can be used multiple times or never.  They are expected to be referenced
by anonymous chunks.  While this chunk subclass participates in this data
gathering, it is ignored for reporting purposes.</p>
<p>All other methods, including the tangle method are identical to <tt class="docutils literal">NamedChunk</tt>.</p>
<p class="rubric" id="target-75">NamedDocumentChunk class (75) =</p>
<pre class="code literal-block">
class NamedDocumentChunk(NamedChunk):
    &quot;&quot;&quot;Named piece of input file with document source, defines an output tangle.&quot;&quot;&quot;

    def makeContent(self, text: str, lineNumber: int = 0) -&gt; Command:
        return TextCommand(text, lineNumber)

    →NamedDocumentChunk weave (<a class="reference internal" href="#target-76">76</a>)
    →NamedDocumentChunk tangle (<a class="reference internal" href="#target-77">77</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>NamedDocumentChunk class (75)</em>. Used by: Chunk class hierarchy... (<a class="reference internal" href="#target-52">52</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">weave()</tt> method quietly ignores this chunk in the document.
A named document chunk is only included when it is referenced
during weaving of another chunk (usually an anonymous document
chunk).</p>
<p>The <tt class="docutils literal">weaveReferenceTo()</tt> method inserts the content of this
chunk into the output document.  This is done in response to a
<tt class="docutils literal">ReferenceCommand</tt> in another chunk.
The <tt class="docutils literal">weaveShortReferenceTo()</tt> method calls the <tt class="docutils literal">weaveReferenceTo()</tt>
to insert the entire chunk.</p>
<p class="rubric" id="target-76">NamedDocumentChunk weave (76) =</p>
<pre class="code literal-block">
def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;Ignore this when producing the document.&quot;&quot;&quot;
    pass
def weaveReferenceTo(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;On a reference to this chunk, expand the body in place.&quot;&quot;&quot;
    for cmd in self.commands:
        cmd.weave(aWeb, aWeaver)
def weaveShortReferenceTo(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;On a reference to this chunk, expand the body in place.&quot;&quot;&quot;
    self.weaveReferenceTo(aWeb, aWeaver)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>NamedDocumentChunk weave (76)</em>. Used by: NamedDocumentChunk class (<a class="reference internal" href="#target-75">75</a>)</p>
</blockquote>
<p class="rubric" id="target-77">NamedDocumentChunk tangle (77) =</p>
<pre class="code literal-block">
def tangle(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
    &quot;&quot;&quot;Raise an exception on an attempt to tangle.&quot;&quot;&quot;
    raise Error(&quot;Cannot tangle a chunk defined with &#64;[.&quot;&quot;&quot;)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>NamedDocumentChunk tangle (77)</em>. Used by: NamedDocumentChunk class (<a class="reference internal" href="#target-75">75</a>)</p>
</blockquote>
</div>
</div>
<div class="section" id="commands">
<h2><a class="toc-backref" href="#toc-entry-43">Commands</a></h2>
<p>The input stream is broken into individual commands, based on the
various <tt class="docutils literal">&#64;*x*</tt> strings in the file.  There are several subclasses of <tt class="docutils literal">Command</tt>,
each used to describe a different command or block of text in the input.</p>
<p>All instances of the <tt class="docutils literal">Command</tt> class are created by a <tt class="docutils literal">WebReader</tt> instance.
In this case, a <tt class="docutils literal">WebReader</tt> can be thought of as a factory for <tt class="docutils literal">Command</tt> instances.
Each <tt class="docutils literal">Command</tt> instance is appended to the sequence of commands that
belong to a <tt class="docutils literal">Chunk</tt>.  A chunk may be as small as a single command, or a long sequence
of commands.</p>
<p>Each <tt class="docutils literal">Command</tt> instance responds to methods to examine the content, gather
cross reference information and tangle a file or weave the final document.</p>
<p class="rubric" id="target-78">Command class hierarchy - used to describe individual commands (78) =</p>
<pre class="code literal-block">
→Command superclass (<a class="reference internal" href="#target-79">79</a>)
→TextCommand class to contain a document text block (<a class="reference internal" href="#target-82">82</a>)
→CodeCommand class to contain a program source code block (<a class="reference internal" href="#target-83">83</a>)
→XrefCommand superclass for all cross-reference commands (<a class="reference internal" href="#target-84">84</a>)
→FileXrefCommand class for an output file cross-reference (<a class="reference internal" href="#target-85">85</a>)
→MacroXrefCommand class for a named chunk cross-reference (<a class="reference internal" href="#target-86">86</a>)
→UserIdXrefCommand class for a user identifier cross-reference (<a class="reference internal" href="#target-87">87</a>)
→ReferenceCommand class for chunk references (<a class="reference internal" href="#target-88">88</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Command class hierarchy - used to describe individual commands (78)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
<div class="section" id="command-superclass">
<h3><a class="toc-backref" href="#toc-entry-44">Command Superclass</a></h3>
<p>A <tt class="docutils literal">Command</tt> is created by the <tt class="docutils literal">WebReader</tt>, and attached to a <tt class="docutils literal">Chunk</tt>.
The Command participates in cross reference creation, weaving and tangling.</p>
<p>The <tt class="docutils literal">Command</tt> superclass is abstract, and has default methods factored out
of the various subclasses.  When a subclass is created, it will override some
of the methods provided in this superclass.</p>
<pre class="literal-block">
class MyNewCommand(Command):
    <em>... overrides for various methods ...</em>
</pre>
<p>Additionally, a subclass of <tt class="docutils literal">WebReader</tt> must be defined to parse the new command
syntax.  The main <tt class="docutils literal">process()</tt> function must also be updated to use this new subclass
of <tt class="docutils literal">WebReader</tt>.</p>
<p>The <tt class="docutils literal">Command</tt> superclass provides the parent class definition
for all of the various command types.  The most common command
is a block of text.
For tangling it is presented with no changes. For weaving,
quoting is used to make it work nicely with the given markup language.</p>
<p>The next most
common command is a reference to a chunk. This is woven as a
mark-up reference: a link. It is tangled as an expansion of the source
code.</p>
<p>Additional methods include the following:</p>
<ul class="simple">
<li>The <tt class="docutils literal">startswith()</tt> method examines any source text to see if
it begins with the given prefix text.</li>
<li>The <tt class="docutils literal">searchForRE()</tt> method examines any source text to see if
it matches the given regular expression, usually a match for a user identifier.</li>
<li>The <tt class="docutils literal">ref()</tt> method is ignored by all but the <tt class="docutils literal">Reference</tt> subclass,
which returns reference made by the command to the parent chunk.</li>
<li>The <tt class="docutils literal">weave()</tt> method weaves this into the output.  If a document text
command, it is emitted directly; if a program source code command,
markup is applied.  In the case of cross-reference commands,
the actual cross-reference content is emitted.  In the case of
reference commands, they are woven as a reference to a named
chunk.</li>
<li>The <tt class="docutils literal">tangle()</tt> method tangles this into the output.  If a
this is a document text command, it is ignored; if a this is a
program source code
command, it is indented and emitted.  In the case of cross-reference
commands, no output is produced.  In the case of reference
commands, the named chunk is indented and emitted.</li>
</ul>
<p>The attributes of a <tt class="docutils literal">Command</tt> instance includes the line number on which
the command began, in <tt class="docutils literal">lineNumber</tt>.</p>
<p class="rubric" id="target-79">Command superclass (79) =</p>
<pre class="code literal-block">
class Command:
    &quot;&quot;&quot;A Command is the lowest level of granularity in the input stream.&quot;&quot;&quot;
    chunk : &quot;Chunk&quot;
    text : str
    def __init__(self, fromLine: int = 0) -&gt; None:
        self.lineNumber = fromLine+1 # tokenizer is zero-based
        self.logger = logging.getLogger(self.__class__.__qualname__)

    def __str__(self) -&gt; str:
        return f&quot;at {self.lineNumber!r}&quot;

    →Command analysis features: starts-with and Regular Expression search (<a class="reference internal" href="#target-80">80</a>)
    →Command tangle and weave functions (<a class="reference internal" href="#target-81">81</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Command superclass (79)</em>. Used by: Command class hierarchy... (<a class="reference internal" href="#target-78">78</a>)</p>
</blockquote>
<p class="rubric" id="target-80">Command analysis features: starts-with and Regular Expression search (80) =</p>
<pre class="code literal-block">
def startswith(self, prefix: str) -&gt; bool:
    return False
def searchForRE(self, rePat: Pattern[str]) -&gt; Match[str] | None:
    return None
def indent(self) -&gt; int:
    return 0
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Command analysis features: starts-with and Regular Expression search (80)</em>. Used by: Command superclass (<a class="reference internal" href="#target-79">79</a>)</p>
</blockquote>
<p class="rubric" id="target-81">Command tangle and weave functions (81) =</p>
<pre class="code literal-block">
def ref(self, aWeb: &quot;Web&quot;) -&gt; str | None:
    return None
def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    pass
def tangle(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
    pass
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Command tangle and weave functions (81)</em>. Used by: Command superclass (<a class="reference internal" href="#target-79">79</a>)</p>
</blockquote>
</div>
<div class="section" id="textcommand-class">
<h3><a class="toc-backref" href="#toc-entry-45">TextCommand class</a></h3>
<p>A <tt class="docutils literal">TextCommand</tt> is created by a <tt class="docutils literal">Chunk</tt> or a <tt class="docutils literal">NamedDocumentChunk</tt> when a
<tt class="docutils literal">WebReader</tt> calls the chunk's <tt class="docutils literal">appendText()</tt> method.</p>
<p>This Command participates in cross reference creation, weaving and tangling.  When it is
created, the source line number is provided so that this text can be tied back
to the source document.</p>
<p>An instance of the <tt class="docutils literal">TextCommand</tt> class is a block of document text.  It can originate
in an anonymous block or a named chunk delimited with <tt class="docutils literal">&#64;[</tt> and <tt class="docutils literal">&#64;]</tt>.</p>
<p>This subclass provides a concrete implementation for all of the methods.  Since
text is the author's original markup language, it is emitted directly to the weaver
or tangler.</p>
<p><strong>TODO:</strong> Use textwrap to snip off first 32 chars of the text.</p>
<p class="rubric" id="target-82">TextCommand class to contain a document text block (82) =</p>
<pre class="code literal-block">
class TextCommand(Command):
    &quot;&quot;&quot;A piece of document source text.&quot;&quot;&quot;
    def __init__(self, text: str, fromLine: int = 0) -&gt; None:
        super().__init__(fromLine)
        self.text = text
    def __str__(self) -&gt; str:
        return f&quot;at {self.lineNumber!r}: {self.text[:32]!r}...&quot;
    def startswith(self, prefix: str) -&gt; bool:
        return self.text.startswith(prefix)
    def searchForRE(self, rePat: Pattern[str]) -&gt; Match[str] | None:
        return rePat.search(self.text)
    def indent(self) -&gt; int:
        if self.text.endswith('\n'):
            return 0
        try:
            last_line = self.text.splitlines()[-1]
            return len(last_line)
        except IndexError:
            return 0
    def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
        aWeaver.write(self.text)
    def tangle(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
        aTangler.write(self.text)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>TextCommand class to contain a document text block (82)</em>. Used by: Command class hierarchy... (<a class="reference internal" href="#target-78">78</a>)</p>
</blockquote>
</div>
<div class="section" id="codecommand-class">
<h3><a class="toc-backref" href="#toc-entry-46">CodeCommand class</a></h3>
<p>A <tt class="docutils literal">CodeCommand</tt> is created by a <tt class="docutils literal">NamedChunk</tt> when a
<tt class="docutils literal">WebReader</tt> calls the <tt class="docutils literal">appendText()</tt> method.
The Command participates in cross reference creation, weaving and tangling.  When it is
created, the source line number is provided so that this text can be tied back
to the source document.</p>
<p>An instance of the <tt class="docutils literal">CodeCommand</tt> class is a block of program source code text.
It can originate in a named chunk (<tt class="docutils literal">&#64;d</tt>) with a <tt class="docutils literal">&#64;{</tt> and <tt class="docutils literal">&#64;}</tt> delimiter.
Or it can be a file output chunk (<tt class="docutils literal">&#64;o</tt>).</p>
<p>It uses the <tt class="docutils literal">codeBlock()</tt> methods of a <tt class="docutils literal">Weaver</tt> or <tt class="docutils literal">Tangler</tt>.  The weaver will
insert appropriate markup for this code.  The tangler will assure that the prevailing
indentation is maintained.</p>
<p class="rubric" id="target-83">CodeCommand class to contain a program source code block (83) =</p>
<pre class="code literal-block">
class CodeCommand(TextCommand):
    &quot;&quot;&quot;A piece of program source code.&quot;&quot;&quot;
    def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
        aWeaver.codeBlock(aWeaver.quote(self.text))
    def tangle(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
        aTangler.codeBlock(self.text)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>CodeCommand class to contain a program source code block (83)</em>. Used by: Command class hierarchy... (<a class="reference internal" href="#target-78">78</a>)</p>
</blockquote>
</div>
<div class="section" id="xrefcommand-superclass">
<h3><a class="toc-backref" href="#toc-entry-47">XrefCommand superclass</a></h3>
<p>An <tt class="docutils literal">XrefCommand</tt> is created by the <tt class="docutils literal">WebReader</tt> when any of the
<tt class="docutils literal">&#64;f</tt>, <tt class="docutils literal">&#64;m</tt>, <tt class="docutils literal">&#64;u</tt> commands are found in the input stream.
The Command is then appended to the current Chunk being built by the WebReader.</p>
<p>The <tt class="docutils literal">XrefCommand</tt> superclass defines any common features of the
various cross-reference commands (<tt class="docutils literal">&#64;f</tt>, <tt class="docutils literal">&#64;m</tt>, <tt class="docutils literal">&#64;u</tt>).</p>
<p>The <tt class="docutils literal">formatXref()</tt> method creates the body of a cross-reference
by the following algorithm:</p>
<ol class="arabic simple">
<li>Use the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">xrefHead()</tt> method to emit the cross-reference header.</li>
<li>Sort the keys in the cross-reference mapping.</li>
<li>Use the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">xrefLine()</tt> method to emit each line of the cross-reference mapping.</li>
<li>Use the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">xrefFoot()</tt> method to emit the cross-reference footer.</li>
</ol>
<p>If this command winds up in a tangle action, that use
is illegal.  An exception is raised and processing stops.</p>
<p class="rubric" id="target-84">XrefCommand superclass for all cross-reference commands (84) =</p>
<pre class="code literal-block">
class XrefCommand(Command):
    &quot;&quot;&quot;Any of the Xref-goes-here commands in the input.&quot;&quot;&quot;
    def __str__(self) -&gt; str:
        return f&quot;at {self.lineNumber!r}: cross reference&quot;

    def formatXref(self, xref: dict[str, list[int]], aWeaver: &quot;Weaver&quot;) -&gt; None:
        aWeaver.xrefHead()
        for n in sorted(xref):
            aWeaver.xrefLine(n, xref[n])
        aWeaver.xrefFoot()

    def tangle(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
        raise Error('Illegal tangling of a cross reference command.')
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>XrefCommand superclass for all cross-reference commands (84)</em>. Used by: Command class hierarchy... (<a class="reference internal" href="#target-78">78</a>)</p>
</blockquote>
</div>
<div class="section" id="filexrefcommand-class">
<h3><a class="toc-backref" href="#toc-entry-48">FileXrefCommand class</a></h3>
<p>A <tt class="docutils literal">FileXrefCommand</tt> is created by the <tt class="docutils literal">WebReader</tt> when the
<tt class="docutils literal">&#64;f</tt> command is found in the input stream.
The Command is then appended to the current Chunk being built by the WebReader.</p>
<p>The <tt class="docutils literal">FileXrefCommand</tt> class weave method gets the
file cross reference from the overall web instance, and uses
the  <tt class="docutils literal">formatXref()</tt> method of the <tt class="docutils literal">XrefCommand</tt> superclass for format this result.</p>
<p class="rubric" id="target-85">FileXrefCommand class for an output file cross-reference (85) =</p>
<pre class="code literal-block">
class FileXrefCommand(XrefCommand):
    &quot;&quot;&quot;A FileXref command.&quot;&quot;&quot;
    def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
        &quot;&quot;&quot;Weave a File Xref from &#64;o commands.&quot;&quot;&quot;
        self.formatXref(aWeb.fileXref(), aWeaver)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>FileXrefCommand class for an output file cross-reference (85)</em>. Used by: Command class hierarchy... (<a class="reference internal" href="#target-78">78</a>)</p>
</blockquote>
</div>
<div class="section" id="macroxrefcommand-class">
<h3><a class="toc-backref" href="#toc-entry-49">MacroXrefCommand class</a></h3>
<p>A <tt class="docutils literal">MacroXrefCommand</tt> is created by the <tt class="docutils literal">WebReader</tt> when the
<tt class="docutils literal">&#64;m</tt> command is found in the input stream.
The Command is then appended to the current Chunk being built by the WebReader.</p>
<p>The <tt class="docutils literal">MacroXrefCommand</tt> class weave method gets the
named chunk (macro) cross reference from the overall web instance, and uses
the <tt class="docutils literal">formatXref()</tt> method of the <tt class="docutils literal">XrefCommand</tt> superclass method for format this result.</p>
<p class="rubric" id="target-86">MacroXrefCommand class for a named chunk cross-reference (86) =</p>
<pre class="code literal-block">
class MacroXrefCommand(XrefCommand):
    &quot;&quot;&quot;A MacroXref command.&quot;&quot;&quot;
    def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
        &quot;&quot;&quot;Weave the Macro Xref from &#64;d commands.&quot;&quot;&quot;
        self.formatXref(aWeb.chunkXref(), aWeaver)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>MacroXrefCommand class for a named chunk cross-reference (86)</em>. Used by: Command class hierarchy... (<a class="reference internal" href="#target-78">78</a>)</p>
</blockquote>
</div>
<div class="section" id="useridxrefcommand-class">
<h3><a class="toc-backref" href="#toc-entry-50">UserIdXrefCommand class</a></h3>
<p>A <tt class="docutils literal">MacroXrefCommand</tt> is created by the <tt class="docutils literal">WebReader</tt> when the
<tt class="docutils literal">&#64;u</tt> command is found in the input stream.
The Command is then appended to the current Chunk being built by the WebReader.</p>
<p>The <tt class="docutils literal">UserIdXrefCommand</tt> class weave method gets the
user identifier cross reference information from the
overall web instance.  It then formats this line using the following
algorithm, which is similar to the algorithm in the <tt class="docutils literal">XrefCommand</tt> superclass.</p>
<ol class="arabic simple">
<li>Use the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">xrefHead()</tt> method to emit the cross-reference header.</li>
<li>Sort the keys in the cross-reference mapping.</li>
<li>Use the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">xrefDefLine()</tt> method to emit each line of the cross-reference definition mapping.</li>
<li>Use the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">xrefFoor()</tt> method to emit the cross-reference footer.</li>
</ol>
<p class="rubric" id="target-87">UserIdXrefCommand class for a user identifier cross-reference (87) =</p>
<pre class="code literal-block">
class UserIdXrefCommand(XrefCommand):
    &quot;&quot;&quot;A UserIdXref command.&quot;&quot;&quot;
    def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
        &quot;&quot;&quot;Weave a user identifier Xref from &#64;d commands.&quot;&quot;&quot;
        ux = aWeb.userNamesXref()
        if len(ux) != 0:
            aWeaver.xrefHead()
            for u in sorted(ux):
                defn, refList = ux[u]
                aWeaver.xrefDefLine(u, defn, refList)
            aWeaver.xrefFoot()
        else:
            aWeaver.xrefEmpty()
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>UserIdXrefCommand class for a user identifier cross-reference (87)</em>. Used by: Command class hierarchy... (<a class="reference internal" href="#target-78">78</a>)</p>
</blockquote>
</div>
<div class="section" id="referencecommand-class">
<h3><a class="toc-backref" href="#toc-entry-51">ReferenceCommand class</a></h3>
<p>A <tt class="docutils literal">ReferenceCommand</tt> instance is created by a <tt class="docutils literal">WebReader</tt> when
a <tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt> construct in is found in the input stream.  This is attached
to the current <tt class="docutils literal">Chunk</tt> being built by the WebReader.</p>
<p>During a weave, this creates a markup reference to
another <tt class="docutils literal">NamedChunk</tt>.  During tangle, this actually includes the <tt class="docutils literal">NamedChunk</tt>
at this point in the tangled output file.</p>
<p>The constructor creates several attributes of an instance
of a <tt class="docutils literal">ReferenceCommand</tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">refTo:</th><td class="field-body">the name of the chunk to which this refers, possibly
elided with a trailing <tt class="docutils literal"><span class="pre">'...'</span></tt>.</td>
</tr>
<tr class="field"><th class="field-name">fullName:</th><td class="field-body">the full name of the chunk to which this refers.</td>
</tr>
<tr class="field"><th class="field-name">chunkList:</th><td class="field-body">the list of the chunks to which the name refers.</td>
</tr>
</tbody>
</table>
<p class="rubric" id="target-88">ReferenceCommand class for chunk references (88) =</p>
<pre class="code literal-block">
class ReferenceCommand(Command):
    &quot;&quot;&quot;A reference to a named chunk, via &#64;&lt;name&#64;&gt;.&quot;&quot;&quot;
    def __init__(self, refTo: str, fromLine: int = 0) -&gt; None:
        super().__init__(fromLine)
        self.refTo = refTo
        self.fullname = None
        self.sequenceList = None
        self.chunkList: list[Chunk] = []

    def __str__(self) -&gt; str:
        return &quot;at {self.lineNumber!r}: reference to chunk {self.refTo!r}&quot;

    →ReferenceCommand resolve a referenced chunk name (<a class="reference internal" href="#target-89">89</a>)
    →ReferenceCommand refers to a chunk (<a class="reference internal" href="#target-90">90</a>)
    →ReferenceCommand weave a reference to a chunk (<a class="reference internal" href="#target-91">91</a>)
    →ReferenceCommand tangle a referenced chunk (<a class="reference internal" href="#target-92">92</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>ReferenceCommand class for chunk references (88)</em>. Used by: Command class hierarchy... (<a class="reference internal" href="#target-78">78</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">resolve()</tt> method queries the overall <tt class="docutils literal">Web</tt> instance for the full
name and sequence number for this chunk reference.  This is used
by the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">referenceTo()</tt> method to write the markup reference
to the chunk.</p>
<p class="rubric" id="target-89">ReferenceCommand resolve a referenced chunk name (89) =</p>
<pre class="code literal-block">
def resolve(self, aWeb: &quot;Web&quot;) -&gt; None:
    &quot;&quot;&quot;Expand our chunk name and list of parts&quot;&quot;&quot;
    self.fullName = aWeb.fullNameFor(self.refTo)
    self.chunkList = aWeb.getchunk(self.refTo)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>ReferenceCommand resolve a referenced chunk name (89)</em>. Used by: ReferenceCommand class... (<a class="reference internal" href="#target-88">88</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">ref()</tt> method is a request that is delegated by a <tt class="docutils literal">Chunk</tt>;
it resolves the reference this Command makes within the containing Chunk.
When the Chunk iterates through the Commands, it can accumulate a list of
Chinks to which it refers.</p>
<p class="rubric" id="target-90">ReferenceCommand refers to a chunk (90) =</p>
<pre class="code literal-block">
def ref(self, aWeb: &quot;Web&quot;) -&gt; str:
    &quot;&quot;&quot;Find and return the full name for this reference.&quot;&quot;&quot;
    self.resolve(aWeb)
    return self.fullName
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>ReferenceCommand refers to a chunk (90)</em>. Used by: ReferenceCommand class... (<a class="reference internal" href="#target-88">88</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">weave()</tt> method inserts a markup reference to a named
chunk.  It uses the <tt class="docutils literal">Weaver</tt> class <tt class="docutils literal">referenceTo()</tt> method to format
this appropriately for the document type being woven.</p>
<p class="rubric" id="target-91">ReferenceCommand weave a reference to a chunk (91) =</p>
<pre class="code literal-block">
def weave(self, aWeb: &quot;Web&quot;, aWeaver: &quot;Weaver&quot;) -&gt; None:
    &quot;&quot;&quot;Create the nicely formatted reference to a chunk of code.&quot;&quot;&quot;
    self.resolve(aWeb)
    aWeb.weaveChunk(self.fullName, aWeaver)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>ReferenceCommand weave a reference to a chunk (91)</em>. Used by: ReferenceCommand class... (<a class="reference internal" href="#target-88">88</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">tangle()</tt> method inserts the resolved chunk in this
place.  When a chunk is tangled, it sets the indent,
inserts the chunk and resets the indent.</p>
<p>This is where the Tangler indentation is updated by a reference.
Or where indentation is set to a local zero because the included
Chunk is a no-indent Chunk.</p>
<p class="rubric" id="target-92">ReferenceCommand tangle a referenced chunk (92) =</p>
<pre class="code literal-block">
def tangle(self, aWeb: &quot;Web&quot;, aTangler: &quot;Tangler&quot;) -&gt; None:
    &quot;&quot;&quot;Create source code.&quot;&quot;&quot;
    self.resolve(aWeb)

    self.logger.debug(&quot;Indent %r + %r&quot;, aTangler.context, self.chunk.previous_command.indent())
    self.chunk.reference_indent(aWeb, aTangler, self.chunk.previous_command.indent())

    self.logger.debug(&quot;Tangling %r with chunks %r&quot;, self.fullName, self.chunkList)
    if len(self.chunkList) != 0:
        for p in self.chunkList:
            p.tangle(aWeb, aTangler)
    else:
        raise Error(f&quot;Attempt to tangle an undefined Chunk, {self.fullName!s}.&quot;)

    self.chunk.reference_dedent(aWeb, aTangler)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>ReferenceCommand tangle a referenced chunk (92)</em>. Used by: ReferenceCommand class... (<a class="reference internal" href="#target-88">88</a>)</p>
</blockquote>
</div>
</div>
<div class="section" id="reference-strategy">
<h2><a class="toc-backref" href="#toc-entry-52">Reference Strategy</a></h2>
<p>The Reference Strategy has two implementations.  An instance
of this is injected into each Chunk by the Web.  By injecting this
algorithm, we assure that:</p>
<ol class="arabic simple">
<li>each Chunk can produce all relevant reference information and</li>
<li>a simple configuration change can be applied to the document.</li>
</ol>
<div class="section" id="reference-superclass">
<h3><a class="toc-backref" href="#toc-entry-53">Reference Superclass</a></h3>
<p>The superclass is an abstract class that defines the interface for
this object.</p>
<p class="rubric" id="target-93">Reference class hierarchy - strategies for references to a chunk (93) =</p>
<pre class="code literal-block">
class Reference:
    def __init__(self) -&gt; None:
        self.logger = logging.getLogger(self.__class__.__qualname__)
    def chunkReferencedBy(self, aChunk: Chunk) -&gt; list[Chunk]:
        &quot;&quot;&quot;Return a list of Chunks.&quot;&quot;&quot;
        return []
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Reference class hierarchy - strategies for references to a chunk (93)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
</div>
<div class="section" id="simplereference-class">
<h3><a class="toc-backref" href="#toc-entry-54">SimpleReference Class</a></h3>
<p>The SimpleReference subclass does the simplest version of resolution. It returns
the <tt class="docutils literal">Chunks</tt> referenced.</p>
<p class="rubric" id="target-94">Reference class hierarchy - strategies for references to a chunk (94) +=</p>
<pre class="code literal-block">
class SimpleReference(Reference):
    def chunkReferencedBy(self, aChunk: Chunk) -&gt; list[Chunk]:
        refBy = aChunk.referencedBy
        return refBy
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Reference class hierarchy - strategies for references to a chunk (94)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
</div>
<div class="section" id="transitivereference-class">
<h3><a class="toc-backref" href="#toc-entry-55">TransitiveReference Class</a></h3>
<p>The TransitiveReference subclass does a transitive closure of all
references to this Chunk.</p>
<p>This requires walking through the <tt class="docutils literal">Web</tt> to locate &quot;parents&quot; of each referenced
<tt class="docutils literal">Chunk</tt>.</p>
<p class="rubric" id="target-95">Reference class hierarchy - strategies for references to a chunk (95) +=</p>
<pre class="code literal-block">
class TransitiveReference(Reference):
    def chunkReferencedBy(self, aChunk: Chunk) -&gt; list[Chunk]:
        refBy = aChunk.referencedBy
        self.logger.debug(&quot;References: %r(%d) %r&quot;, aChunk.name, aChunk.seq, refBy)
        return self.allParentsOf(refBy)
    def allParentsOf(self, chunkList: list[Chunk], depth: int = 0) -&gt; list[Chunk]:
        &quot;&quot;&quot;Transitive closure of parents via recursive ascent.
        &quot;&quot;&quot;
        final = []
        for c in chunkList:
            final.append(c)
            final.extend(self.allParentsOf(c.referencedBy, depth+1))
        self.logger.debug(f&quot;References: {'--':&gt;{2*depth}s} {final!s}&quot;)
        return final
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Reference class hierarchy - strategies for references to a chunk (95)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
</div>
</div>
<div class="section" id="error-class">
<h2><a class="toc-backref" href="#toc-entry-56">Error class</a></h2>
<p>An <tt class="docutils literal">Error</tt> is raised whenever processing cannot continue.  Since it
is a subclass of Exception, it takes an arbitrary number of arguments.  The
first should be the basic message text.  Subsequent arguments provide
additional details.  We will try to be sure that
all of our internal exceptions reference a specific chunk, if possible.
This means either including the chunk as an argument, or catching the
exception and appending the current chunk to the exception's arguments.</p>
<p>The Python <tt class="docutils literal">raise</tt> statement takes an instance of <tt class="docutils literal">Error</tt> and passes it
to the enclosing <tt class="docutils literal">try/except</tt> statement for processing.</p>
<p>The typical creation is as follows:</p>
<pre class="literal-block">
raise Error(f&quot;No full name for {chunk.name!r}&quot;, chunk)
</pre>
<p>A typical exception-handling suite might look like this:</p>
<pre class="literal-block">
try:
    <em>...something that may raise an Error or Exception...</em>
except Error as e:
    print(e.args) # this is a pyWeb internal Error
except Exception as w:
    print(w.args) # this is some other Python Exception
</pre>
<p>The <tt class="docutils literal">Error</tt> class is a subclass of <tt class="docutils literal">Exception</tt> used to differentiate
application-specific
exceptions from other Python exceptions.  It does no additional processing,
but merely creates a distinct class to facilitate writing <tt class="docutils literal">except</tt> statements.</p>
<p class="rubric" id="target-96">Error class - defines the errors raised (96) =</p>
<pre class="code literal-block">
class Error(Exception): pass
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Error class - defines the errors raised (96)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
</div>
<div class="section" id="the-web-and-webreader-classes">
<h2><a class="toc-backref" href="#toc-entry-57">The Web and WebReader Classes</a></h2>
<p>The overall web of chunks is carried in a
single instance of the <tt class="docutils literal">Web</tt> class that is the principle parameter for the weaving and tangling actions.
Broadly, the functionality of a Web can be separated into several areas.</p>
<p>It supports  construction methods used by <tt class="docutils literal">Chunks</tt> and <tt class="docutils literal">WebReader</tt>.</p>
<p>It also supports &quot;enrichment&quot; of the web, once all the Chunks are known.
This is a stateful update to the web.  Each Chunk is updated with Chunk
references it makes as well as Chunks which reference it.</p>
<p>It supports <tt class="docutils literal">Chunk</tt> cross-reference methods that traverse this enriched data.
This includes a kind of validity check to be sure that everything is used once
and once only.</p>
<p>More importantly, it supports tangle and weave operations.</p>
<p>Fundamentally, a <tt class="docutils literal">Web</tt> is a hybrid list-dictionary.</p>
<ul class="simple">
<li>It's a mapping of chunks that also offers a
moderately sophisticated
lookup, including exact match for a chunk name and an approximate match for a chunk name.
There are several methods to  resolve references among chunks.</li>
<li>It's a sequence that retains all chunks in order, also.
It may be a good candidate to be an <tt class="docutils literal">OrderedDict</tt>, but there are multiple keys. Both Chunk
names and chunk numbers are used.</li>
</ul>
<p>A web instance has a number of attributes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">web_path:</th><td class="field-body">the Path of the source <tt class="docutils literal">.w</tt> file.</td>
</tr>
<tr class="field"><th class="field-name">chunkSeq:</th><td class="field-body">the sequence of <tt class="docutils literal">Chunk</tt> instances as seen in the input file.
To support anonymous chunks, and to assure that the original input document order
is preserved, we keep all chunks in a master sequential list.</td>
</tr>
<tr class="field"><th class="field-name">output:</th><td class="field-body">the <tt class="docutils literal">&#64;o</tt> named <tt class="docutils literal">OutputChunk</tt> chunks.
Each element of this  dictionary is a sequence of chunks that have the same name.
The first is the initial definition (marked with &quot;=&quot;), all others a second definitions
(marked with &quot;+=&quot;).</td>
</tr>
<tr class="field"><th class="field-name">named:</th><td class="field-body">the <tt class="docutils literal">&#64;d</tt> named <tt class="docutils literal">NamedChunk</tt> chunks.  Each element of this
dictionary is a sequence of chunks that have the same name.  The first is the
initial definition (marked with &quot;=&quot;), all others a second definitions
(marked with &quot;+=&quot;).</td>
</tr>
<tr class="field"><th class="field-name">usedBy:</th><td class="field-body">the cross reference of chunks referenced by commands in other
chunks.</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>!sequence:</dt>
<dd>is used to assign a unique sequence number to each
named chunk.</dd>
</dl>
<p class="rubric" id="target-97">Web class - describes the overall &quot;web&quot; of chunks (97) =</p>
<pre class="code literal-block">
class Web:
    &quot;&quot;&quot;The overall Web of chunks.&quot;&quot;&quot;
    def __init__(self, file_path: Path | None = None) -&gt; None:
        self.web_path = file_path
        self.chunkSeq: list[Chunk] = []
        self.output: dict[str, list[Chunk]] = {} # Map filename to Chunk
        self.named: dict[str, list[Chunk]] = {} # Map chunkname to Chunk
        self.sequence = 0
        self.errors = 0
        self.logger = logging.getLogger(self.__class__.__qualname__)

    def __str__(self) -&gt; str:
        return f&quot;Web {self.web_path!r}&quot;

    →Web construction methods used by Chunks and WebReader (<a class="reference internal" href="#target-99">99</a>)
    →Web Chunk name resolution methods (<a class="reference internal" href="#target-104">104</a>), →(<a class="reference internal" href="#target-105">105</a>)
    →Web Chunk cross reference methods (<a class="reference internal" href="#target-106">106</a>), →(<a class="reference internal" href="#target-108">108</a>), →(<a class="reference internal" href="#target-109">109</a>), →(<a class="reference internal" href="#target-110">110</a>)
    →Web determination of the language from the first chunk (<a class="reference internal" href="#target-113">113</a>)
    →Web tangle the output files (<a class="reference internal" href="#target-114">114</a>)
    →Web weave the output document (<a class="reference internal" href="#target-115">115</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web class - describes the overall &quot;web&quot; of chunks (97)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
<div class="section" id="web-construction">
<h3><a class="toc-backref" href="#toc-entry-58">Web Construction</a></h3>
<p>During web construction, it is convenient to capture
information about the individual <tt class="docutils literal">Chunk</tt> instances being appended to
the web.  This done using a <strong>Callback</strong> design pattern.
Each subclass of <tt class="docutils literal">Chunk</tt> provides an override for the <tt class="docutils literal">Chunk</tt> class
<tt class="docutils literal">webAdd()</tt> method.  This override calls one of the appropriate
web construction methods.</p>
<p>Also note that the full name for a chunk can be given
either as part of the definition, or as part a reference.
Typically, the first reference has the full name and the definition
has the elided name.  This allows a reference to a chunk
to contain a more complete description of the chunk.</p>
<p>We include a weakref to the <tt class="docutils literal">Web</tt> to each <tt class="docutils literal">Chunk</tt>.</p>
<p class="rubric" id="target-98">Imports (98) +=</p>
<pre class="code literal-block">
import weakref
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (98)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p class="rubric" id="target-99">Web construction methods used by Chunks and WebReader (99) =</p>
<pre class="code literal-block">
→Web add full chunk names, ignoring abbreviated names (<a class="reference internal" href="#target-100">100</a>)
→Web add an anonymous chunk (<a class="reference internal" href="#target-101">101</a>)
→Web add a named macro chunk (<a class="reference internal" href="#target-102">102</a>)
→Web add an output file definition chunk (<a class="reference internal" href="#target-103">103</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web construction methods used by Chunks and WebReader (99)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
<p>A name is only added to the known names when it is
a full name, not an abbreviation ending with <tt class="docutils literal"><span class="pre">&quot;...&quot;</span></tt>.
Abbreviated names are quietly skipped until the full name
is seen.</p>
<p>The algorithm for the <tt class="docutils literal">addDefName()</tt> method, then is as follows:</p>
<ol class="arabic simple">
<li>Use the <tt class="docutils literal">fullNameFor()</tt> method to locate the full name.</li>
<li>If no full name was found (the result of <tt class="docutils literal">fullNameFor()</tt> ends with <tt class="docutils literal"><span class="pre">'...'</span></tt>),
ignore this name as an abbreviation with no definition.</li>
<li>If this is a full name and the name was not in the <tt class="docutils literal">named</tt> mapping, add this full name to the mapping.</li>
</ol>
<p>This name resolution approach presents a problem when a chunk's first definition
uses an abbreviated name.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Improved use case needed.</p>
<p>We can be more flexible about assembling the web if we
tolerate &quot;...&quot; elipsis as the initial use of a name.</p>
<p>We have to fold the abbreviated name(s)
into the Web. Prior to tangling, we have to
resolve the various abbreviated names to their proper
full names. This would then merge the chunks into a single
sequence.</p>
<p>We preserve source document ordering between the variations
on the name using the chunk sequence numbers.</p>
<p>Here &quot;prior to tangling&quot; means either eagerly -- as each full name arrives --
or lazily -- after the entire Web is built.</p>
<p class="last">We would no longer need to return a value from this function, either.</p>
</div>
<p class="rubric" id="target-100">Web add full chunk names, ignoring abbreviated names (100) =</p>
<pre class="code literal-block">
def addDefName(self, name: str) -&gt; str | None:
    &quot;&quot;&quot;Reference to or definition of a chunk name.&quot;&quot;&quot;
    nm = self.fullNameFor(name)
    if nm is None: return None
    if nm[-3:] == '...':
        self.logger.debug(&quot;Abbreviated reference %r&quot;, name)
        return None # first occurance is a forward reference using an abbreviation
    if nm not in self.named:
        self.named[nm] = []
        self.logger.debug(&quot;Adding empty chunk %r&quot;, name)
    return nm
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web add full chunk names, ignoring abbreviated names (100)</em>. Used by: Web construction... (<a class="reference internal" href="#target-99">99</a>)</p>
</blockquote>
<p>An anonymous <tt class="docutils literal">Chunk</tt> is kept in a sequence of Chunks, used for
tangling.</p>
<p class="rubric" id="target-101">Web add an anonymous chunk (101) =</p>
<pre class="code literal-block">
def add(self, chunk: Chunk) -&gt; None:
    &quot;&quot;&quot;Add an anonymous chunk.&quot;&quot;&quot;
    self.chunkSeq.append(chunk)
    chunk.web = weakref.ref(self)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web add an anonymous chunk (101)</em>. Used by: Web construction... (<a class="reference internal" href="#target-99">99</a>)</p>
</blockquote>
<p>A named <tt class="docutils literal">Chunk</tt> is defined with a <tt class="docutils literal">&#64;d</tt> command.
It is collected into a mapping of <tt class="docutils literal">NamedChunk</tt> instances.
An entry in the mapping is a sequence of chunks that have the
same name.  This sequence of chunks is used to produce the
weave or tangle output.</p>
<p>All chunks are also placed in the overall sequence of chunks.
This overall sequence is used for weaving the document.</p>
<p>The <tt class="docutils literal">addDefName()</tt> method is used to resolve this name if
it is an abbreviation, or add it to the mapping if this
is the first occurance of the name.  If the name cannot be
added, an instance of our <tt class="docutils literal">Error</tt> class is raised.  If the name exists or
was added, the chunk is appended to the chunk list associated
with this name.</p>
<p>The Web's sequence counter is incremented, and this
unique sequence number sets the <tt class="docutils literal">seq</tt> attribute of the <tt class="docutils literal">Chunk</tt>.
If the chunk list was empty, this is the first chunk, the
<tt class="docutils literal">initial</tt> flag is set to True when there's only one element
in the list.  Otherwise, it's False.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Improved use case.</p>
<p class="last">If we improve name resolution, then the if and exception can go away.
The <tt class="docutils literal">addDefName()</tt> no longer needs to return a value.</p>
</div>
<p class="rubric" id="target-102">Web add a named macro chunk (102) =</p>
<pre class="code literal-block">
def addNamed(self, chunk: Chunk) -&gt; None:
    &quot;&quot;&quot;Add a named chunk to a sequence with a given name.&quot;&quot;&quot;
    self.chunkSeq.append(chunk)
    chunk.web = weakref.ref(self)
    nm = self.addDefName(chunk.name)
    if nm:
        # We found the full name for this chunk
        self.sequence += 1
        chunk.seq = self.sequence
        chunk.fullName = nm
        self.named[nm].append(chunk)
        chunk.initial = len(self.named[nm]) == 1
        self.logger.debug(&quot;Extending chunk %r from %r&quot;, nm, chunk.name)
    else:
        raise Error(f&quot;No full name for {chunk.name!r}&quot;, chunk)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web add a named macro chunk (102)</em>. Used by: Web construction... (<a class="reference internal" href="#target-99">99</a>)</p>
</blockquote>
<p>An output file definition <tt class="docutils literal">Chunk</tt> is defined with an <tt class="docutils literal">&#64;o</tt>
command.  It is collected into a mapping of <tt class="docutils literal">OutputChunk</tt> instances.
An entry in the mapping is a sequence of chunks that have the
same name.  This sequence of chunks is used to produce the
weave or tangle output.</p>
<p>Note that file names cannot be abbreviated.</p>
<p>All chunks are also placed in overall sequence of chunks.
This overall sequence is used for weaving the document.</p>
<p>If the name does not exist in the <tt class="docutils literal">output</tt> mapping,
the name is added with an empty sequence of chunks.
In all cases, the chunk is
appended to the chunk list associated
with this name.</p>
<p>The web's sequence counter is incremented, and this
unique sequence number sets the Chunk's <tt class="docutils literal">seq</tt> attribute.
If the chunk list was empty, this is the first chunk, the
<tt class="docutils literal">initial</tt> flag is True if this is the first chunk.</p>
<p class="rubric" id="target-103">Web add an output file definition chunk (103) =</p>
<pre class="code literal-block">
def addOutput(self, chunk: Chunk) -&gt; None:
    &quot;&quot;&quot;Add an output chunk to a sequence with a given name.&quot;&quot;&quot;
    self.chunkSeq.append(chunk)
    chunk.web = weakref.ref(self)
    if chunk.name not in self.output:
        self.output[chunk.name] = []
        self.logger.debug(&quot;Adding chunk %r&quot;, chunk.name)
    self.sequence += 1
    chunk.seq = self.sequence
    chunk.fullName = chunk.name
    self.output[chunk.name].append(chunk)
    chunk.initial = len(self.output[chunk.name]) == 1
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web add an output file definition chunk (103)</em>. Used by: Web construction... (<a class="reference internal" href="#target-99">99</a>)</p>
</blockquote>
</div>
<div class="section" id="web-chunk-name-resolution">
<h3><a class="toc-backref" href="#toc-entry-59">Web Chunk Name Resolution</a></h3>
<p>Web Chunk name resolution has three aspects.  The first
is resolving elided names (those ending with <tt class="docutils literal">...</tt>) to their
full names.  The second is finding the named chunk
in the web structure.  The third is returning a reference
to a specific chunk including the name and sequence number.</p>
<p>Note that a Chunk name actually refers to a sequence
of Chunk instances.  Multiple definitions for a Chunk are allowed, and
all of the definitions are concatenated to create the complete
Chunk.  This complexity makes it unwise to return the sequence
of same-named Chunk; therefore, we put the burden on the Web to
process all Chunk with a given name, in sequence.</p>
<p>The <tt class="docutils literal">fullNameFor()</tt> method resolves full name for a chunk as follows:</p>
<ol class="arabic simple">
<li>If the string is already in the <tt class="docutils literal">named</tt> mapping, this is the full name</li>
<li>If the string ends in <tt class="docutils literal"><span class="pre">'...'</span></tt>, visit each key in the dictionary
to see if the key starts with the string up to the trailing <tt class="docutils literal"><span class="pre">'...'</span></tt>.
If a match is found, the dictionary key is the full name.</li>
<li>Otherwise, treat this as a full name.</li>
</ol>
<p class="rubric" id="target-104">Web Chunk name resolution methods (104) =</p>
<pre class="code literal-block">
def fullNameFor(self, name: str) -&gt; str:
    &quot;&quot;&quot;Resolve &quot;...&quot; names into the full name.&quot;&quot;&quot;
    if name in self.named: return name
    if name[-3:] == '...':
        best = [ n for n in self.named.keys()
            if n.startswith(name[:-3]) ]
        if len(best) &gt; 1:
            raise Error(f&quot;Ambiguous abbreviation {name!r}, matches {list(sorted(best))!r}&quot;)
        elif len(best) == 1:
            return best[0]
    return name
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web Chunk name resolution methods (104)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">getchunk()</tt> method locates a named sequence of chunks by first determining the full name
for the identifying string.  If full name is in the <tt class="docutils literal">named</tt> mapping, the sequence
of chunks is returned.  Otherwise, an instance of our <tt class="docutils literal">Error</tt> class is raised because the name
is unresolvable.</p>
<p>It might be more helpful for debugging to emit this as an error in the
weave and tangle results and keep processing.  This would allow an author to
catch multiple errors in a single run of <strong>py-web-tool</strong> .</p>
<p class="rubric" id="target-105">Web Chunk name resolution methods (105) +=</p>
<pre class="code literal-block">
def getchunk(self, name: str) -&gt; list[Chunk]:
    &quot;&quot;&quot;Locate a named sequence of chunks.&quot;&quot;&quot;
    nm = self.fullNameFor(name)
    if nm in self.named:
        return self.named[nm]
    raise Error(f&quot;Cannot resolve {name!r} in {self.named.keys()!r}&quot;)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web Chunk name resolution methods (105)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
</div>
<div class="section" id="web-cross-reference-support">
<h3><a class="toc-backref" href="#toc-entry-60">Web Cross-Reference Support</a></h3>
<p>Cross-reference support includes creating and reporting
on the various cross-references available in a web.  This includes
creating the list of chunks that reference a given chunk;
and returning the file, macro and user identifier cross references.</p>
<p>Each <tt class="docutils literal">Chunk</tt> has a list <tt class="docutils literal">Reference</tt> commands that shows the chunks
to which a chunk refers.  These relationships must be reversed to show
the chunks that refer to a given chunk.  This is done by traversing
the entire web of named chunks and recording each chunk-to-chunk reference.
This mapping has the referred-to chunk as
the key, and a sequence of referring chunks as the value.</p>
<p>The accumulation is initiated by the web's <tt class="docutils literal">createUsedBy()</tt> method.  This
method visits a <tt class="docutils literal">Chunk</tt>, calling the <tt class="docutils literal">genReferences()</tt> method,
passing in the <tt class="docutils literal">Web</tt> instance
as an argument.  Each <tt class="docutils literal">Chunk</tt> class <tt class="docutils literal">genReferences()</tt> method, in turn,
invokes the <tt class="docutils literal">usedBy()</tt> method
of each <tt class="docutils literal">Command</tt> instance in the chunk.  Most commands do nothing,
but a <tt class="docutils literal">ReferenceCommand</tt>
will resolve the name to which it refers.</p>
<p>When the <tt class="docutils literal">createUsedBy()</tt> method has accumulated the entire cross
reference, it also assures that all chunks are used exactly once.</p>
<p class="rubric" id="target-106">Web Chunk cross reference methods (106) =</p>
<pre class="code literal-block">
def createUsedBy(self) -&gt; None:
    &quot;&quot;&quot;Update every piece of a Chunk to show how the chunk is referenced.
    Each piece can then report where it's used in the web.
    &quot;&quot;&quot;
    for aChunk in self.chunkSeq:
        #usage = (self.fullNameFor(aChunk.name), aChunk.seq)
        for aRefName in aChunk.genReferences(self):
            for c in self.getchunk(aRefName):
                c.referencedBy.append(aChunk)
                c.refCount += 1

    →Web Chunk check reference counts are all one (<a class="reference internal" href="#target-107">107</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web Chunk cross reference methods (106)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
<p>We verify that the reference count for a
Chunk is exactly one.  We don't gracefully tolerate multiple references to
a Chunk or unreferenced chunks.</p>
<p class="rubric" id="target-107">Web Chunk check reference counts are all one (107) =</p>
<pre class="code literal-block">
for nm in self.no_reference():
    self.logger.warning(&quot;No reference to %r&quot;, nm)
for nm in self.multi_reference():
    self.logger.warning(&quot;Multiple references to %r&quot;, nm)
for nm in self.no_definition():
    self.logger.error(&quot;No definition for %r&quot;, nm)
    self.errors += 1
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web Chunk check reference counts are all one (107)</em>. Used by: Web Chunk cross reference methods... (<a class="reference internal" href="#target-106">106</a>)</p>
</blockquote>
<p>An alternative one-pass version of the above algorithm:</p>
<pre class="literal-block">
for nm,cl in self.named.items():
    if len(cl) &gt; 0:
        if cl[0].refCount == 0:
           self.logger.warning(&quot;No reference to %r&quot;, nm)
        elif cl[0].refCount &gt; 1:
           self.logger.warning(&quot;Multiple references to %r&quot;, nm)
    else:
        self.logger.error(&quot;No definition for %r&quot;, nm)
</pre>
<p>We use three methods to filter chunk names into
the various warning categories.  The <tt class="docutils literal">no_reference</tt> list
is a list of chunks defined by never referenced.
The <tt class="docutils literal">multi_reference</tt> list
is a list of chunks defined by never referenced.
The <tt class="docutils literal">no_definition</tt> list
is a list of chunks referenced but not defined.</p>
<p class="rubric" id="target-108">Web Chunk cross reference methods (108) +=</p>
<pre class="code literal-block">
def no_reference(self) -&gt; list[str]:
    return [nm for nm, cl in self.named.items() if len(cl)&gt;0 and cl[0].refCount == 0]
def multi_reference(self) -&gt; list[str]:
    return [nm for nm, cl in self.named.items() if len(cl)&gt;0 and cl[0].refCount &gt; 1]
def no_definition(self) -&gt; list[str]:
    return [nm for nm, cl in self.named.items() if len(cl) == 0]
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web Chunk cross reference methods (108)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">fileXref()</tt> method visits all named file output chunks in <tt class="docutils literal">output</tt> and
collects the sequence numbers of each section in the sequence of chunks.</p>
<p>The <tt class="docutils literal">chunkXref()</tt> method uses the same algorithm as a the <tt class="docutils literal">fileXref()</tt> method,
but applies it to the <tt class="docutils literal">named</tt> mapping.</p>
<p class="rubric" id="target-109">Web Chunk cross reference methods (109) +=</p>
<pre class="code literal-block">
def fileXref(self) -&gt; dict[str, list[int]]:
    fx = {}
    for f, cList in self.output.items():
        fx[f] = [c.seq for c in cList]
    return fx
def chunkXref(self) -&gt; dict[str, list[int]]:
    mx = {}
    for n, cList in self.named.items():
        mx[n] = [c.seq for c in cList]
    return mx
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web Chunk cross reference methods (109)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">userNamesXref()</tt> method creates a mapping for each
user identifier.  The value for this mapping is a tuple
with the chunk that defined the identifer (via a <tt class="docutils literal">&#64;|</tt> command),
and a sequence of chunks that reference the identifier.</p>
<p>For example:
<tt class="docutils literal">{'Web': (87, <span class="pre">(88,93,96,101,102,104)),</span> 'Chunk': (53, <span class="pre">(54,55,56,60,57,58,59))}</span></tt>,
shows that the identifier
<tt class="docutils literal">'Web'</tt> is defined in chunk with a sequence number of 87, and referenced
in the sequence of chunks that follow.</p>
<p>This works in two passes:</p>
<ol class="arabic simple">
<li><tt class="docutils literal">_gatherUserId()</tt> gathers all user identifiers</li>
<li><tt class="docutils literal">_updateUserId()</tt> searches all text commands for the identifiers
and updates the <tt class="docutils literal">Web</tt> class cross reference information.</li>
</ol>
<p class="rubric" id="target-110">Web Chunk cross reference methods (110) +=</p>
<pre class="code literal-block">
def userNamesXref(self) -&gt; dict[str, tuple[int, list[int]]]:
    ux: dict[str, tuple[int, list[int]]] = {}
    self._gatherUserId(self.named, ux)
    self._gatherUserId(self.output, ux)
    self._updateUserId(self.named, ux)
    self._updateUserId(self.output, ux)
    return ux

def _gatherUserId(self, chunkMap: dict[str, list[Chunk]], ux: dict[str, tuple[int, list[int]]]) -&gt; None:
    →collect all user identifiers from a given map into ux (<a class="reference internal" href="#target-111">111</a>)

def _updateUserId(self, chunkMap: dict[str, list[Chunk]], ux: dict[str, tuple[int, list[int]]]) -&gt; None:
    →find user identifier usage and update ux from the given map (<a class="reference internal" href="#target-112">112</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web Chunk cross reference methods (110)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
<p>User identifiers are collected by visiting each of the sequence of
<tt class="docutils literal">Chunks</tt> that share the
same name; within each component chunk, if chunk has identifiers assigned
by the <tt class="docutils literal">&#64;|</tt> command, these are seeded into the dictionary.
If the chunk does not permit identifiers, it simply returns an empty
list as a default action.</p>
<p class="rubric" id="target-111">collect all user identifiers from a given map into ux (111) =</p>
<pre class="code literal-block">
for n,cList in chunkMap.items():
    for c in cList:
        for id in c.getUserIDRefs():
            ux[id] = (c.seq, [])
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>collect all user identifiers from a given map into ux (111)</em>. Used by: Web Chunk cross reference methods... (<a class="reference internal" href="#target-110">110</a>)</p>
</blockquote>
<p>User identifiers are cross-referenced by visiting
each of the sequence of <tt class="docutils literal">Chunks</tt> that share the
same name; within each component chunk, visit each user identifier;
if the <tt class="docutils literal">Chunk</tt> class <tt class="docutils literal">searchForRE()</tt> method matches an identifier,
this is appended to the sequence of chunks that reference the original user identifier.</p>
<p class="rubric" id="target-112">find user identifier usage and update ux from the given map (112) =</p>
<pre class="code literal-block">
# examine source for occurrences of all names in ux.keys()
for id in ux.keys():
    self.logger.debug(&quot;References to %r&quot;, id)
    idpat = re.compile(f'\\W{id}\\W')
    for n,cList in chunkMap.items():
        for c in cList:
            if c.seq != ux[id][0] and c.searchForRE(idpat):
                ux[id][1].append(c.seq)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>find user identifier usage and update ux from the given map (112)</em>. Used by: Web Chunk cross reference methods... (<a class="reference internal" href="#target-110">110</a>)</p>
</blockquote>
</div>
<div class="section" id="loop-detection">
<h3><a class="toc-backref" href="#toc-entry-61">Loop Detection</a></h3>
<p>How do we assure that the web is a proper tree and doesn't contain any loops?</p>
<p>Consider this example web</p>
<pre class="literal-block">
&#64;o example1 &#64;{
    &#64;&lt;part 1A&#64;&gt;
&#64;}

&#64;d part 1A &#64;{
    &#64;&lt;part 1B&#64;&gt;
&#64;}

&#64;d part 1B &#64;{
    &#64;&lt;part 1A&#64;&gt;
&#64;}
</pre>
<p>All valid chunks are must be referenced from a <tt class="docutils literal">&#64;o</tt> chunk, either directly,
or indirectly via one or more <tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt> references. This defines a
proper tree with <tt class="docutils literal">&#64;o</tt> at the root and children at each <tt class="docutils literal">&#64;d</tt>.</p>
<p>Each chunk can have multiple references to further <tt class="docutils literal">&#64;d</tt> definitions.
No chunk can reference the <tt class="docutils literal">&#64;o</tt> definition at the root.</p>
<p>To be circular, two <tt class="docutils literal">&#64;d</tt> chunks must reference each other.</p>
<p>To be valid, either (or both) must be named by the <tt class="docutils literal">&#64;o</tt>. There will, therefore,
be two references: from the <tt class="docutils literal">&#64;o</tt> and a <tt class="docutils literal">&#64;d</tt>. Our check for duplicate references will spot this.</p>
<p>We do not need to do a proper BFS or DFS through the graph to check for loops.
The simple reference count will do.</p>
</div>
<div class="section" id="tangle-and-weave-support">
<h3><a class="toc-backref" href="#toc-entry-62">Tangle and Weave Support</a></h3>
<p>The <tt class="docutils literal">language()</tt> method makes a stab at determining the output language.
The determination of the language can be done a variety of ways.
One is to use command line parameters, another is to use the filename
extension on the input file.</p>
<p>We examine the first few characters of input.  A proper HTML, XHTML or
XML file begins with '&lt;!', '&lt;?' or '&lt;H'.
LaTeX files typically begin with '%' or ''.
Everything else is probably RST.</p>
<p class="rubric" id="target-113">Web determination of the language from the first chunk (113) =</p>
<pre class="code literal-block">
def language(self, preferredWeaverClass: type[&quot;Weaver&quot;] | None = None) -&gt; &quot;Weaver&quot;:
    &quot;&quot;&quot;Construct a weaver appropriate to the document's language&quot;&quot;&quot;
    if preferredWeaverClass:
        return preferredWeaverClass()
    self.logger.debug(&quot;Picking a weaver based on first chunk %r&quot;, str(self.chunkSeq[0])[:4])
    if self.chunkSeq[0].startswith('&lt;'):
        return HTML()
    if self.chunkSeq[0].startswith('%') or self.chunkSeq[0].startswith('\\'):
        return LaTeX()
    return RST()
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web determination of the language from the first chunk (113)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">tangle()</tt> method of the <tt class="docutils literal">Web</tt> class performs
the <tt class="docutils literal">tangle()</tt> method for each <tt class="docutils literal">Chunk</tt> of each
named output file.  Note that several <tt class="docutils literal">Chunks</tt> may share the file name, requiring
the file be composed of material from each <tt class="docutils literal">Chunk</tt>, in order.</p>
<p class="rubric" id="target-114">Web tangle the output files (114) =</p>
<pre class="code literal-block">
def tangle(self, aTangler: &quot;Tangler&quot;) -&gt; None:
    for f, c in self.output.items():
        with aTangler.open(Path(f)):
            for p in c:
                p.tangle(self, aTangler)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web tangle the output files (114)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">weave()</tt> method of the <tt class="docutils literal">Web</tt> class creates the final documentation.
This is done by stepping through each <tt class="docutils literal">Chunk</tt> in sequence
and weaving the chunk into the resulting file via the <tt class="docutils literal">Chunk</tt> class <tt class="docutils literal">weave()</tt> method.</p>
<p>During weaving of a chunk, the chunk may reference another
chunk.  When weaving a reference to a named chunk (output or ordinary programming
source defined with <tt class="docutils literal">&#64;{</tt>), this does not lead to transitive weaving: only a
reference is put in from one chunk to another.  However, when weaving
a chunk defined with <tt class="docutils literal">&#64;[</tt>, the chunk <em>is</em> expanded when weaving.
The decision is delegated to the referenced chunk.</p>
<dl class="docutils">
<dt><strong>TODO</strong> Can we refactor weaveChunk out of here entirely?</dt>
<dd>Should it go in <tt class="docutils literal">ReferenceCommand <span class="pre">weave...</span></tt>?</dd>
</dl>
<p class="rubric" id="target-115">Web weave the output document (115) =</p>
<pre class="code literal-block">
def weave(self, aWeaver: &quot;Weaver&quot;) -&gt; None:
    self.logger.debug(&quot;Weaving file from %r&quot;, self.web_path)
    if not self.web_path:
        raise Error(&quot;No filename supplied for weaving.&quot;)
    with aWeaver.open(self.web_path):
        for c in self.chunkSeq:
            c.weave(self, aWeaver)

def weaveChunk(self, name: str, aWeaver: &quot;Weaver&quot;) -&gt; None:
    self.logger.debug(&quot;Weaving chunk %r&quot;, name)
    chunkList = self.getchunk(name)
    if not chunkList:
        raise Error(f&quot;No Definition for {name!r}&quot;)
    chunkList[0].weaveReferenceTo(self, aWeaver)
    for p in chunkList[1:]:
        aWeaver.write(aWeaver.referenceSep())
        p.weaveShortReferenceTo(self, aWeaver)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Web weave the output document (115)</em>. Used by: Web class... (<a class="reference internal" href="#target-97">97</a>)</p>
</blockquote>
</div>
<div class="section" id="the-webreader-class">
<h3><a class="toc-backref" href="#toc-entry-63">The WebReader Class</a></h3>
<p>There are two forms of the constructor for a <tt class="docutils literal">WebReader</tt>.  The
initial <tt class="docutils literal">WebReader</tt> instance is created with code like the following:</p>
<pre class="literal-block">
p = WebReader()
p.command = options.commandCharacter
</pre>
<p>This will define the command character; usually provided as a command-line parameter to the application.</p>
<p>When processing an include file (with the <tt class="docutils literal">&#64;i</tt> command), a child <tt class="docutils literal">WebReader</tt>
instance is created with code like the following:</p>
<pre class="literal-block">
c = WebReader(parent=parentWebReader)
</pre>
<p>This will inherit the configuration from the parent <tt class="docutils literal">WebReader</tt>.
This will also include a  reference from child to parent so that embedded Python expressions
can view the entire input context.</p>
<p>The <tt class="docutils literal">WebReader</tt> class parses the input file into command blocks.
These are assembled into <tt class="docutils literal">Chunks</tt>, and the <tt class="docutils literal">Chunks</tt> are assembled into the document
<tt class="docutils literal">Web</tt>.  Once this input pass is complete, the resulting <tt class="docutils literal">Web</tt> can be tangled or
woven.</p>
<p>&quot;Structural&quot; commands define the structure of the <tt class="docutils literal">Chunks</tt>.  The  structural commands
are <tt class="docutils literal">&#64;d</tt> and <tt class="docutils literal">&#64;o</tt>, as well as the <tt class="docutils literal">&#64;{</tt>, <tt class="docutils literal">&#64;}</tt>, <tt class="docutils literal">&#64;[</tt>, <tt class="docutils literal">&#64;]</tt> brackets,
and the <tt class="docutils literal">&#64;i</tt> command to include another file.</p>
<p>&quot;Inline&quot; commands are inline within a <tt class="docutils literal">Chunk</tt>: they define internal <tt class="docutils literal">Commands</tt>.
Blocks of text are minor commands, as well as the <tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt> references.
The <tt class="docutils literal">&#64;&#64;</tt> escape is also
handled here so that all further processing is independent of any parsing.</p>
<p>&quot;Content&quot; commands generate woven content. These include
the various cross-reference commands (<tt class="docutils literal">&#64;f</tt>, <tt class="docutils literal">&#64;m</tt> and <tt class="docutils literal">&#64;u</tt>).</p>
<p>There are two class-level <tt class="docutils literal">OptionParser</tt> instances used by this class.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">output_option_parser:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">An <tt class="docutils literal">OptionParser</tt> used to parse the <tt class="docutils literal">&#64;o</tt> command.</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">definition_option_parser:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">An <tt class="docutils literal">OptionParser</tt> used to parse the <tt class="docutils literal">&#64;d</tt> command.</td>
</tr>
</tbody>
</table>
<p>The class has the following attributes:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">parent:</th><td class="field-body">is the outer <tt class="docutils literal">WebReader</tt> when processing a <tt class="docutils literal">&#64;i</tt> command.</td>
</tr>
<tr class="field"><th class="field-name">command:</th><td class="field-body">is the command character; a WebReader will use the parent command
character if the parent is not <tt class="docutils literal">None</tt>.</td>
</tr>
<tr class="field"><th class="field-name">permitList:</th><td class="field-body">is the list of commands that are permitted to fail.  This is generally
an empty list or <tt class="docutils literal"><span class="pre">('&#64;i',)</span></tt>.</td>
</tr>
<tr class="field"><th class="field-name">_source:</th><td class="field-body">The open source being used by <tt class="docutils literal">load()</tt>.</td>
</tr>
<tr class="field"><th class="field-name">filePath:</th><td class="field-body">is used to pass the file name to the Web instance.</td>
</tr>
<tr class="field"><th class="field-name">theWeb:</th><td class="field-body">is the current open Web.</td>
</tr>
<tr class="field"><th class="field-name">tokenizer:</th><td class="field-body">An instance of <tt class="docutils literal">Tokenizer</tt> used to parse the input. This is built
when <tt class="docutils literal">load()</tt> is called.</td>
</tr>
<tr class="field"><th class="field-name">aChunk:</th><td class="field-body">is the current open Chunk being built.</td>
</tr>
<tr class="field"><th class="field-name">totalLines:</th><td class="field-body"></td>
</tr>
<tr class="field"><th class="field-name">totalFiles:</th><td class="field-body">Summaries</td>
</tr>
</tbody>
</table>
<p class="rubric" id="target-116">WebReader class - parses the input file, building the Web structure (116) =</p>
<pre class="code literal-block">
class WebReader:
    &quot;&quot;&quot;Parse an input file, creating Chunks and Commands.&quot;&quot;&quot;

    output_option_parser = OptionParser(
        OptionDef(&quot;-start&quot;, nargs=1, default=None),
        OptionDef(&quot;-end&quot;, nargs=1, default=&quot;&quot;),
        OptionDef(&quot;argument&quot;, nargs='*'),
    )

    definition_option_parser = OptionParser(
        OptionDef(&quot;-indent&quot;, nargs=0),
        OptionDef(&quot;-noindent&quot;, nargs=0),
        OptionDef(&quot;argument&quot;, nargs='*'),
    )

    # State of reading and parsing.
    tokenizer: Tokenizer
    aChunk: Chunk

    # Configuration
    command: str
    permitList: list[str]

    # State of the reader
    _source: TextIO
    filePath: Path
    theWeb: &quot;Web&quot;

    def __init__(self, parent: Optional[&quot;WebReader&quot;] = None) -&gt; None:
        self.logger = logging.getLogger(self.__class__.__qualname__)

        # Configuration of this reader.
        self.parent = parent
        if self.parent:
            self.command = self.parent.command
            self.permitList = self.parent.permitList
        else: # Defaults until overridden
            self.command = '&#64;'
            self.permitList = []

        # Summary
        self.totalLines = 0
        self.totalFiles = 0
        self.errors = 0

        →WebReader command literals (<a class="reference internal" href="#target-133">133</a>)

    def __str__(self) -&gt; str:
        return self.__class__.__name__

    →WebReader location in the input stream (<a class="reference internal" href="#target-130">130</a>)
    →WebReader load the web (<a class="reference internal" href="#target-132">132</a>)
    →WebReader handle a command string (<a class="reference internal" href="#target-117">117</a>), →(<a class="reference internal" href="#target-129">129</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>WebReader class - parses the input file, building the Web structure (116)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
<p>Command recognition is done via a <strong>Chain of Command</strong>-like design.
There are two conditions: the command string is recognized or it is not recognized.
If the command is recognized, <tt class="docutils literal">handleCommand()</tt> either:</p>
<blockquote>
<ul class="simple">
<li>(for &quot;structural&quot; commands) attaches the current <tt class="docutils literal">Chunk</tt> (<em>self.aChunk</em>) to the
current <tt class="docutils literal">Web</tt> (<em>self.aWeb</em>), <strong>or</strong></li>
<li>(for &quot;inline&quot; and &quot;content&quot; commands) create a <tt class="docutils literal">Command</tt>, attach it to the current
<tt class="docutils literal">Chunk</tt> (<em>self.aChunk</em>)</li>
</ul>
</blockquote>
<p>and returns a true result.</p>
<p>If the command is not recognized, <tt class="docutils literal">handleCommand()</tt> returns false.</p>
<p>A subclass can override <tt class="docutils literal">handleCommand()</tt> to</p>
<ol class="arabic simple">
<li>call this superclass version;</li>
<li>if the command is unknown to the superclass,
then the subclass can attempt to process it;</li>
<li>if the command is unknown to both classes,
then return false.  Either a subclass will handle it, or the default activity taken
by <tt class="docutils literal">load()</tt> is to treat the command a text, but also issue a warning.</li>
</ol>
<p class="rubric" id="target-117">WebReader handle a command string (117) =</p>
<pre class="code literal-block">
def handleCommand(self, token: str) -&gt; bool:
    self.logger.debug(&quot;Reading %r&quot;, token)

    →major commands segment the input into separate Chunks (<a class="reference internal" href="#target-118">118</a>)
    →minor commands add Commands to the current Chunk (<a class="reference internal" href="#target-123">123</a>)
    elif token[:2] in (self.cmdlcurl,self.cmdlbrak):
        # These should have been consumed as part of &#64;o and &#64;d parsing
        self.logger.error(&quot;Extra %r (possibly missing chunk name) near %r&quot;, token, self.location())
        self.errors += 1
    else:
        return False  # did not recogize the command
    return True  # did recognize the command
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>WebReader handle a command string (117)</em>. Used by: WebReader class... (<a class="reference internal" href="#target-116">116</a>)</p>
</blockquote>
<p>The following sequence of <tt class="docutils literal">if</tt>-<tt class="docutils literal">elif</tt> statements identifies
the structural commands that partition the input into separate <tt class="docutils literal">Chunks</tt>.</p>
<p class="rubric" id="target-118">major commands segment the input into separate Chunks (118) =</p>
<pre class="code literal-block">
if token[:2] == self.cmdo:
    →start an OutputChunk, adding it to the web (<a class="reference internal" href="#target-119">119</a>)
elif token[:2] == self.cmdd:
    →start a NamedChunk or NamedDocumentChunk, adding it to the web (<a class="reference internal" href="#target-120">120</a>)
elif token[:2] == self.cmdi:
    →include another file (<a class="reference internal" href="#target-121">121</a>)
elif token[:2] in (self.cmdrcurl,self.cmdrbrak):
    →finish a chunk, start a new Chunk adding it to the web (<a class="reference internal" href="#target-122">122</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>major commands segment the input into separate Chunks (118)</em>. Used by: WebReader handle a command... (<a class="reference internal" href="#target-117">117</a>)</p>
</blockquote>
<p>An output chunk has the form <tt class="docutils literal">&#64;o</tt> <em>name</em> <tt class="docutils literal">&#64;{</tt> <em>content</em> <tt class="docutils literal">&#64;}</tt>.
We use the first two tokens to name the <tt class="docutils literal">OutputChunk</tt>.  We simply expect
the <tt class="docutils literal">&#64;{</tt> separator.  We then attach all subsequent commands
to this chunk while waiting for the final <tt class="docutils literal">&#64;}</tt> token to end the chunk.</p>
<p>We'll use an <tt class="docutils literal">OptionParser</tt> to locate the optional parameters.  This will then let
us build an appropriate instance of <tt class="docutils literal">OutputChunk</tt>.</p>
<p>With some small additional changes, we could use <tt class="docutils literal"><span class="pre">OutputChunk(**options)</span></tt>.</p>
<p class="rubric" id="target-119">start an OutputChunk, adding it to the web (119) =</p>
<pre class="code literal-block">
args = next(self.tokenizer)
self.expect((self.cmdlcurl,))
options = self.output_option_parser.parse(args)
self.aChunk = OutputChunk(
    name=' '.join(options['argument']),
    comment_start=''.join(options.get('start', &quot;# &quot;)),
    comment_end=''.join(options.get('end', &quot;&quot;)),
)
self.aChunk.filePath = self.filePath
self.aChunk.webAdd(self.theWeb)
# capture an OutputChunk up to &#64;}
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>start an OutputChunk, adding it to the web (119)</em>. Used by: major commands... (<a class="reference internal" href="#target-118">118</a>)</p>
</blockquote>
<p>A named chunk has the form <tt class="docutils literal">&#64;d</tt> <em>name</em> <tt class="docutils literal">&#64;{</tt> <em>content</em> <tt class="docutils literal">&#64;}</tt> for
code and <tt class="docutils literal">&#64;d</tt> <em>name</em> <tt class="docutils literal">&#64;[</tt> <em>content</em> <tt class="docutils literal">&#64;]</tt> for document source.
We use the first two tokens to name the <tt class="docutils literal">NamedChunk</tt> or <tt class="docutils literal">NamedDocumentChunk</tt>.
We expect either the <tt class="docutils literal">&#64;{</tt> or <tt class="docutils literal">&#64;[</tt> separator, and use the actual
token found to choose which subclass of <tt class="docutils literal">Chunk</tt> to create.
We then attach all subsequent commands
to this chunk while waiting for the final <tt class="docutils literal">&#64;}</tt> or <tt class="docutils literal">&#64;]</tt> token to
end the chunk.</p>
<p>We'll use an <tt class="docutils literal">OptionParser</tt> to locate the optional parameter of <tt class="docutils literal"><span class="pre">-noindent</span></tt>.</p>
<p>[Or possibly <tt class="docutils literal"><span class="pre">-indent</span></tt> <em>number</em>?]</p>
<p>Then we can use options to create an appropriate subclass of <tt class="docutils literal">NamedChunk</tt>.</p>
<p>If &quot;-indent&quot; is in options, this is the default.
If both are in the options, we can provide a warning, I guess.</p>
<p><strong>TODO:</strong> Add a warning for conflicting options.</p>
<p class="rubric" id="target-120">start a NamedChunk or NamedDocumentChunk, adding it to the web (120) =</p>
<pre class="code literal-block">
args = next(self.tokenizer)
brack = self.expect((self.cmdlcurl,self.cmdlbrak))
options = self.output_option_parser.parse(args)
name = ' '.join(options['argument'])

if brack == self.cmdlbrak:
    self.aChunk = NamedDocumentChunk(name)
elif brack == self.cmdlcurl:
    if '-noindent' in options:
        self.aChunk = NamedChunk_Noindent(name)
    else:
        self.aChunk = NamedChunk(name)
elif brack == None:
    pass # Error noted by expect()
else:
    raise Error(&quot;Design Error&quot;)

self.aChunk.filePath = self.filePath
self.aChunk.webAdd(self.theWeb)
# capture a NamedChunk up to &#64;} or &#64;]
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>start a NamedChunk or NamedDocumentChunk, adding it to the web (120)</em>. Used by: major commands... (<a class="reference internal" href="#target-118">118</a>)</p>
</blockquote>
<p>An import command has the unusual form of <tt class="docutils literal">&#64;i</tt> <em>name</em>, with no trailing
separator.  When we encounter the <tt class="docutils literal">&#64;i</tt> token, the next token will start with the
file name, but may continue with an anonymous chunk.  We require that all <tt class="docutils literal">&#64;i</tt> commands
occur at the end of a line, and break on the <tt class="docutils literal">'\n'</tt> which must occur after the file name.
This permits file names with embedded spaces. It also permits arguments and options,
if really necessary.</p>
<p>Once we have split the file name away from the rest of the following anonymous chunk,
we push the following token back into the token stream, so that it will be the
first token examined at the top of the <tt class="docutils literal">load()</tt> loop.</p>
<p>We create a child <tt class="docutils literal">WebReader</tt> instance to process the included file.  The entire file
is loaded into the current <tt class="docutils literal">Web</tt> instance.  A new, empty <tt class="docutils literal">Chunk</tt> is created at the end
of the file so that processing can resume with an anonymous <tt class="docutils literal">Chunk</tt>.</p>
<p>The reader has a <tt class="docutils literal">permitList</tt> attribute.
This lists any commands where failure is permitted.  Currently, only the <tt class="docutils literal">&#64;i</tt> command
can be set to permit failure; this allows a <tt class="docutils literal">.w</tt> to include
a file that does not yet exist.</p>
<p>The primary use case for this feature is when weaving test output.
The first pass of <strong>py-web-tool</strong>  tangles the program source files; they are
then run to create test output; the second pass of <strong>py-web-tool</strong>  weaves this
test output into the final document via the <tt class="docutils literal">&#64;i</tt> command.</p>
<p class="rubric" id="target-121">include another file (121) =</p>
<pre class="code literal-block">
incPath = Path(next(self.tokenizer).strip())
try:
    self.logger.info(&quot;Including %r&quot;, incPath)
    include = WebReader(parent=self)
    include.load(self.theWeb, incPath)
    self.totalLines += include.tokenizer.lineNumber
    self.totalFiles += include.totalFiles
    if include.errors:
        self.errors += include.errors
        self.logger.error(&quot;Errors in included file '%s', output is incomplete.&quot;, incPath)
except Error as e:
    self.logger.error(&quot;Problems with included file '%s', output is incomplete.&quot;, incPath)
    self.errors += 1
except IOError as e:
    self.logger.error(&quot;Problems finding included file '%s', output is incomplete.&quot;, incPath)
    # Discretionary -- sometimes we want to continue
    if self.cmdi in self.permitList: pass
    else: raise  # Seems heavy-handed, but, the file wasn't found!
self.aChunk = Chunk()
self.aChunk.webAdd(self.theWeb)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>include another file (121)</em>. Used by: major commands... (<a class="reference internal" href="#target-118">118</a>)</p>
</blockquote>
<p>When a <tt class="docutils literal">&#64;}</tt> or <tt class="docutils literal">&#64;]</tt> are found, this finishes a named chunk.  The next
text is therefore part of an anonymous chunk.</p>
<p>Note that no check is made to assure that the previous <tt class="docutils literal">Chunk</tt> was indeed a named
chunk or output chunk started with <tt class="docutils literal">&#64;{</tt> or <tt class="docutils literal">&#64;[</tt>.
To do this, an attribute would be
needed for each <tt class="docutils literal">Chunk</tt> subclass that indicated if a trailing bracket was necessary.
For the base <tt class="docutils literal">Chunk</tt> class, this would be false, but for all other subclasses of
<tt class="docutils literal">Chunk</tt>, this would be true.</p>
<p class="rubric" id="target-122">finish a chunk, start a new Chunk adding it to the web (122) =</p>
<pre class="code literal-block">
self.aChunk = Chunk()
self.aChunk.webAdd(self.theWeb)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>finish a chunk, start a new Chunk adding it to the web (122)</em>. Used by: major commands... (<a class="reference internal" href="#target-118">118</a>)</p>
</blockquote>
<p>The following sequence of <tt class="docutils literal">elif</tt> statements identifies
the minor commands that add <tt class="docutils literal">Command</tt> instances to the current open <tt class="docutils literal">Chunk</tt>.</p>
<p class="rubric" id="target-123">minor commands add Commands to the current Chunk (123) =</p>
<pre class="code literal-block">
elif token[:2] == self.cmdpipe:
    →assign user identifiers to the current chunk (<a class="reference internal" href="#target-124">124</a>)
elif token[:2] == self.cmdf:
    self.aChunk.append(FileXrefCommand(self.tokenizer.lineNumber))
elif token[:2] == self.cmdm:
    self.aChunk.append(MacroXrefCommand(self.tokenizer.lineNumber))
elif token[:2] == self.cmdu:
    self.aChunk.append(UserIdXrefCommand(self.tokenizer.lineNumber))
elif token[:2] == self.cmdlangl:
    →add a reference command to the current chunk (<a class="reference internal" href="#target-125">125</a>)
elif token[:2] == self.cmdlexpr:
    →add an expression command to the current chunk (<a class="reference internal" href="#target-127">127</a>)
elif token[:2] == self.cmdcmd:
    →double at-sign replacement, append this character to previous TextCommand (<a class="reference internal" href="#target-128">128</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>minor commands add Commands to the current Chunk (123)</em>. Used by: WebReader handle a command... (<a class="reference internal" href="#target-117">117</a>)</p>
</blockquote>
<p>User identifiers occur after a <tt class="docutils literal">&#64;|</tt> in a <tt class="docutils literal">NamedChunk</tt>.</p>
<p>Note that no check is made to assure that the previous <tt class="docutils literal">Chunk</tt> was indeed a named
chunk or output chunk started with <tt class="docutils literal">&#64;{</tt>.
To do this, an attribute would be
needed for each <tt class="docutils literal">Chunk</tt> subclass that indicated if user identifiers are permitted.
For the base <tt class="docutils literal">Chunk</tt> class, this would be false, but for the <tt class="docutils literal">NamedChunk</tt> class and
<tt class="docutils literal">OutputChunk</tt> class, this would be true.</p>
<p>User identifiers are name references at the end of a NamedChunk
These are accumulated and expanded by <tt class="docutils literal">&#64;u</tt> reference</p>
<p class="rubric" id="target-124">assign user identifiers to the current chunk (124) =</p>
<pre class="code literal-block">
try:
    self.aChunk.setUserIDRefs(next(self.tokenizer).strip())
except AttributeError:
    # Out of place &#64;| user identifier command
    self.logger.error(&quot;Unexpected references near %r: %r&quot;, self.location(), token)
    self.errors += 1
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>assign user identifiers to the current chunk (124)</em>. Used by: minor commands... (<a class="reference internal" href="#target-123">123</a>)</p>
</blockquote>
<p>A reference command has the form <tt class="docutils literal">&#64;&lt;</tt><em>name</em><tt class="docutils literal">&#64;&gt;</tt>.  We accept three
tokens from the input, the middle token is the referenced name.</p>
<p class="rubric" id="target-125">add a reference command to the current chunk (125) =</p>
<pre class="code literal-block">
# get the name, introduce into the named Chunk dictionary
expand = next(self.tokenizer).strip()
closing = self.expect((self.cmdrangl,))
self.theWeb.addDefName(expand)
self.aChunk.append(ReferenceCommand(expand, self.tokenizer.lineNumber))
self.aChunk.appendText(&quot;&quot;, self.tokenizer.lineNumber) # to collect following text
self.logger.debug(&quot;Reading %r %r&quot;, expand, closing)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>add a reference command to the current chunk (125)</em>. Used by: minor commands... (<a class="reference internal" href="#target-123">123</a>)</p>
</blockquote>
<p>An expression command has the form <tt class="docutils literal">&#64;(</tt><em>Python Expression</em><tt class="docutils literal">&#64;)</tt>.
We accept three
tokens from the input, the middle token is the expression.</p>
<p>There are two alternative semantics for an embedded expression.</p>
<ul class="simple">
<li><strong>Deferred Execution</strong>.  This requires definition of a new subclass of <tt class="docutils literal">Command</tt>,
<tt class="docutils literal">ExpressionCommand</tt>, and appends it into the current <tt class="docutils literal">Chunk</tt>.  At weave and
tangle time, this expression is evaluated.  The insert might look something like this:
<tt class="docutils literal">aChunk.append(ExpressionCommand(expression, self.tokenizer.lineNumber))</tt>.</li>
<li><strong>Immediate Execution</strong>.  This simply creates a context and evaluates
the Python expression.  The output from the expression becomes a <tt class="docutils literal">TextCommand</tt>, and
is append to the current <tt class="docutils literal">Chunk</tt>.</li>
</ul>
<p>We use the <strong>Immediate Execution</strong> semantics.</p>
<p>Note that we've removed the blanket <tt class="docutils literal">os</tt>.  We provide <tt class="docutils literal">os.path</tt> library.
An <tt class="docutils literal">os.getcwd()</tt> could be changed to <tt class="docutils literal"><span class="pre">os.path.realpath('.')</span></tt>.</p>
<p class="rubric" id="target-126">Imports (126) +=</p>
<pre class="code literal-block">
import builtins
import sys
import platform
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (126)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p class="rubric" id="target-127">add an expression command to the current chunk (127) =</p>
<pre class="code literal-block">
# get the Python expression, create the expression result
expression = next(self.tokenizer)
self.expect((self.cmdrexpr,))
try:
    # Build Context
    safe = types.SimpleNamespace(**dict(
        (name, obj)
        for name,obj in builtins.__dict__.items()
        if name not in ('breakpoint', 'compile', 'eval', 'exec', 'execfile', 'globals', 'help', 'input', 'memoryview', 'open', 'print', 'super', '__import__')
    ))
    globals = dict(
        __builtins__=safe,
        os=types.SimpleNamespace(path=os.path, getcwd=os.getcwd, name=os.name),
        time=time,
        datetime=datetime,
        platform=platform,
        theLocation=str(self.location()),
        theWebReader=self,
        theFile=self.theWeb.web_path,
        thisApplication=sys.argv[0],
        __version__=__version__,
        )
    # Evaluate
    result = str(eval(expression, globals))
except Exception as exc:
    self.logger.error('Failure to process %r: result is %r', expression, exc)
    self.errors += 1
    result = f&quot;&#64;({expression!r}: Error {exc!r}&#64;)&quot;
self.aChunk.appendText(result, self.tokenizer.lineNumber)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>add an expression command to the current chunk (127)</em>. Used by: minor commands... (<a class="reference internal" href="#target-123">123</a>)</p>
</blockquote>
<p>A double command sequence (<tt class="docutils literal"><span class="pre">'&#64;&#64;'</span></tt>, when the command is an <tt class="docutils literal">'&#64;'</tt>) has the
usual meaning of <tt class="docutils literal">'&#64;'</tt> in the input stream.  We do this via
the <tt class="docutils literal">appendText()</tt> method of the current <tt class="docutils literal">Chunk</tt>.  This will append the
character on the end of the most recent <tt class="docutils literal">TextCommand</tt>; if this fails, it will
create a new, empty <tt class="docutils literal">TextCommand</tt>.</p>
<p>We replace with '&#64;' here and now! This is put this at the end of the previous chunk.
And we make sure the next chunk will be appended to this so that it's
largely seamless.</p>
<p class="rubric" id="target-128">double at-sign replacement, append this character to previous TextCommand (128) =</p>
<pre class="code literal-block">
self.aChunk.appendText(self.command, self.tokenizer.lineNumber)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>double at-sign replacement, append this character to previous TextCommand (128)</em>. Used by: minor commands... (<a class="reference internal" href="#target-123">123</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">expect()</tt> method examines the
next token to see if it is the expected item. <tt class="docutils literal">'\n'</tt> are absorbed.
If this is not found, a standard type of error message is raised.
This is used by <tt class="docutils literal">handleCommand()</tt>.</p>
<p class="rubric" id="target-129">WebReader handle a command string (129) +=</p>
<pre class="code literal-block">
def expect(self, tokens: Iterable[str]) -&gt; str | None:
    try:
        t = next(self.tokenizer)
        while t == '\n':
            t = next(self.tokenizer)
    except StopIteration:
        self.logger.error(&quot;At %r: end of input, %r not found&quot;, self.location(), tokens)
        self.errors += 1
        return None
    if t not in tokens:
        self.logger.error(&quot;At %r: expected %r, found %r&quot;, self.location(), tokens, t)
        self.errors += 1
        return None
    return t
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>WebReader handle a command string (129)</em>. Used by: WebReader class... (<a class="reference internal" href="#target-116">116</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">location()</tt> provides the file name and line number.
This allows error messages as well as tangled or woven output
to correctly reference the original input files.</p>
<p class="rubric" id="target-130">WebReader location in the input stream (130) =</p>
<pre class="code literal-block">
def location(self) -&gt; tuple[str, int]:
    return (str(self.filePath), self.tokenizer.lineNumber+1)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>WebReader location in the input stream (130)</em>. Used by: WebReader class... (<a class="reference internal" href="#target-116">116</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">load()</tt> method reads the entire input file as a sequence
of tokens, split up by the <tt class="docutils literal">Tokenizer</tt>.  Each token that appears
to be a command is passed to the <tt class="docutils literal">handleCommand()</tt> method.  If
the <tt class="docutils literal">handleCommand()</tt> method returns a True result, the command was recognized
and placed in the <tt class="docutils literal">Web</tt>.  If <tt class="docutils literal">handleCommand()</tt> returns a False result, the command
was unknown, and we write a warning but treat it as text.</p>
<p>The <tt class="docutils literal">load()</tt> method is used recursively to handle the <tt class="docutils literal">&#64;i</tt> command. The issue
is that it's always loading a single top-level web.</p>
<p class="rubric" id="target-131">Imports (131) +=</p>
<pre class="code literal-block">
from typing import TextIO
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (131)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p class="rubric" id="target-132">WebReader load the web (132) =</p>
<pre class="code literal-block">
def load(self, web: &quot;Web&quot;, filepath: Path, source: TextIO | None = None) -&gt; &quot;WebReader&quot;:
    self.theWeb = web
    self.filePath = filepath

    # Only set the a web filename once using the first file.
    # **TODO:** this should be a setter property of the web.
    if self.theWeb.web_path is None:
        self.theWeb.web_path = self.filePath

    if source:
        self._source = source
        self.parse_source()
    else:
        with self.filePath.open() as self._source:
            self.parse_source()
    return self

def parse_source(self) -&gt; None:
    self.tokenizer = Tokenizer(self._source, self.command)
    self.totalFiles += 1

    self.aChunk = Chunk() # Initial anonymous chunk of text.
    self.aChunk.webAdd(self.theWeb)

    for token in self.tokenizer:
        if len(token) &gt;= 2 and token.startswith(self.command):
            if self.handleCommand(token):
                continue
            else:
                self.logger.warning('Unknown &#64;-command in input: %r', token)
                self.aChunk.appendText(token, self.tokenizer.lineNumber)
        elif token:
            # Accumulate a non-empty block of text in the current chunk.
            self.aChunk.appendText(token, self.tokenizer.lineNumber)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>WebReader load the web (132)</em>. Used by: WebReader class... (<a class="reference internal" href="#target-116">116</a>)</p>
</blockquote>
<p>The command character can be changed to permit
some flexibility when working with languages that make extensive
use of the <tt class="docutils literal">&#64;</tt> symbol, i.e., PERL.
The initialization of the <tt class="docutils literal">WebReader</tt> is based on the selected
command character.</p>
<p class="rubric" id="target-133">WebReader command literals (133) =</p>
<pre class="code literal-block">
# Structural (&quot;major&quot;) commands
self.cmdo = self.command+'o'
self.cmdd = self.command+'d'
self.cmdlcurl = self.command+'{'
self.cmdrcurl = self.command+'}'
self.cmdlbrak = self.command+'['
self.cmdrbrak = self.command+']'
self.cmdi = self.command+'i'

# Inline (&quot;minor&quot;) commands
self.cmdlangl = self.command+'&lt;'
self.cmdrangl = self.command+'&gt;'
self.cmdpipe = self.command+'|'
self.cmdlexpr = self.command+'('
self.cmdrexpr = self.command+')'
self.cmdcmd = self.command+self.command

# Content &quot;minor&quot; commands
self.cmdf = self.command+'f'
self.cmdm = self.command+'m'
self.cmdu = self.command+'u'
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>WebReader command literals (133)</em>. Used by: WebReader class... (<a class="reference internal" href="#target-116">116</a>)</p>
</blockquote>
</div>
<div class="section" id="the-tokenizer-class">
<h3><a class="toc-backref" href="#toc-entry-64">The Tokenizer Class</a></h3>
<p>The <tt class="docutils literal">WebReader</tt> requires a tokenizer. The tokenizer breaks the input text
into a stream of tokens. There are two broad classes of tokens:</p>
<ul class="simple">
<li><tt class="docutils literal">&#64;.</tt> command tokens, including the structural, inline, and content
commands.</li>
<li><tt class="docutils literal">\n</tt>. Inside text, these matter. Within structure command tokens, these don't matter.
Except after the filename after an <tt class="docutils literal">&#64;i</tt> command, where it ends the command.</li>
<li>The remaining text.</li>
</ul>
<p>The tokenizer works by reading the entire file and splitting on <tt class="docutils literal">&#64;.</tt> patterns.
The <tt class="docutils literal">split()</tt> method of the Python <tt class="docutils literal">re</tt> module will separate the input
and preserve the actual character sequence on which the input was split.
This breaks the input into blocks of text separated by the <tt class="docutils literal">&#64;.</tt> characters.</p>
<p>This tokenizer splits the input using <tt class="docutils literal"><span class="pre">(r'&#64;.|\n')</span></tt>. The idea is that
we locate commands, newlines and the interstitial text as three classes of tokens.
We can then assemble each <tt class="docutils literal">Command</tt> instance from a short sequence of tokens.
The core <tt class="docutils literal">TextCommand</tt> and <tt class="docutils literal">CodeCommand</tt> will be a line of text ending with
the <tt class="docutils literal">\n</tt>.</p>
<p>The re.split() method will include an empty string when the split pattern occurs
at the very beginning or very end of the input. For example:</p>
<pre class="literal-block">
&gt;&gt;&gt; pat.split( &quot;&#64;{hi mom&#64;}&quot;)
['', '&#64;{', 'hi mom', '&#64;}', '']
</pre>
<p>We can safely filter these via a generator expression.</p>
<p>The tokenizer counts newline characters for us, so that error messages can include
a line number. Also, we can tangle comments into the file that include line numbers.</p>
<p>Since the tokenizer is a proper iterator, we can use <tt class="docutils literal">tokens = iter(Tokenizer(source))</tt>
and <tt class="docutils literal">next(tokens)</tt> to step through the sequence of tokens until we raise a <tt class="docutils literal">StopIteration</tt>
exception.</p>
<p class="rubric" id="target-134">Imports (134) +=</p>
<pre class="code literal-block">
import re
from collections.abc import Iterator, Iterable
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (134)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p class="rubric" id="target-135">Tokenizer class - breaks input into tokens (135) =</p>
<pre class="code literal-block">
class Tokenizer(Iterator[str]):
    def __init__(self, stream: TextIO, command_char: str='&#64;') -&gt; None:
        self.command = command_char
        self.parsePat = re.compile(f'({self.command}.|\\n)')
        self.token_iter = (t for t in self.parsePat.split(stream.read()) if len(t) != 0)
        self.lineNumber = 0
    def __next__(self) -&gt; str:
        token = next(self.token_iter)
        self.lineNumber += token.count('\n')
        return token
    def __iter__(self) -&gt; Iterator[str]:
        return self
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Tokenizer class - breaks input into tokens (135)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
</div>
<div class="section" id="the-option-parser-class">
<h3><a class="toc-backref" href="#toc-entry-65">The Option Parser Class</a></h3>
<p>For some commands (<tt class="docutils literal">&#64;d</tt> and <tt class="docutils literal">&#64;o</tt>) we have options as well as the chunk name
or file name. This roughly parallels the way Tcl or the shell works.</p>
<p>The two examples are</p>
<ul>
<li><p class="first"><tt class="docutils literal">&#64;o</tt> which has an optional <tt class="docutils literal"><span class="pre">-start</span></tt> and <tt class="docutils literal"><span class="pre">-end</span></tt> that are used to
provide comment bracketing information. For example:</p>
<p><tt class="docutils literal">&#64;0 <span class="pre">-start</span> /* <span class="pre">-end</span> */ something.css</tt></p>
<p>Provides two options in addition to the required filename.</p>
</li>
<li><p class="first"><tt class="docutils literal">&#64;d</tt> which has an optional <tt class="docutils literal"><span class="pre">-noident</span></tt> or <tt class="docutils literal"><span class="pre">-indent</span></tt> that is used to
provide the indentation rules for this chunk. Some chunks are not indented
automatically. It's up to the author to get the indentation right. This is
used in the case of a Python &quot;&quot;&quot; string that would be ruined by indentation.</p>
</li>
</ul>
<p>To handle this, we have a separate lexical scanner and parser for these
two commands.</p>
<p class="rubric" id="target-136">Imports (136) +=</p>
<pre class="code literal-block">
import shlex
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (136)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>Here's how we can define an option.</p>
<pre class="literal-block">
OptionParser(
    OptionDef(&quot;-start&quot;, nargs=1, default=None),
    OptionDef(&quot;-end&quot;, nargs=1, default=&quot;&quot;),
    OptionDef(&quot;-indent&quot;, nargs=0), # A default
    OptionDef(&quot;-noindent&quot;, nargs=0),
    OptionDef(&quot;argument&quot;, nargs='*'),
    )
</pre>
<p>The idea is to parallel <tt class="docutils literal">argparse.add_argument()</tt> syntax.</p>
<p class="rubric" id="target-137">Option Parser class - locates optional values on commands (137) =</p>
<pre class="code literal-block">
class ParseError(Exception): pass
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Option Parser class - locates optional values on commands (137)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
<p class="rubric" id="target-138">Option Parser class - locates optional values on commands (138) +=</p>
<pre class="code literal-block">
class OptionDef:
    def __init__(self, name: str, **kw: Any) -&gt; None:
        self.name = name
        self.__dict__.update(kw)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Option Parser class - locates optional values on commands (138)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
<p>The parser breaks the text into words using <tt class="docutils literal">shelex</tt> rules.
It then steps through the words, accumulating the options and the
final argument value.</p>
<p class="rubric" id="target-139">Option Parser class - locates optional values on commands (139) +=</p>
<pre class="code literal-block">
class OptionParser:
    def __init__(self, *arg_defs: Any) -&gt; None:
        self.args = dict((arg.name, arg) for arg in arg_defs)
        self.trailers = [k for k in self.args.keys() if not k.startswith('-')]

    def parse(self, text: str) -&gt; dict[str, list[str]]:
        try:
            word_iter = iter(shlex.split(text))
        except ValueError as e:
            raise Error(f&quot;Error parsing options in {text!r}&quot;)
        options = dict(self._group(word_iter))
        return options

    def _group(self, word_iter: Iterator[str]) -&gt; Iterator[tuple[str, list[str]]]:
        option: str | None
        value: list[str]
        final: list[str]
        option, value, final = None, [], []
        for word in word_iter:
            if word == '--':
                if option:
                    yield option, value
                try:
                    final = [next(word_iter)]
                except StopIteration:
                    final = [] # Special case of '--' at the end.
                break
            elif word.startswith('-'):
                if word in self.args:
                    if option:
                        yield option, value
                    option, value = word, []
                else:
                    raise ParseError(f&quot;Unknown option {word!r}&quot;)
            else:
                if option:
                    if self.args[option].nargs == len(value):
                        yield option, value
                        final = [word]
                        break
                    else:
                        value.append(word)
                else:
                    final = [word]
                    break
        # In principle, we step through the trailers based on nargs counts.
        for word in word_iter:
            final.append(word)
        yield self.trailers[0], final
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Option Parser class - locates optional values on commands (139)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
<p>In principle, we step through the trailers based on nargs counts.
Since we only ever have the one trailer, we skate by.</p>
<p>The loop becomes a bit more complex to capture the positional arguments, in order.
First, we have to use an <tt class="docutils literal">OrderedDict</tt> instead of a <tt class="docutils literal">dict</tt>.</p>
<p>Then we'd have a loop something like this. (Untested, incomplete, just hand-waving.)</p>
<pre class="literal-block">
trailers = self.trailers[:] # Stateful shallow copy
for word in word_iter:
    if len(final) == trailers[-1].nargs: # nargs=='*' vs. nargs=int??
        yield trailers[0], &quot; &quot;.join(final)
        final = 0
        trailers.pop(0)
yield trailers[0], &quot; &quot;.join(final)
</pre>
</div>
</div>
<div class="section" id="action-class-hierarchy">
<h2><a class="toc-backref" href="#toc-entry-66">Action Class Hierarchy</a></h2>
<p>This application performs three major actions: loading the document web,
weaving and tangling.  Generally,
the use case is to perform a load, weave and tangle.  However, a less common use case
is to first load and tangle output files, run a regression test and then
load and weave a result that includes the test output file.</p>
<p>The <tt class="docutils literal"><span class="pre">-x</span></tt> option excludes one of the two output actions.  The <tt class="docutils literal"><span class="pre">-xw</span></tt>
excludes the weave pass, doing only the tangle action.  The <tt class="docutils literal"><span class="pre">-xt</span></tt> excludes
the tangle pass, doing the weave action.</p>
<p>This two pass action might be embedded in the following type of Python program.</p>
<pre class="literal-block">
import pyweb, os, runpy, sys
pyweb.tangle(&quot;source.w&quot;)
with open(&quot;source.log&quot;, &quot;w&quot;) as target:
    sys.stdout = target
    runpy.run_path('source.py')
    sys.stdout = sys.__stdout__
pyweb.weave(&quot;source.w&quot;)
</pre>
<p>The first step runs <strong>py-web-tool</strong> , excluding the final weaving pass.  The second
step runs the tangled program, <tt class="docutils literal">source.py</tt>, and produces test results in
some log file, <tt class="docutils literal">source.log</tt>.  The third step runs <strong>py-web-tool</strong>  excluding the
tangle pass.  This produces a final document that includes the <tt class="docutils literal">source.log</tt>
test results.</p>
<p>To accomplish this, we provide a class hierarchy that defines the various
actions of the <strong>py-web-tool</strong>  application.  This class hierarchy defines an extensible set of
fundamental actions.  This gives us the flexibility to create a simple sequence
of actions and execute any combination of these.  It eliminates the need for a
forest of <tt class="docutils literal">if</tt>-statements to determine precisely what will be done.</p>
<p>Each action has the potential to update the state of the overall
application.   A partner with this command hierarchy is the Application class
that defines the application options, inputs and results.</p>
<p class="rubric" id="target-140">Action class hierarchy - used to describe actions of the application (140) =</p>
<pre class="code literal-block">
→Action superclass has common features of all actions (<a class="reference internal" href="#target-141">141</a>)
→ActionSequence subclass that holds a sequence of other actions (<a class="reference internal" href="#target-144">144</a>)
→WeaveAction subclass initiates the weave action (<a class="reference internal" href="#target-148">148</a>)
→TangleAction subclass initiates the tangle action (<a class="reference internal" href="#target-151">151</a>)
→LoadAction subclass loads the document web (<a class="reference internal" href="#target-154">154</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Action class hierarchy - used to describe actions of the application (140)</em>. Used by: Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)</p>
</blockquote>
<div class="section" id="action-class">
<h3><a class="toc-backref" href="#toc-entry-67">Action Class</a></h3>
<p>The <tt class="docutils literal">Action</tt> class embodies the basic operations of <strong>py-web-tool</strong> .
The intent of this hierarchy is to both provide an easily expanded method of
adding new actions, but an easily specified list of actions for a particular
run of <strong>py-web-tool</strong> .</p>
<p>The overall process of the application is defined by an instance of <tt class="docutils literal">Action</tt>.
This instance may be the <tt class="docutils literal">WeaveAction</tt> instance, the <tt class="docutils literal">TangleAction</tt> instance
or a <tt class="docutils literal">ActionSequence</tt> instance.</p>
<p>The instance is constructed during parsing of the input parameters.  Then the
<tt class="docutils literal">Action</tt> class <tt class="docutils literal">perform()</tt> method is called to actually perform the
action.  There are three standard <tt class="docutils literal">Action</tt> instances available: an instance
that is a macro and does both tangling and weaving, an instance that excludes tangling,
and an instance that excludes weaving.  These correspond to the command-line options.</p>
<pre class="literal-block">
anOp = SomeAction(<em>parameters</em>)
anOp.options = <em>argparse.Namespace</em>
anOp.web = <em>Current web</em>
anOp()
</pre>
<p>The <tt class="docutils literal">Action</tt> is the superclass for all actions.
An <tt class="docutils literal">Action</tt> has a number of common attributes.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">name:</th><td class="field-body">A name for this action.</td>
</tr>
<tr class="field"><th class="field-name">options:</th><td class="field-body">The <tt class="docutils literal">argparse.Namespace</tt> object.</td>
</tr>
<tr class="field"><th class="field-name">web:</th><td class="field-body">The current web that's being processed.</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>!start:</dt>
<dd>The time at which the action started.</dd>
</dl>
<p class="rubric" id="target-141">Action superclass has common features of all actions (141) =</p>
<pre class="code literal-block">
class Action:
    &quot;&quot;&quot;An action performed by pyWeb.&quot;&quot;&quot;
    options : argparse.Namespace
    web : &quot;Web&quot;
    def __init__(self, name: str) -&gt; None:
        self.name = name
        self.start: float | None = None
        self.logger = logging.getLogger(self.__class__.__qualname__)

    def __str__(self) -&gt; str:
        return f&quot;{self.name!s} [{self.web!s}]&quot;

    →Action call method actually does the real work (<a class="reference internal" href="#target-142">142</a>)
    →Action final summary of what was done (<a class="reference internal" href="#target-143">143</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Action superclass has common features of all actions (141)</em>. Used by: Action class hierarchy... (<a class="reference internal" href="#target-140">140</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">__call__()</tt> method does the real work of the action.
For the superclass, it merely logs a message.  This is overridden
by a subclass.</p>
<p class="rubric" id="target-142">Action call method actually does the real work (142) =</p>
<pre class="code literal-block">
def __call__(self) -&gt; None:
    self.logger.info(&quot;Starting %s&quot;, self.name)
    self.start = time.process_time()
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Action call method actually does the real work (142)</em>. Used by: Action superclass... (<a class="reference internal" href="#target-141">141</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">summary()</tt> method returns some basic processing
statistics for this action.</p>
<p class="rubric" id="target-143">Action final summary of what was done (143) =</p>
<pre class="code literal-block">
def duration(self) -&gt; float:
    &quot;&quot;&quot;Return duration of the action.&quot;&quot;&quot;
    return (self.start and time.process_time()-self.start) or 0

def summary(self) -&gt; str:
    return f&quot;{self.name!s} in {self.duration():0.3f} sec.&quot;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Action final summary of what was done (143)</em>. Used by: Action superclass... (<a class="reference internal" href="#target-141">141</a>)</p>
</blockquote>
</div>
<div class="section" id="actionsequence-class">
<h3><a class="toc-backref" href="#toc-entry-68">ActionSequence Class</a></h3>
<p>A <tt class="docutils literal">ActionSequence</tt> defines a composite action; it is a sequence of
other actions.  When the macro is performed, it delegates to the
sub-actions.</p>
<p>The instance is created during parsing of input parameters.  An instance of
this class is one of
the three standard actions available; it generally is the default, &quot;do everything&quot;
action.</p>
<p>This class overrides the <tt class="docutils literal">perform()</tt> method of the superclass.  It also adds
an <tt class="docutils literal">append()</tt> method that is used to construct the sequence of actions.</p>
<p class="rubric" id="target-144">ActionSequence subclass that holds a sequence of other actions (144) =</p>
<pre class="code literal-block">
class ActionSequence(Action):
    &quot;&quot;&quot;An action composed of a sequence of other actions.&quot;&quot;&quot;
    def __init__(self, name: str, opSequence: list[Action] | None = None) -&gt; None:
        super().__init__(name)
        if opSequence: self.opSequence = opSequence
        else: self.opSequence = []

    def __str__(self) -&gt; str:
        return &quot;; &quot;.join([str(x) for x in self.opSequence])

    →ActionSequence call method delegates the sequence of ations (<a class="reference internal" href="#target-145">145</a>)
    →ActionSequence append adds a new action to the sequence (<a class="reference internal" href="#target-146">146</a>)
    →ActionSequence summary summarizes each step (<a class="reference internal" href="#target-147">147</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>ActionSequence subclass that holds a sequence of other actions (144)</em>. Used by: Action class hierarchy... (<a class="reference internal" href="#target-140">140</a>)</p>
</blockquote>
<p>Since the macro <tt class="docutils literal">__call__()</tt> method delegates to other Actions,
it is possible to short-cut argument processing by using the Python
<tt class="docutils literal">*args</tt> construct to accept all arguments and pass them to each
sub-action.</p>
<p class="rubric" id="target-145">ActionSequence call method delegates the sequence of ations (145) =</p>
<pre class="code literal-block">
def __call__(self) -&gt; None:
    super().__call__()
    for o in self.opSequence:
        o.web = self.web
        o.options = self.options
        o()
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>ActionSequence call method delegates the sequence of ations (145)</em>. Used by: ActionSequence subclass... (<a class="reference internal" href="#target-144">144</a>)</p>
</blockquote>
<p>Since this class is essentially a wrapper around the built-in sequence type,
we delegate sequence related actions directly to the underlying sequence.</p>
<p class="rubric" id="target-146">ActionSequence append adds a new action to the sequence (146) =</p>
<pre class="code literal-block">
def append(self, anAction: Action) -&gt; None:
    self.opSequence.append(anAction)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>ActionSequence append adds a new action to the sequence (146)</em>. Used by: ActionSequence subclass... (<a class="reference internal" href="#target-144">144</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">summary()</tt> method returns some basic processing
statistics for each step of this action.</p>
<p class="rubric" id="target-147">ActionSequence summary summarizes each step (147) =</p>
<pre class="code literal-block">
def summary(self) -&gt; str:
    return &quot;, &quot;.join([o.summary() for o in self.opSequence])
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>ActionSequence summary summarizes each step (147)</em>. Used by: ActionSequence subclass... (<a class="reference internal" href="#target-144">144</a>)</p>
</blockquote>
</div>
<div class="section" id="weaveaction-class">
<h3><a class="toc-backref" href="#toc-entry-69">WeaveAction Class</a></h3>
<p>The <tt class="docutils literal">WeaveAction</tt> defines the action of weaving.  This action
logs a message, and invokes the <tt class="docutils literal">weave()</tt> method of the <tt class="docutils literal">Web</tt> instance.
This method also includes the basic decision on which weaver to use.  If a <tt class="docutils literal">Weaver</tt> was
specified on the command line, this instance is used.  Otherwise, the first few characters
are examined and a weaver is selected.</p>
<p>This class overrides the <tt class="docutils literal">__call__()</tt> method of the superclass.</p>
<p>If the options include <tt class="docutils literal">theWeaver</tt>, that <tt class="docutils literal">Weaver</tt> instance will be used.
Otherwise, the <tt class="docutils literal">web.language()</tt> method function is used to guess what weaver to use.</p>
<p class="rubric" id="target-148">WeaveAction subclass initiates the weave action (148) =</p>
<pre class="code literal-block">
class WeaveAction(Action):
    &quot;&quot;&quot;Weave the final document.&quot;&quot;&quot;
    def __init__(self) -&gt; None:
        super().__init__(&quot;Weave&quot;)

    def __str__(self) -&gt; str:
        return f&quot;{self.name!s} [{self.web!s}, {self.options.theWeaver!s}]&quot;

    →WeaveAction call method to pick the language (<a class="reference internal" href="#target-149">149</a>)
    →WeaveAction summary of language choice (<a class="reference internal" href="#target-150">150</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>WeaveAction subclass initiates the weave action (148)</em>. Used by: Action class hierarchy... (<a class="reference internal" href="#target-140">140</a>)</p>
</blockquote>
<p>The language is picked just prior to weaving.  It is either (1) the language
specified on the command line, or, (2) if no language was specified, a language
is selected based on the first few characters of the input.</p>
<p>Weaving can only raise an exception when there is a reference to a chunk that
is never defined.</p>
<p class="rubric" id="target-149">WeaveAction call method to pick the language (149) =</p>
<pre class="code literal-block">
def __call__(self) -&gt; None:
    super().__call__()
    if not self.options.theWeaver:
        # Examine first few chars of first chunk of web to determine language
        self.options.theWeaver = self.web.language()
        self.logger.info(&quot;Using %s&quot;, self.options.theWeaver.__class__.__name__)
    self.options.theWeaver.reference_style = self.options.reference_style
    try:
        self.web.weave(self.options.theWeaver)
        self.logger.info(&quot;Finished Normally&quot;)
    except Error as e:
        self.logger.error(&quot;Problems weaving document from %r (weave file is faulty).&quot;, self.web.web_path)
        #raise
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>WeaveAction call method to pick the language (149)</em>. Used by: WeaveAction subclass... (<a class="reference internal" href="#target-148">148</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">summary()</tt> method returns some basic processing
statistics for the weave action.</p>
<p class="rubric" id="target-150">WeaveAction summary of language choice (150) =</p>
<pre class="code literal-block">
def summary(self) -&gt; str:
    if self.options.theWeaver and self.options.theWeaver.linesWritten &gt; 0:
        return (
            f&quot;{self.name!s} {self.options.theWeaver.linesWritten:d} lines in {self.duration():0.3f} sec.&quot;
        )
    return f&quot;did not {self.name!s}&quot;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>WeaveAction summary of language choice (150)</em>. Used by: WeaveAction subclass... (<a class="reference internal" href="#target-148">148</a>)</p>
</blockquote>
</div>
<div class="section" id="tangleaction-class">
<h3><a class="toc-backref" href="#toc-entry-70">TangleAction Class</a></h3>
<p>The <tt class="docutils literal">TangleAction</tt> defines the action of tangling.  This operation
logs a message, and invokes the <tt class="docutils literal">weave()</tt> method of the <tt class="docutils literal">Web</tt> instance.
This method also includes the basic decision on which weaver to use.  If a <tt class="docutils literal">Weaver</tt> was
specified on the command line, this instance is used.  Otherwise, the first few characters
are examined and a weaver is selected.</p>
<p>This class overrides the <tt class="docutils literal">__call__()</tt> method of the superclass.</p>
<p>The options <strong>must</strong> include <tt class="docutils literal">theTangler</tt>, with the <tt class="docutils literal">Tangler</tt> instance to be used.</p>
<p class="rubric" id="target-151">TangleAction subclass initiates the tangle action (151) =</p>
<pre class="code literal-block">
class TangleAction(Action):
    &quot;&quot;&quot;Tangle source files.&quot;&quot;&quot;
    def __init__(self) -&gt; None:
        super().__init__(&quot;Tangle&quot;)

    →TangleAction call method does tangling of the output files (<a class="reference internal" href="#target-152">152</a>)
    →TangleAction summary method provides total lines tangled (<a class="reference internal" href="#target-153">153</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>TangleAction subclass initiates the tangle action (151)</em>. Used by: Action class hierarchy... (<a class="reference internal" href="#target-140">140</a>)</p>
</blockquote>
<p>Tangling can only raise an exception when a cross reference request (<tt class="docutils literal">&#64;f</tt>, <tt class="docutils literal">&#64;m</tt> or <tt class="docutils literal">&#64;u</tt>)
occurs in a program code chunk.  Program code chunks are defined
with any of <tt class="docutils literal">&#64;d</tt> or <tt class="docutils literal">&#64;o</tt>  and use <tt class="docutils literal">&#64;{</tt> <tt class="docutils literal">&#64;}</tt> brackets.</p>
<p class="rubric" id="target-152">TangleAction call method does tangling of the output files (152) =</p>
<pre class="code literal-block">
def __call__(self) -&gt; None:
    super().__call__()
    self.options.theTangler.include_line_numbers = self.options.tangler_line_numbers
    try:
        self.web.tangle(self.options.theTangler)
    except Error as e:
        self.logger.error(&quot;Problems tangling outputs from %r (tangle files are faulty).&quot;, self.web.web_path)
        #raise
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>TangleAction call method does tangling of the output files (152)</em>. Used by: TangleAction subclass... (<a class="reference internal" href="#target-151">151</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">summary()</tt> method returns some basic processing
statistics for the tangle action.</p>
<p class="rubric" id="target-153">TangleAction summary method provides total lines tangled (153) =</p>
<pre class="code literal-block">
def summary(self) -&gt; str:
    if self.options.theTangler and self.options.theTangler.linesWritten &gt; 0:
        return (
            f&quot;{self.name!s} {self.options.theTangler.totalLines:d} lines in {self.duration():0.3f} sec.&quot;
        )
    return f&quot;did not {self.name!r}&quot;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>TangleAction summary method provides total lines tangled (153)</em>. Used by: TangleAction subclass... (<a class="reference internal" href="#target-151">151</a>)</p>
</blockquote>
</div>
<div class="section" id="loadaction-class">
<h3><a class="toc-backref" href="#toc-entry-71">LoadAction Class</a></h3>
<p>The <tt class="docutils literal">LoadAction</tt> defines the action of loading the web structure.  This action
uses the application's <tt class="docutils literal">webReader</tt> to actually do the load.</p>
<p>An instance is created during parsing of the input parameters.  An instance of
this class is part of any of the weave, tangle and &quot;do everything&quot; action.</p>
<p>This class overrides the <tt class="docutils literal">__call__()</tt> method of the superclass.</p>
<p>The options <strong>must</strong> include <tt class="docutils literal">webReader</tt>, with the <tt class="docutils literal">WebReader</tt> instance to be used.</p>
<p class="rubric" id="target-154">LoadAction subclass loads the document web (154) =</p>
<pre class="code literal-block">
class LoadAction(Action):
    &quot;&quot;&quot;Load the source web.&quot;&quot;&quot;
    def __init__(self) -&gt; None:
        super().__init__(&quot;Load&quot;)
    def __str__(self) -&gt; str:
        return f&quot;Load [{self.webReader!s}, {self.web!s}]&quot;
    →LoadAction call method loads the input files (<a class="reference internal" href="#target-155">155</a>)
    →LoadAction summary provides lines read (<a class="reference internal" href="#target-156">156</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LoadAction subclass loads the document web (154)</em>. Used by: Action class hierarchy... (<a class="reference internal" href="#target-140">140</a>)</p>
</blockquote>
<p>Trying to load the web involves two steps, either of which can raise
exceptions due to incorrect inputs.</p>
<ol class="arabic simple">
<li>The <tt class="docutils literal">WebReader</tt> class <tt class="docutils literal">load()</tt> method can raise exceptions for a number of
syntax errors as well as OS errors.<ul>
<li>Missing closing brackets (<tt class="docutils literal">&#64;}</tt>, <tt class="docutils literal">&#64;]</tt> or <tt class="docutils literal">&#64;&gt;</tt>).</li>
<li>Missing opening bracket (<tt class="docutils literal">&#64;{</tt> or <tt class="docutils literal">&#64;[</tt>) after a chunk name (<tt class="docutils literal">&#64;d</tt> or <tt class="docutils literal">&#64;o</tt>).</li>
<li>Extra brackets (<tt class="docutils literal">&#64;{</tt>, <tt class="docutils literal">&#64;[</tt>, <tt class="docutils literal">&#64;}</tt>, <tt class="docutils literal">&#64;]</tt>).</li>
<li>Extra <tt class="docutils literal">&#64;|</tt>.</li>
<li>The input file does not exist or is not readable.</li>
</ul>
</li>
<li>The <tt class="docutils literal">Web</tt> class <tt class="docutils literal">createUsedBy()</tt> method can raise an exception when a
chunk reference cannot be resolved to a named chunk.</li>
</ol>
<p class="rubric" id="target-155">LoadAction call method loads the input files (155) =</p>
<pre class="code literal-block">
def __call__(self) -&gt; None:
    super().__call__()
    self.webReader = self.options.webReader
    self.webReader.command = self.options.command
    self.webReader.permitList = self.options.permitList
    self.web.web_path = self.options.source_path
    error = f&quot;Problems with source file {self.options.source_path!r}, no output produced.&quot;
    try:
        self.webReader.load(self.web, self.options.source_path)
        if self.webReader.errors != 0:
            self.logger.error(error)
            raise Error(&quot;Syntax Errors in the Web&quot;)
        self.web.createUsedBy()
        if self.webReader.errors != 0:
            self.logger.error(error)
            raise Error(&quot;Internal Reference Errors in the Web&quot;)
    except Error as e:
        self.logger.error(error)
        raise # Older design.
    except IOError as e:
        self.logger.error(error)
        raise
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LoadAction call method loads the input files (155)</em>. Used by: LoadAction subclass... (<a class="reference internal" href="#target-154">154</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">summary()</tt> method returns some basic processing
statistics for the load action.</p>
<p class="rubric" id="target-156">LoadAction summary provides lines read (156) =</p>
<pre class="code literal-block">
def summary(self) -&gt; str:
    return (
        f&quot;{self.name!s} {self.webReader.totalLines:d} lines from {self.webReader.totalFiles:d} files in {self.duration():0.3f} sec.&quot;
    )
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>LoadAction summary provides lines read (156)</em>. Used by: LoadAction subclass... (<a class="reference internal" href="#target-154">154</a>)</p>
</blockquote>
</div>
</div>
<div class="section" id="pyweb-module-file">
<h2><a class="toc-backref" href="#toc-entry-72"><strong>pyWeb</strong> Module File</a></h2>
<p>The <strong>pyWeb</strong> application file is shown below:</p>
<p class="rubric" id="target-157">pyweb.py (157) =</p>
<pre class="code literal-block">
→Overheads (<a class="reference internal" href="#target-159">159</a>), →(<a class="reference internal" href="#target-160">160</a>), →(<a class="reference internal" href="#target-161">161</a>)
→Imports (<a class="reference internal" href="#target-3">3</a>), →(<a class="reference internal" href="#target-12">12</a>), →(<a class="reference internal" href="#target-48">48</a>), →(<a class="reference internal" href="#target-58">58</a>), →(<a class="reference internal" href="#target-98">98</a>), →(<a class="reference internal" href="#target-126">126</a>), →(<a class="reference internal" href="#target-131">131</a>), →(<a class="reference internal" href="#target-134">134</a>), →(<a class="reference internal" href="#target-136">136</a>), →(<a class="reference internal" href="#target-158">158</a>), →(<a class="reference internal" href="#target-162">162</a>), →(<a class="reference internal" href="#target-168">168</a>)
→Base Class Definitions (<a class="reference internal" href="#target-1">1</a>)
→Application Class (<a class="reference internal" href="#target-163">163</a>), →(<a class="reference internal" href="#target-164">164</a>)
→Logging Setup (<a class="reference internal" href="#target-169">169</a>), →(<a class="reference internal" href="#target-170">170</a>)
→Interface Functions (<a class="reference internal" href="#target-171">171</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>pyweb.py (157)</em>.</p>
</blockquote>
<p>The <a class="reference internal" href="#overheads">Overheads</a> are described below, they include things like:</p>
<ul class="simple">
<li>shell escape</li>
<li>doc string</li>
<li><tt class="docutils literal">__version__</tt> setting</li>
</ul>
<p><a class="reference internal" href="#python-library-imports">Python Library Imports</a> are actually scattered in various places in this description.</p>
<p>The more important elements are described in separate sections:</p>
<ul class="simple">
<li>Base Class Definitions</li>
<li>Application Class and Main Functions</li>
<li>Interface Functions</li>
</ul>
<div class="section" id="python-library-imports">
<h3><a class="toc-backref" href="#toc-entry-73">Python Library Imports</a></h3>
<p>Numerous Python library modules are used by this application.</p>
<p>A few are listed here because they're used widely. Others are listed
closer to where they're referenced.</p>
<ul class="simple">
<li>The <tt class="docutils literal">os</tt> module provide os-specific file and path manipulations; it is used
to transform the input file name into the output file name as well as track down file modification
times.</li>
<li>The <tt class="docutils literal">time</tt> module provides a handy current-time string; this is used
to by the HTML Weaver to write a closing timestamp on generated HTML files,
as well as log messages.</li>
<li>The <tt class="docutils literal">datetime</tt> module is used to format times, phasing out use of <tt class="docutils literal">time</tt>.</li>
<li>The <tt class="docutils literal">types</tt> module is used to get at <tt class="docutils literal">SimpleNamespace</tt> for configuration.</li>
</ul>
<p class="rubric" id="target-158">Imports (158) +=</p>
<pre class="code literal-block">
import os
import time
import datetime
import types
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (158)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>Note that <tt class="docutils literal">os.path</tt>, <tt class="docutils literal">time</tt>, <tt class="docutils literal">datetime</tt> and <tt class="docutils literal">platform`</tt>
are provided in the expression context.</p>
</div>
<div class="section" id="overheads">
<h3><a class="toc-backref" href="#toc-entry-74">Overheads</a></h3>
<p>The shell escape is provided so that the user can define this
file as executable, and launch it directly from their shell.
The shell reads the first line of a file; when it finds the <tt class="docutils literal"><span class="pre">'#!'</span></tt> shell
escape, the remainder of the line is taken as the path to the binary program
that should be run.  The shell runs this binary, providing the
file as standard input.</p>
<p class="rubric" id="target-159">Overheads (159) =</p>
<pre class="code literal-block">
#!/usr/bin/env python
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Overheads (159)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>A Python <tt class="docutils literal">__doc__</tt> string provides a standard vehicle for documenting
the module or the application program.  The usual style is to provide
a one-sentence summary on the first line.  This is followed by more
detailed usage information.</p>
<p class="rubric" id="target-160">Overheads (160) +=</p>
<pre class="code literal-block">
&quot;&quot;&quot;py-web-tool Literate Programming.

Yet another simple literate programming tool derived from nuweb,
implemented entirely in Python.
This produces any markup for any programming language.

Usage:
    pyweb.py [-dvs] [-c x] [-w format] file.w

Options:
    -v           verbose output (the default)
    -s           silent output
    -d           debugging output
    -c x         change the command character from '&#64;' to x
    -w format    Use the given weaver for the final document.
                 Choices are rst, html, latex and htmlshort.
                 Additionally, a `module.class` name can be used.
    -xw          Exclude weaving
    -xt          Exclude tangling
    -pi          Permit include-command errors
    -rt          Transitive references
    -rs          Simple references (default)
    -n           Include line number comments in the tangled source; requires
                 comment start and stop on the &#64;o commands.

    file.w       The input file, with &#64;o, &#64;d, &#64;i, &#64;[, &#64;{, &#64;|, &#64;&lt;, &#64;f, &#64;m, &#64;u commands.
&quot;&quot;&quot;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Overheads (160)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>The keyword cruft is a standard way of placing version control information into
a Python module so it is preserved.  See PEP (Python Enhancement Proposal) #8 for information
on recommended styles.</p>
<p>We also sneak in a &quot;DO NOT EDIT&quot; warning that belongs in all generated application
source files.</p>
<p class="rubric" id="target-161">Overheads (161) +=</p>
<pre class="code literal-block">
__version__ = &quot;&quot;&quot;3.1&quot;&quot;&quot;

### DO NOT EDIT THIS FILE!
### It was created by /Users/slott/Documents/Projects/PyWebTool-3/pyweb/pyweb.py, __version__='3.0'.
### From source pyweb.w modified Fri Jun 10 10:48:04 2022.
### In working directory '/Users/slott/Documents/Projects/py-web-tool'.
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Overheads (161)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
</div>
</div>
<div class="section" id="the-application-class">
<h2><a class="toc-backref" href="#toc-entry-75">The Application Class</a></h2>
<p>The <tt class="docutils literal">Application</tt> class is provided so that the <tt class="docutils literal">Action</tt> instances
have an overall application to update.  This allows the <tt class="docutils literal">WeaveAction</tt> to
provide the selected <tt class="docutils literal">Weaver</tt> instance to the application.  It also provides a
central location for the various options and alternatives that might be accepted from
the command line.</p>
<p>The constructor creates a default <tt class="docutils literal">argparse.Namespace</tt> with values
suitable for weaving and tangling.</p>
<p>The <tt class="docutils literal">parseArgs()</tt> method uses the <tt class="docutils literal">sys.argv</tt> sequence to
parse the command line arguments and update the options.  This allows a
program to pre-process the arguments, passing other arguments to this module.</p>
<p>The <tt class="docutils literal">process()</tt> method processes a list of files.  This is either
the list of files passed as an argument, or it is the list of files
parsed by the <tt class="docutils literal">parseArgs()</tt> method.</p>
<p>The <tt class="docutils literal">parseArgs()</tt> and process() functions are separated so that
another application can <tt class="docutils literal">import pyweb</tt>, bypass command-line parsing, yet still perform
the basic actionss simply and consistently.
For example:</p>
<pre class="literal-block">
import pyweb, argparse

p = argparse.ArgumentParser()
<em>argument definition</em>
config = p.parse_args()

a = pyweb.Application()
<em>Configure the Application based on options</em>
a.process(config)
</pre>
<p>The <tt class="docutils literal">main()</tt> function creates an <tt class="docutils literal">Application</tt> instance and
calls the <tt class="docutils literal">parseArgs()</tt> and <tt class="docutils literal">process()</tt> methods to provide the
expected default behavior for this module when it is used as the main program.</p>
<p>The configuration can be either a <tt class="docutils literal">types.SimpleNamespace</tt> or an
<tt class="docutils literal">argparse.Namespace</tt> instance.</p>
<p class="rubric" id="target-162">Imports (162) +=</p>
<pre class="code literal-block">
import argparse
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (162)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p class="rubric" id="target-163">Application Class (163) =</p>
<pre class="code literal-block">
class Application:
    def __init__(self) -&gt; None:
        self.logger = logging.getLogger(self.__class__.__qualname__)
        →Application default options (<a class="reference internal" href="#target-165">165</a>)

    →Application parse command line (<a class="reference internal" href="#target-166">166</a>)
    →Application class process all files (<a class="reference internal" href="#target-167">167</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Application Class (163)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>The first part of parsing the command line is
setting default values that apply when parameters are omitted.
The default values are set as follows:</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">defaults:</th><td class="field-body">A default configuration.</td>
</tr>
<tr class="field"><th class="field-name">webReader:</th><td class="field-body">is the <tt class="docutils literal">WebReader</tt> instance created for the current
input file.</td>
</tr>
<tr class="field"><th class="field-name">doWeave:</th><td class="field-body">instance of <tt class="docutils literal">Action</tt>
that does weaving only.</td>
</tr>
<tr class="field"><th class="field-name">doTangle:</th><td class="field-body">instance of <tt class="docutils literal">Action</tt>
that does tangling only.</td>
</tr>
<tr class="field"><th class="field-name">theAction:</th><td class="field-body">is an instance of <tt class="docutils literal">Action</tt> that describes
the default overall action: load, tangle and weave.  This is the default unless
overridden by an option.</td>
</tr>
</tbody>
</table>
<p>Here are the configuration values. These are attributes
of the <tt class="docutils literal">argparse.namespace</tt> default as well as the updated
namespace returned by <tt class="docutils literal">parseArgs()</tt>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">verbosity:</th><td class="field-body">Either <tt class="docutils literal">logging.INFO</tt>, <tt class="docutils literal">logging.WARN</tt> or <tt class="docutils literal">logging.DEBUG</tt></td>
</tr>
<tr class="field"><th class="field-name">command:</th><td class="field-body">is set to <tt class="docutils literal">&#64;</tt> as the  default command introducer.</td>
</tr>
<tr class="field"><th class="field-name">permit:</th><td class="field-body">The raw list of permitted command characters, perhaps <tt class="docutils literal">'i'</tt>.</td>
</tr>
<tr class="field"><th class="field-name">permitList:</th><td class="field-body">provides a list of commands that are permitted
to fail.  Typically this is empty, or contains <tt class="docutils literal">&#64;i</tt> to allow the include
command to fail.</td>
</tr>
<tr class="field"><th class="field-name">files:</th><td class="field-body">is the final list of argument files from the command line;
these will be processed unless overridden in the call to <tt class="docutils literal">process()</tt>.</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>!skip:</dt>
<dd>a list of steps to skip: perhaps <tt class="docutils literal">'w'</tt> or <tt class="docutils literal">'t'</tt> to skip weaving or tangling.</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">weaver:</th><td class="field-body">the short name of the weaver.</td>
</tr>
<tr class="field"><th class="field-name">theTangler:</th><td class="field-body">is set to a <tt class="docutils literal">TanglerMake</tt> instance
to create the output files.</td>
</tr>
<tr class="field"><th class="field-name">theWeaver:</th><td class="field-body">is set to an instance of a subclass of <tt class="docutils literal">Weaver</tt> based on <tt class="docutils literal">weaver</tt></td>
</tr>
</tbody>
</table>
<p>Other instance variables.</p>
<p>Here's the global list of available weavers. Essentially this is the subclass
list of <tt class="docutils literal">Weaver</tt>.  Essentially, the list is this:</p>
<pre class="literal-block">
weavers = dict(
    (x.__class__.__name__.lower(), x)
    for x in Weaver.__subclasses__()
)
</pre>
<p>Rather than automate this, and potentially expose elements of the class hierarchy
that aren't really meant to be used, we provide a manually-developed list.</p>
<p class="rubric" id="target-164">Application Class (164) +=</p>
<pre class="code literal-block">
# Global list of available weaver classes.
weavers = {
    'html':  HTML,
    'htmlshort': HTMLShort,
    'latex': LaTeX,
    'rst': RST,
}
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Application Class (164)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>The defaults used for application configuration. The <tt class="docutils literal">expand()</tt> method expands
on these simple text values to create more useful objects.</p>
<p class="rubric" id="target-165">Application default options (165) =</p>
<pre class="code literal-block">
self.defaults = argparse.Namespace(
    verbosity=logging.INFO,
    command='&#64;',
    weaver='rst',
    skip='',  # Don't skip any steps
    permit='',  # Don't tolerate missing includes
    reference='s',  # Simple references
    tangler_line_numbers=False,
    )
self.expand(self.defaults)

# Primitive Actions
self.loadOp = LoadAction()
self.weaveOp = WeaveAction()
self.tangleOp = TangleAction()

# Composite Actions
self.doWeave = ActionSequence(&quot;load and weave&quot;, [self.loadOp, self.weaveOp])
self.doTangle = ActionSequence(&quot;load and tangle&quot;, [self.loadOp, self.tangleOp])
self.theAction = ActionSequence(&quot;load, tangle and weave&quot;, [self.loadOp, self.tangleOp, self.weaveOp])
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Application default options (165)</em>. Used by: Application Class... (<a class="reference internal" href="#target-163">163</a>)</p>
</blockquote>
<p>The algorithm for parsing the command line parameters uses the built in
<tt class="docutils literal">argparse</tt> module.  We have to build a parser, define the options,
and the parse the command-line arguments, updating the default namespace.</p>
<p>We further expand on the arguments. This transforms simple strings into object
instances.</p>
<p class="rubric" id="target-166">Application parse command line (166) =</p>
<pre class="code literal-block">
def parseArgs(self, argv: list[str]) -&gt; argparse.Namespace:
    p = argparse.ArgumentParser()
    p.add_argument(&quot;-v&quot;, &quot;--verbose&quot;, dest=&quot;verbosity&quot;, action=&quot;store_const&quot;, const=logging.INFO)
    p.add_argument(&quot;-s&quot;, &quot;--silent&quot;, dest=&quot;verbosity&quot;, action=&quot;store_const&quot;, const=logging.WARN)
    p.add_argument(&quot;-d&quot;, &quot;--debug&quot;, dest=&quot;verbosity&quot;, action=&quot;store_const&quot;, const=logging.DEBUG)
    p.add_argument(&quot;-c&quot;, &quot;--command&quot;, dest=&quot;command&quot;, action=&quot;store&quot;)
    p.add_argument(&quot;-w&quot;, &quot;--weaver&quot;, dest=&quot;weaver&quot;, action=&quot;store&quot;)
    p.add_argument(&quot;-x&quot;, &quot;--except&quot;, dest=&quot;skip&quot;, action=&quot;store&quot;, choices=('w','t'))
    p.add_argument(&quot;-p&quot;, &quot;--permit&quot;, dest=&quot;permit&quot;, action=&quot;store&quot;)
    p.add_argument(&quot;-r&quot;, &quot;--reference&quot;, dest=&quot;reference&quot;, action=&quot;store&quot;, choices=('t', 's'))
    p.add_argument(&quot;-n&quot;, &quot;--linenumbers&quot;, dest=&quot;tangler_line_numbers&quot;, action=&quot;store_true&quot;)
    p.add_argument(&quot;files&quot;, nargs='+', type=Path)
    config = p.parse_args(argv, namespace=self.defaults)
    self.expand(config)
    return config

def expand(self, config: argparse.Namespace) -&gt; argparse.Namespace:
    &quot;&quot;&quot;Translate the argument values from simple text to useful objects.
    Weaver. Tangler. WebReader.
    &quot;&quot;&quot;
    if config.reference == 't':
        config.reference_style = TransitiveReference()
    elif config.reference == 's':
        config.reference_style = SimpleReference()
    else:
        raise Error(&quot;Improper configuration&quot;)

    try:
        weaver_class = weavers[config.weaver.lower()]
    except KeyError:
        module_name, _, class_name = config.weaver.partition('.')
        weaver_module = __import__(module_name)
        weaver_class = weaver_module.__dict__[class_name]
        if not issubclass(weaver_class, Weaver):
            raise TypeError(f&quot;{weaver_class!r} not a subclass of Weaver&quot;)
    config.theWeaver = weaver_class()

    config.theTangler = TanglerMake()

    if config.permit:
        # save permitted errors, usual case is ``-pi`` to permit ``&#64;i`` include errors
        config.permitList = [f'{config.command!s}{c!s}' for c in config.permit]
    else:
        config.permitList = []

    config.webReader = WebReader()

    return config
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Application parse command line (166)</em>. Used by: Application Class... (<a class="reference internal" href="#target-163">163</a>)</p>
</blockquote>
<p>The <tt class="docutils literal">process()</tt> function uses the current <tt class="docutils literal">Application</tt> settings
to process each file as follows:</p>
<ol class="arabic simple">
<li>Create a new <tt class="docutils literal">WebReader</tt> for the <tt class="docutils literal">Application</tt>, providing
the parameters required to process the input file.</li>
<li>Create a <tt class="docutils literal">Web</tt> instance, <em>w</em>
and set the Web's <em>sourceFileName</em> from the WebReader's <em>filePath</em>.</li>
<li>Perform the given command, typically a <tt class="docutils literal">ActionSequence</tt>,
which does some combination of load, tangle the output files and
weave the final document in the target language; if
necessary, examine the <tt class="docutils literal">Web</tt> to determine the documentation language.</li>
<li>Print a performance summary line that shows lines processed per second.</li>
</ol>
<p>In the event of failure in any of the major processing steps,
a summary message is produced, to clarify the state of
the output files, and the exception is reraised.
The re-raising is done so that all exceptions are handled by the
outermost main program.</p>
<p class="rubric" id="target-167">Application class process all files (167) =</p>
<pre class="code literal-block">
def process(self, config: argparse.Namespace) -&gt; None:
    root = logging.getLogger()
    root.setLevel(config.verbosity)
    self.logger.debug(&quot;Setting root log level to %r&quot;, logging.getLevelName(root.getEffectiveLevel()))

    if config.command:
        self.logger.debug(&quot;Command character %r&quot;, config.command)

    if config.skip:
        if config.skip.lower().startswith('w'): # not weaving == tangling
            self.theAction = self.doTangle
        elif config.skip.lower().startswith('t'): # not tangling == weaving
            self.theAction = self.doWeave
        else:
            raise Exception(f&quot;Unknown -x option {config.skip!r}&quot;)

    self.logger.info(&quot;Weaver %s&quot;, config.theWeaver)

    for f in config.files:
        w = Web() # New, empty web to load and process.
        self.logger.info(&quot;%s %r&quot;, self.theAction.name, f)
        config.source_path = f
        self.theAction.web = w
        self.theAction.options = config
        self.theAction()
        self.logger.info(self.theAction.summary())
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Application class process all files (167)</em>. Used by: Application Class... (<a class="reference internal" href="#target-163">163</a>)</p>
</blockquote>
</div>
<div class="section" id="logging-setup">
<h2><a class="toc-backref" href="#toc-entry-76">Logging Setup</a></h2>
<p>We'll create a logging context manager. This allows us to wrap the <tt class="docutils literal">main()</tt>
function in an explicit <tt class="docutils literal">with</tt> statement that assures that logging is
configured and cleaned up politely.</p>
<p class="rubric" id="target-168">Imports (168) +=</p>
<pre class="code literal-block">
import logging
import logging.config
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Imports (168)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>This has two configuration approaches. If a positional argument is given,
that dictionary is used for <tt class="docutils literal">logging.config.dictConfig</tt>. Otherwise,
keyword arguments are provided to <tt class="docutils literal">logging.basicConfig</tt>.</p>
<p>A subclass might properly load a dictionary
encoded in YAML and use that with <tt class="docutils literal">logging.config.dictConfig</tt>.</p>
<p class="rubric" id="target-169">Logging Setup (169) =</p>
<pre class="code literal-block">
class Logger:
    def __init__(self, dict_config: dict[str, Any] | None = None, **kw_config: Any) -&gt; None:
        self.dict_config = dict_config
        self.kw_config = kw_config
    def __enter__(self) -&gt; &quot;Logger&quot;:
        if self.dict_config:
            logging.config.dictConfig(self.dict_config)
        else:
            logging.basicConfig(**self.kw_config)
        return self
    def __exit__(self, *args: Any) -&gt; Literal[False]:
        logging.shutdown()
        return False
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Logging Setup (169)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>Here's a sample logging setup. This creates a simple console handler and
a formatter that matches the <tt class="docutils literal">basicConfig</tt> formatter.</p>
<p>It defines the root logger plus two overrides for class loggers that might be
used to gather additional information.</p>
<p class="rubric" id="target-170">Logging Setup (170) +=</p>
<pre class="code literal-block">
log_config = {
    'version': 1,
    'disable_existing_loggers': False, # Allow pre-existing loggers to work.
    'style': '{',
    'handlers': {
        'console': {
            'class': 'logging.StreamHandler',
            'stream': 'ext://sys.stderr',
            'formatter': 'basic',
        },
    },
    'formatters': {
        'basic': {
            'format': &quot;{levelname}:{name}:{message}&quot;,
            'style': &quot;{&quot;,
        }
    },

    'root': {'handlers': ['console'], 'level': logging.INFO,},

    #For specific debugging support...
    'loggers': {
    #    'RST': {'level': logging.DEBUG},
    #    'TanglerMake': {'level': logging.DEBUG},
    #    'WebReader': {'level': logging.DEBUG},
    },
}
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Logging Setup (170)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>This seems a bit verbose; a separate configuration file might be better.</p>
<p>Also, we might want a decorator to define loggers consistently for each class.</p>
</div>
<div class="section" id="the-main-function">
<h2><a class="toc-backref" href="#toc-entry-77">The Main Function</a></h2>
<p>The top-level interface is the <tt class="docutils literal">main()</tt> function.
This function creates an <tt class="docutils literal">Application</tt> instance.</p>
<p>The <tt class="docutils literal">Application</tt> object parses the command-line arguments.
Then the <tt class="docutils literal">Application</tt> object does the requested processing.
This two-step process allows for some dependency injection to customize argument processing.</p>
<p>We might also want to parse a logging configuration file, as well
as a weaver template configuration file.</p>
<p class="rubric" id="target-171">Interface Functions (171) =</p>
<pre class="code literal-block">
def main(argv: list[str] = sys.argv[1:]) -&gt; None:
    a = Application()
    config = a.parseArgs(argv)
    a.process(config)

if __name__ == &quot;__main__&quot;:
    with Logger(log_config):
        main()
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Interface Functions (171)</em>. Used by: pyweb.py (<a class="reference internal" href="#target-157">157</a>)</p>
</blockquote>
<p>This can be extended by doing something like the following.</p>
<ol class="arabic simple">
<li>Subclass <tt class="docutils literal">Weaver</tt> create a subclass with different templates.</li>
<li>Update the <tt class="docutils literal">pyweb.weavers</tt> dictionary.</li>
<li>Call <tt class="docutils literal">pyweb.main()</tt> to run the existing
main program with extra classes available to it.</li>
</ol>
<pre class="literal-block">
import pyweb
class MyWeaver(HTML):
   <em>Any template changes</em>

pyweb.weavers['myweaver']= MyWeaver()
pyweb.main()
</pre>
<p>This will create a variant on <strong>py-web-tool</strong> that will handle a different
weaver via the command-line option <tt class="docutils literal"><span class="pre">-w</span> myweaver</tt>.</p>
<!-- pyweb/test.w -->
</div>
</div>
<div class="section" id="unit-tests">
<h1><a class="toc-backref" href="#toc-entry-78">Unit Tests</a></h1>
<p>The <tt class="docutils literal">test</tt> directory includes <tt class="docutils literal">pyweb_test.w</tt>, which will create a
complete test suite.</p>
<p>This source will weaves a <tt class="docutils literal">pyweb_test.html</tt> file. See <a class="reference external" href="file:test/pyweb_test.html">file:test/pyweb_test.html</a></p>
<p>This source will tangle several test modules:  <tt class="docutils literal">test.py</tt>, <tt class="docutils literal">test_tangler.py</tt>, <tt class="docutils literal">test_weaver.py</tt>,
<tt class="docutils literal">test_loader.py</tt> and <tt class="docutils literal">test_unit.py</tt>.  Running the <tt class="docutils literal">test.py</tt> module will include and
execute all 78 tests.</p>
<p>Here's a script that works out well for running this without disturbing the development
environment. The <tt class="docutils literal">PYTHONPATH</tt> setting is essential to support importing <tt class="docutils literal">pyweb</tt>.</p>
<pre class="literal-block">
cd test
python ../pyweb.py pyweb_test.w
PYTHONPATH=.. python test.py
</pre>
<p>Note that the last line really does set an environment variable and run
a program on a single line.</p>
<!-- pyweb/additional.w -->
</div>
<div class="section" id="additional-files">
<h1><a class="toc-backref" href="#toc-entry-79">Additional Files</a></h1>
<p>Two aditional scripts, <tt class="docutils literal">tangle.py</tt> and <tt class="docutils literal">weave.py</tt>, are provided as examples
which an be customized.</p>
<p>The <tt class="docutils literal">README</tt> and <tt class="docutils literal">setup.py</tt> files are also an important part of the
distribution as are a <tt class="docutils literal">.nojekyll</tt> and <tt class="docutils literal">index.html</tt> that are part of
publishing from GitHub.</p>
<p>The <tt class="docutils literal">.CSS</tt> file and <tt class="docutils literal">.conf</tt> file for RST production are also provided here.</p>
<div class="section" id="tangle-py-script">
<h2><a class="toc-backref" href="#toc-entry-80"><tt class="docutils literal">tangle.py</tt> Script</a></h2>
<p>This script shows a simple version of Tangling.  This has a permitted
error for '&#64;i' commands to allow an include file (for example test results)
to be omitted from the tangle operation.</p>
<p>Note the general flow of this top-level script.</p>
<ol class="arabic simple">
<li>Create the logging context.</li>
<li>Create the options. This hard-coded object is a stand-in for
parsing command-line options.</li>
<li>Create the web object.</li>
<li>For each action (<tt class="docutils literal">LoadAction</tt> and <tt class="docutils literal">TangleAction</tt> in this example)
Set the web, set the options, execute the callable action, and write
a summary.</li>
</ol>
<p class="rubric" id="target-172">tangle.py (172) =</p>
<pre class="code literal-block">
#!/usr/bin/env python3
&quot;&quot;&quot;Sample tangle.py script.&quot;&quot;&quot;
import pyweb
import logging
import argparse

with pyweb.Logger(pyweb.log_config):
    logger = logging.getLogger(__file__)

    options = argparse.Namespace(
            webFileName=&quot;pyweb.w&quot;,
            verbosity=logging.INFO,
            command='&#64;',
            permitList=['&#64;i'],
            tangler_line_numbers=False,
            reference_style=pyweb.SimpleReference(),
            theTangler=pyweb.TanglerMake(),
            webReader=pyweb.WebReader(),
            )

    w = pyweb.Web()

    for action in LoadAction(), TangleAction():
            action.web = w
            action.options = options
            action()
            logger.info(action.summary())
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>tangle.py (172)</em>.</p>
</blockquote>
</div>
<div class="section" id="weave-py-script">
<h2><a class="toc-backref" href="#toc-entry-81"><tt class="docutils literal">weave.py</tt> Script</a></h2>
<p>This script shows a simple version of Weaving.  This shows how
to define a customized set of templates for a different markup language.</p>
<p>A customized weaver generally has three parts.</p>
<p class="rubric" id="target-173">weave.py (173) =</p>
<pre class="code literal-block">
→weave.py overheads for correct operation of a script (<a class="reference internal" href="#target-174">174</a>)
→weave.py custom weaver definition to customize the Weaver being used (<a class="reference internal" href="#target-175">175</a>)
→weaver.py processing: load and weave the document (<a class="reference internal" href="#target-176">176</a>)
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>weave.py (173)</em>.</p>
</blockquote>
<p class="rubric" id="target-174">weave.py overheads for correct operation of a script (174) =</p>
<pre class="code literal-block">
#!/usr/bin/env python3
&quot;&quot;&quot;Sample weave.py script.&quot;&quot;&quot;
import pyweb
import logging
import argparse
import string
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>weave.py overheads for correct operation of a script (174)</em>. Used by: weave.py (<a class="reference internal" href="#target-173">173</a>)</p>
</blockquote>
<p class="rubric" id="target-175">weave.py custom weaver definition to customize the Weaver being used (175) =</p>
<pre class="code literal-block">
class MyHTML(pyweb.HTML):
    &quot;&quot;&quot;HTML formatting templates.&quot;&quot;&quot;
    extension = &quot;.html&quot;

    cb_template = string.Template(&quot;&quot;&quot;&lt;a name=&quot;pyweb${seq}&quot;&gt;&lt;/a&gt;
    &lt;!--line number ${lineNumber}--&gt;
    &lt;p&gt;&lt;em&gt;${fullName}&lt;/em&gt; (${seq})&amp;nbsp;${concat}&lt;/p&gt;
    &lt;pre&gt;&lt;code&gt;\n&quot;&quot;&quot;)

    ce_template = string.Template(&quot;&quot;&quot;
    &lt;/code&gt;&lt;/pre&gt;
    &lt;p&gt;&amp;loz; &lt;em&gt;${fullName}&lt;/em&gt; (${seq}).
    ${references}
    &lt;/p&gt;\n&quot;&quot;&quot;)

    fb_template = string.Template(&quot;&quot;&quot;&lt;a name=&quot;pyweb${seq}&quot;&gt;&lt;/a&gt;
    &lt;!--line number ${lineNumber}--&gt;
    &lt;p&gt;``${fullName}`` (${seq})&amp;nbsp;${concat}&lt;/p&gt;
    &lt;pre&gt;&lt;code&gt;\n&quot;&quot;&quot;) # Prevent indent

    fe_template = string.Template( &quot;&quot;&quot;&lt;/code&gt;&lt;/pre&gt;
    &lt;p&gt;&amp;loz; ``${fullName}`` (${seq}).
    ${references}
    &lt;/p&gt;\n&quot;&quot;&quot;)

    ref_item_template = string.Template(
    '&lt;a href=&quot;#pyweb${seq}&quot;&gt;&lt;em&gt;${fullName}&lt;/em&gt;&amp;nbsp;(${seq})&lt;/a&gt;'
    )

    ref_template = string.Template('  Used by ${refList}.' )

    refto_name_template = string.Template(
    '&lt;a href=&quot;#pyweb${seq}&quot;&gt;&amp;rarr;&lt;em&gt;${fullName}&lt;/em&gt;&amp;nbsp;(${seq})&lt;/a&gt;'
    )
    refto_seq_template = string.Template('&lt;a href=&quot;#pyweb${seq}&quot;&gt;(${seq})&lt;/a&gt;')

    xref_head_template = string.Template(&quot;&lt;dl&gt;\n&quot;)
    xref_foot_template = string.Template(&quot;&lt;/dl&gt;\n&quot;)
    xref_item_template = string.Template(&quot;&lt;dt&gt;${fullName}&lt;/dt&gt;&lt;dd&gt;${refList}&lt;/dd&gt;\n&quot;)

    name_def_template = string.Template('&lt;a href=&quot;#pyweb${seq}&quot;&gt;&lt;b&gt;&amp;bull;${seq}&lt;/b&gt;&lt;/a&gt;')
    name_ref_template = string.Template('&lt;a href=&quot;#pyweb${seq}&quot;&gt;${seq}&lt;/a&gt;')
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>weave.py custom weaver definition to customize the Weaver being used (175)</em>. Used by: weave.py (<a class="reference internal" href="#target-173">173</a>)</p>
</blockquote>
<p class="rubric" id="target-176">weaver.py processing: load and weave the document (176) =</p>
<pre class="code literal-block">
with pyweb.Logger(pyweb.log_config):
    logger = logging.getLogger(__file__)

    options = argparse.Namespace(
            webFileName=&quot;pyweb.w&quot;,
            verbosity=logging.INFO,
            command='&#64;',
            theWeaver=MyHTML(),
            permitList=[],
            tangler_line_numbers=False,
            reference_style=pyweb.SimpleReference(),
            theTangler=pyweb.TanglerMake(),
            webReader=pyweb.WebReader(),
            )

    w = pyweb.Web()

    for action in LoadAction(), WeaveAction():
            action.web = w
            action.options = options
            action()
            logger.info(action.summary())
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>weaver.py processing: load and weave the document (176)</em>. Used by: weave.py (<a class="reference internal" href="#target-173">173</a>)</p>
</blockquote>
</div>
<div class="section" id="the-setup-py-requirements-dev-txt-and-manifest-in-files">
<h2><a class="toc-backref" href="#toc-entry-82">The <tt class="docutils literal">setup.py</tt>, <tt class="docutils literal"><span class="pre">requirements-dev.txt</span></tt> and <tt class="docutils literal">MANIFEST.in</tt> files</a></h2>
<p>In order to support a pleasant installation, the <tt class="docutils literal">setup.py</tt> file is helpful.</p>
<p class="rubric" id="target-177">setup.py (177) =</p>
<pre class="code literal-block">
#!/usr/bin/env python3
&quot;&quot;&quot;Setup for pyWeb.&quot;&quot;&quot;

from distutils.core import setup

setup(name='py-web-tool',
      version='3.1',
      description='pyWeb 3.1: Yet Another Literate Programming Tool',
      author='S. Lott',
      <a class="reference external" href="mailto:author_email='s_lott&#64;yahoo.com">author_email='s_lott&#64;yahoo.com</a>',
      url='<a class="reference external" href="http://slott-softwarearchitect.blogspot.com/">http://slott-softwarearchitect.blogspot.com/</a>',
      py_modules=['pyweb'],
      classifiers=[
      'Intended Audience :: Developers',
      'Topic :: Documentation',
      'Topic :: Software Development :: Documentation',
      'Topic :: Text Processing :: Markup',
      ]
   )
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>setup.py (177)</em>.</p>
</blockquote>
<p>In order build a source distribution kit the <tt class="docutils literal">python3 setup.py sdist</tt> requires a
<tt class="docutils literal">MANIFEST</tt>.  We can either list all files or provide a   <tt class="docutils literal">MANIFEST.in</tt>
that specifies additional rules.
We use a simple inclusion to augment the default manifest rules.</p>
<p class="rubric" id="target-178">MANIFEST.in (178) =</p>
<pre class="code literal-block">
include *.w *.css *.html *.conf *.rst
include test/*.w test/*.css test/*.html test/*.conf test/*.py
include jedit/*.xml
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>MANIFEST.in (178)</em>.</p>
</blockquote>
<p>In order to install dependencies, the following file is also used.</p>
<p class="rubric" id="target-179">requirements-dev.txt (179) =</p>
<pre class="code literal-block">
docutils==0.18.1
tox==3.25.0
mypy==0.910
pytest == 7.1.2
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>requirements-dev.txt (179)</em>.</p>
</blockquote>
</div>
<div class="section" id="the-readme-file">
<h2><a class="toc-backref" href="#toc-entry-83">The <tt class="docutils literal">README</tt> file</a></h2>
<p>Here's the README file.</p>
<p class="rubric" id="target-180">README (180) =</p>
<pre class="code literal-block">
pyWeb 3.1: In Python, Yet Another Literate Programming Tool

Literate programming is an attempt to reconcile the opposing needs
of clear presentation to people with the technical issues of
creating code that will work with our current set of tools.

Presentation to people requires extensive and sophisticated typesetting
techniques.  Further, the &quot;narrative arc&quot; of a presentation may not
follow the source code as layed out for the compiler.

pyWeb is a literate programming tool based on Knuth's Web to combine the actions
of weaving a document with tangling source files.
It is independent of any particular document markup or source language.
Is uses a simple set of markup tags to define chunks of code and
documentation.

The ``pyweb.w`` file is the source for the various ``pyweb`` module and script files.
The various source code files are created by applying a
tangle operation to the ``.w`` file.  The final documentation is created by
applying a weave operation to the ``.w`` file.

Installation
-------------

This requires Python 3.10.

First, downnload the distribution kit from PyPI.

::

    python3 setup.py install

This will install the ``pyweb`` module, and the ``weave`` and ``tangle`` applications.

Produce Documentation
---------------------

The supplied documentation uses RST markup; it requires docutils.

::

    python3 -m pip install docutils

::

    python3 -m pyweb pyweb.w
    rst2html.py pyweb.rst pyweb.html

Authoring
---------

The ``pyweb.html`` document describes the markup used to define code chunks
and assemble those code chunks into a coherent document as well as working code.

If you're a JEdit user, the ``jedit`` directory can be used
to configure syntax highlighting that includes **py-web-tool** and RST.

Operation
---------

After installation and authoring, you can then run **py-web-tool** with

::

    python3 -m pyweb pyweb.w

This will create the various output files from the source .w file.

-   ``pyweb.html`` is the final woven document.

-   ``pyweb.py``, ``tangle.py``, ``weave.py``, ``README``, ``setup.py`` and ``MANIFEST.in``
    ``.nojekyll`` and ``index.html`` are tangled output files.

Testing
-------

The test directory includes ``pyweb_test.w``, which will create a
complete test suite.

This weaves a ``pyweb_test.html`` file.

This tangles several test modules:  ``test.py``, ``test_tangler.py``, ``test_weaver.py``,
``test_loader.py`` and ``test_unit.py``.  Running the ``test.py`` module will include and
execute all tests.

::

    cd test
    python3 -m pyweb pyweb_test.w
    PYTHONPATH=.. python3 test.py
    rst2html.py pyweb_test.rst pyweb_test.html
    mypy --strict pyweb.py
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>README (180)</em>.</p>
</blockquote>
</div>
<div class="section" id="the-html-support-files">
<h2><a class="toc-backref" href="#toc-entry-84">The HTML Support Files</a></h2>
<p>To get the RST to look good, there are some additional files.</p>
<p><tt class="docutils literal">docutils.conf</tt> defines the CSS files to use.
The default CSS file (stylesheet-path) may need to be customized for your
installation of docutils.</p>
<p class="rubric" id="target-181">docutils.conf (181) =</p>
<pre class="code literal-block">
# docutils.conf

[html4css1 writer]
stylesheet-path: /Users/slott/miniconda3/envs/pywebtool/lib/python3.10/site-packages/docutils/writers/html4css1/html4css1.css,
    page-layout.css
syntax-highlight: long
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>docutils.conf (181)</em>.</p>
</blockquote>
<p><tt class="docutils literal"><span class="pre">page-layout.css</span></tt>  This tweaks one CSS to be sure that
the resulting HTML pages are easier to read.</p>
<p class="rubric" id="target-182">page-layout.css (182) =</p>
<pre class="code literal-block">
/* Page layout tweaks */
div.document { width: 7in; }
.small { font-size: smaller; }
.code
{
    color: #101080;
    display: block;
    border-color: black;
    border-width: thin;
    border-style: solid;
    background-color: #E0FFFF;
    /*#99FFFF*/
    padding: 0 0 0 1%;
    margin: 0 6% 0 6%;
    text-align: left;
    font-size: smaller;
}
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>page-layout.css (182)</em>.</p>
</blockquote>
<p>Yes, this creates a (nearly) empty file for use by GitHub. There's a small
bug in <tt class="docutils literal">NamedChunk.tangle()</tt> that prevents handling zero-length text.</p>
<p class="rubric" id="target-183">.nojekyll (183) =</p>
<div class="system-message">
<p class="system-message-title">System Message: ERROR/3 (<tt class="docutils">pyweb.rst</tt>, line 8633)</p>
<p>Content block expected for the &quot;parsed-literal&quot; directive; none found.</p>
<pre class="literal-block">
..  parsed-literal::
    :class: code



</pre>
</div>
<!--  -->
<blockquote>
<p class="small">◊ <em>.nojekyll (183)</em>.</p>
</blockquote>
<p>Here's an <tt class="docutils literal">index.html</tt> to redirect GitHub to the <tt class="docutils literal">pyweb.html</tt> file.</p>
<p class="rubric" id="target-184">index.html (184) =</p>
<pre class="code literal-block">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;<a class="reference external" href="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</a>&quot;&gt;
&lt;html xmlns=&quot;<a class="reference external" href="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</a>&quot;&gt;
&lt;head&gt;&lt;title&gt;Redirect&lt;/title&gt;
&lt;meta http-equiv=&quot;refresh&quot; content=&quot;0;url=pyweb.html&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;Sorry, you should have been redirected &lt;a href=&quot;pyweb.html&quot;&gt;pyweb.html&lt;/a&gt;.&lt;/body&gt;
&lt;/html&gt;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>index.html (184)</em>.</p>
</blockquote>
</div>
<div class="section" id="tox-and-makefile">
<h2><a class="toc-backref" href="#toc-entry-85">Tox and Makefile</a></h2>
<p>It's simpler to have a <tt class="docutils literal">Makefile</tt> to automate testing, particularly when making changes
to <strong>py-web-tool</strong>.</p>
<p>Note that there are tabs in this file. We bootstrap the next version from the 3.0 version.</p>
<p class="rubric" id="target-185">Makefile (185) =</p>
<pre class="code literal-block">
# Makefile for py-web-tool.
# Requires a pyweb-3.0.py (untouched) to bootstrap the current version.

SOURCE = pyweb.w intro.w overview.w impl.w tests.w additional.w todo.w done.w \
    test/pyweb_test.w test/intro.w test/unit.w test/func.w test/combined.w

.PHONY : test build

# Note the bootstrapping new version from version 3.0 as baseline.
# Handy to keep this *outside* the project's Git repository.
PYWEB_BOOTSTRAP=/Users/slott/Documents/Projects/PyWebTool-3/pyweb/pyweb.py

test : $(SOURCE)
    python3 $(PYWEB_BOOTSTRAP) -xw pyweb.w
    cd test &amp;&amp; python3 ../pyweb.py pyweb_test.w
    cd test &amp;&amp; PYTHONPATH=.. python3 test.py
    cd test &amp;&amp; rst2html.py pyweb_test.rst pyweb_test.html
    mypy --strict --show-error-codes pyweb.py

build : pyweb.py pyweb.html

pyweb.py pyweb.rst : $(SOURCE)
    python3 $(PYWEB_BOOTSTRAP) pyweb.w

pyweb.html : pyweb.rst
    rst2html.py $&lt; $&#64;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>Makefile (185)</em>.</p>
</blockquote>
<p><strong>TODO:</strong> Finish <tt class="docutils literal">tox.ini</tt> or <tt class="docutils literal">pyproject.toml</tt>.</p>
<p class="rubric" id="target-186">pyproject.toml (186) =</p>
<pre class="code literal-block">
[build-system]
requires = [&quot;setuptools &gt;= 61.2.0&quot;, &quot;wheel &gt;= 0.37.1&quot;, &quot;pytest == 7.1.2&quot;, &quot;mypy == 0.910&quot;]
build-backend = &quot;setuptools.build_meta&quot;

[tool.tox]
legacy_tox_ini = &quot;&quot;&quot;
[tox]
envlist = py310

[testenv]
deps =
    pytest == 7.1.2
    mypy == 0.910
commands_pre =
    python3 pyweb-3.0.py pyweb.w
    python3 pyweb.py -o test test/pyweb_test.w
commands =
    python3 test/test.py
    mypy --strict pyweb.py
&quot;&quot;&quot;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>pyproject.toml (186)</em>.</p>
</blockquote>
<!-- pyweb/jedit.w -->
</div>
</div>
<div class="section" id="jedit-configuration">
<h1><a class="toc-backref" href="#toc-entry-86">JEdit Configuration</a></h1>
<p>Here's the <tt class="docutils literal">pyweb.xml</tt> file that you'll  need to configure
JEdit so that it properly highlights your PyWeb commands.</p>
<p>We'll define the overall properties plus two sets of rules.</p>
<p class="rubric" id="target-187">jedit/pyweb.xml (187) =</p>
<pre class="code literal-block">
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE MODE SYSTEM &quot;xmode.dtd&quot;&gt;

&lt;MODE&gt;
    →props for JEdit mode (<a class="reference internal" href="#target-188">188</a>)
    →rules for JEdit PyWeb and RST (<a class="reference internal" href="#target-189">189</a>)
    →rules for JEdit PyWeb XML-Like Constructs (<a class="reference internal" href="#target-190">190</a>)
&lt;/MODE&gt;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>jedit/pyweb.xml (187)</em>.</p>
</blockquote>
<p>Here are some properties to define RST constructs to JEdit</p>
<p class="rubric" id="target-188">props for JEdit mode (188) =</p>
<pre class="code literal-block">
&lt;PROPS&gt;
    &lt;PROPERTY NAME=&quot;lineComment&quot; VALUE=&quot;.. &quot;/&gt;
    &lt;!-- indent after literal blocks and directives --&gt;
    &lt;PROPERTY NAME=&quot;indentNextLines&quot; VALUE=&quot;.*::$&quot;/&gt;
    &lt;!--
    &lt;PROPERTY NAME=&quot;commentStart&quot; VALUE=&quot;&#64;{&quot; /&gt;
    &lt;PROPERTY NAME=&quot;commentEnd&quot; VALUE=&quot;&#64;}&quot; /&gt;
    --&gt;
&lt;/PROPS&gt;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>props for JEdit mode (188)</em>. Used by: jedit/pyweb.xml (<a class="reference internal" href="#target-187">187</a>)</p>
</blockquote>
<p>Here are some rules to define PyWeb and RST constructs to JEdit.</p>
<p class="rubric" id="target-189">rules for JEdit PyWeb and RST (189) =</p>
<pre class="code literal-block">
&lt;RULES IGNORE_CASE=&quot;FALSE&quot; HIGHLIGHT_DIGITS=&quot;FALSE&quot;&gt;

    &lt;!-- targets --&gt;
    &lt;EOL_SPAN AT_LINE_START=&quot;TRUE&quot; TYPE=&quot;KEYWORD3&quot;&gt;__&lt;/EOL_SPAN&gt;
    &lt;EOL_SPAN AT_LINE_START=&quot;TRUE&quot; TYPE=&quot;KEYWORD3&quot;&gt;.. _&lt;/EOL_SPAN&gt;

    &lt;!-- section titles --&gt;
    &lt;SEQ_REGEXP HASH_CHAR=&quot;===&quot; TYPE=&quot;LABEL&quot;&gt;={3,}&lt;/SEQ_REGEXP&gt;
    &lt;SEQ_REGEXP HASH_CHAR=&quot;---&quot; TYPE=&quot;LABEL&quot;&gt;-{3,}&lt;/SEQ_REGEXP&gt;
    &lt;SEQ_REGEXP HASH_CHAR=&quot;~~~&quot; TYPE=&quot;LABEL&quot;&gt;~{3,}&lt;/SEQ_REGEXP&gt;
    &lt;SEQ_REGEXP HASH_CHAR=&quot;###&quot; TYPE=&quot;LABEL&quot;&gt;#{3,}&lt;/SEQ_REGEXP&gt;
    &lt;SEQ_REGEXP HASH_CHAR='&quot;&quot;&quot;' TYPE=&quot;LABEL&quot;&gt;&quot;{3,}&lt;/SEQ_REGEXP&gt;
    &lt;SEQ_REGEXP HASH_CHAR=&quot;^^^&quot; TYPE=&quot;LABEL&quot;&gt;\^{3,}&lt;/SEQ_REGEXP&gt;
    &lt;SEQ_REGEXP HASH_CHAR=&quot;+++&quot; TYPE=&quot;LABEL&quot;&gt;\+{3,}&lt;/SEQ_REGEXP&gt;
    &lt;SEQ_REGEXP HASH_CHAR=&quot;***&quot; TYPE=&quot;LABEL&quot;&gt;\*{3,}&lt;/SEQ_REGEXP&gt;

    &lt;!-- replacement --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;..&quot;
        AT_LINE_START=&quot;TRUE&quot;
        TYPE=&quot;LITERAL3&quot;
    &gt;\.\.\s\|[^|]+\|&lt;/SEQ_REGEXP&gt;

    &lt;!-- substitution --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;|&quot;
        AT_LINE_START=&quot;FALSE&quot;
        TYPE=&quot;LITERAL4&quot;
    &gt;\|[^|]+\|&lt;/SEQ_REGEXP&gt;

    &lt;!-- directives: .. name:: --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;..&quot;
        AT_LINE_START=&quot;TRUE&quot;
        TYPE=&quot;LITERAL2&quot;
    &gt;\.\.\s[A-z][A-z0-9-_]+::&lt;/SEQ_REGEXP&gt;

    &lt;!-- strong emphasis: **...** --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;**&quot;
        AT_LINE_START=&quot;FALSE&quot;
        TYPE=&quot;KEYWORD2&quot;
    &gt;\*\*[^*]+\*\*&lt;/SEQ_REGEXP&gt;

    &lt;!-- emphasis: *...* --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;*&quot;
        AT_LINE_START=&quot;FALSE&quot;
        TYPE=&quot;KEYWORD4&quot;
    &gt;\*[^\s*][^*]*\*&lt;/SEQ_REGEXP&gt;

    &lt;!-- comments --&gt;
    &lt;EOL_SPAN AT_LINE_START=&quot;TRUE&quot; TYPE=&quot;COMMENT1&quot;&gt;.. &lt;/EOL_SPAN&gt;

    &lt;!-- links: `...`_ or `...`__ --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;`&quot;
        TYPE=&quot;LABEL&quot;
    &gt;`[A-z0-9]+[^`]+`_{1,2}&lt;/SEQ_REGEXP&gt;

    &lt;!-- footnote reference: [0]_ --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;[&quot;
        TYPE=&quot;LABEL&quot;
    &gt;\[[0-9]+\]_&lt;/SEQ_REGEXP&gt;

    &lt;!-- footnote reference: [#]_ or [#foo]_ --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;[#&quot;
        TYPE=&quot;LABEL&quot;
    &gt;\[#[A-z0-9_]*\]_&lt;/SEQ_REGEXP&gt;

    &lt;!-- footnote reference: [*]_ --&gt;
    &lt;SEQ TYPE=&quot;LABEL&quot;&gt;[*]_&lt;/SEQ&gt;

    &lt;!-- citation reference: [foo]_ --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;[&quot;
        TYPE=&quot;LABEL&quot;
    &gt;\[[A-z][A-z0-9_-]*\]_&lt;/SEQ_REGEXP&gt;

    &lt;!-- inline literal: ``...``--&gt;
    &lt;!--&lt;SEQ_REGEXP
        HASH_CHAR=&quot;``&quot;
        TYPE=&quot;LITERAL1&quot;
    &gt;``[^`]+``&lt;/SEQ_REGEXP&gt;--&gt;
    &lt;SPAN TYPE=&quot;LITERAL1&quot; ESCAPE=&quot;\&quot;&gt;
        &lt;BEGIN&gt;``&lt;/BEGIN&gt;
        &lt;END&gt;``&lt;/END&gt;
    &lt;/SPAN&gt;

    &lt;!-- interpreted text: `...` --&gt;
    &lt;!--
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;`&quot;
        TYPE=&quot;KEYWORD1&quot;
    &gt;`[^`]+`&lt;/SEQ_REGEXP&gt;

    --&gt;
    &lt;EOL_SPAN TYPE=&quot;COMMENT1&quot;&gt;&#64;d&lt;/EOL_SPAN&gt;
    &lt;EOL_SPAN TYPE=&quot;COMMENT1&quot;&gt;&#64;o&lt;/EOL_SPAN&gt;

    &lt;SPAN TYPE=&quot;COMMENT1&quot; DELEGATE=&quot;CODE&quot;&gt;
        &lt;BEGIN&gt;&#64;{&lt;/BEGIN&gt;
        &lt;END&gt;&#64;}&lt;/END&gt;
    &lt;/SPAN&gt;

    &lt;SPAN TYPE=&quot;KEYWORD1&quot;&gt;
        &lt;BEGIN&gt;`&lt;/BEGIN&gt;
        &lt;END&gt;`&lt;/END&gt;
    &lt;/SPAN&gt;

    &lt;SEQ_REGEXP HASH_CHAR=&quot;```&quot; TYPE=&quot;LABEL&quot;&gt;`{3,}&lt;/SEQ_REGEXP&gt;

    &lt;!-- :field list: --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;:&quot;
        TYPE=&quot;KEYWORD1&quot;
    &gt;:[A-z][A-z0-9  =\s\t_]*:&lt;/SEQ_REGEXP&gt;

    &lt;!-- table --&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;+-&quot;
        TYPE=&quot;LABEL&quot;
    &gt;\+-[+-]+&lt;/SEQ_REGEXP&gt;
    &lt;SEQ_REGEXP
        HASH_CHAR=&quot;+?&quot;
        TYPE=&quot;LABEL&quot;
    &gt;\+=[+=]+&lt;/SEQ_REGEXP&gt;

&lt;/RULES&gt;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>rules for JEdit PyWeb and RST (189)</em>. Used by: jedit/pyweb.xml (<a class="reference internal" href="#target-187">187</a>)</p>
</blockquote>
<p>Here are some additional rules to define PyWeb constructs to JEdit
that look like XML.</p>
<p class="rubric" id="target-190">rules for JEdit PyWeb XML-Like Constructs (190) =</p>
<pre class="code literal-block">
&lt;RULES SET=&quot;CODE&quot; DEFAULT=&quot;KEYWORD1&quot;&gt;
    &lt;SPAN TYPE=&quot;MARKUP&quot;&gt;
        &lt;BEGIN&gt;&#64;&amp;lt;&lt;/BEGIN&gt;
        &lt;END&gt;&#64;&amp;gt;&lt;/END&gt;
    &lt;/SPAN&gt;
&lt;/RULES&gt;
</pre>
<!--  -->
<blockquote>
<p class="small">◊ <em>rules for JEdit PyWeb XML-Like Constructs (190)</em>. Used by: jedit/pyweb.xml (<a class="reference internal" href="#target-187">187</a>)</p>
</blockquote>
<p>Additionally, you'll want to update the JEdit catalog.</p>
<pre class="literal-block">
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE MODES SYSTEM &quot;catalog.dtd&quot;&gt;
&lt;MODES&gt;

&lt;!-- Add lines like the following, one for each edit mode you add: --&gt;
&lt;MODE NAME=&quot;pyweb&quot; FILE=&quot;pyweb.xml&quot; FILE_NAME_GLOB=&quot;*.w&quot;/&gt;

&lt;/MODES&gt;
</pre>
<!-- End -->
<!-- pyweb/todo.w -->
</div>
<div class="section" id="python-3-10-migration">
<h1><a class="toc-backref" href="#toc-entry-87">Python 3.10 Migration</a></h1>
<ol class="arabic simple">
<li>[x] Add type hints.</li>
<li>[x] Replace all <tt class="docutils literal">.format()</tt> with f-strings.</li>
<li>[x] Replace filename strings (and <tt class="docutils literal">os.path</tt>) with <tt class="docutils literal">pathlib.Path</tt>.</li>
<li>[ ] Add <tt class="docutils literal">abc</tt> to formalize Abstract Base Classes.</li>
<li>[ ] Introduce <tt class="docutils literal">match</tt> statements for some of the <tt class="docutils literal">elif</tt> blocks.</li>
<li>[ ] Introduce pytest instead of building a test runner.</li>
<li>[ ] <tt class="docutils literal">pyproject.toml</tt>. This requires <tt class="docutils literal"><span class="pre">`-o</span> dir</tt> option to write output to a directory of choice; which requires <tt class="docutils literal">pathlib</tt>.</li>
<li>[ ] Replace various mock classes with <tt class="docutils literal">unittest.mock.Mock</tt> objects and appropriate extended testing.</li>
</ol>
</div>
<div class="section" id="to-do">
<h1><a class="toc-backref" href="#toc-entry-88">To Do</a></h1>
<ol class="arabic">
<li><p class="first">Silence the ERROR-level logging during testing.</p>
</li>
<li><p class="first">Silence the error when creating an empty file i.e. <tt class="docutils literal">.nojekyll</tt></p>
</li>
<li><p class="first">Add a JSON-based (or TOML) configuration file to configure templates.</p>
<ul>
<li><p class="first">See the <tt class="docutils literal">weave.py</tt> example.
This removes any need for a weaver command-line option; its defined within the source.
Also, setting the command character can be done in this configuration, too.</p>
</li>
<li><p class="first">An alternative is to get markup templates from some kind of &quot;header&quot; section in the <tt class="docutils literal">.w</tt> file.</p>
<p>To support reuse over multiple projects, a header could be included with <tt class="docutils literal">&#64;i</tt>.
The downside is that we have a lot of variable = value syntax that makes it
more like a properties file than a <tt class="docutils literal">.w</tt> syntax file. It seems needless to invent
a lot of new syntax just for configuration.</p>
</li>
</ul>
</li>
<li><p class="first">JSON-based logging configuration file would be helpful.
Should be separate from template configuration.</p>
</li>
<li><p class="first">We might want to decompose the <tt class="docutils literal">impl.w</tt> file: it's huge.</p>
</li>
<li><p class="first">We might want to interleave code and test into a document that presents both
side-by-side. They get routed to different output files.</p>
</li>
<li><p class="first">Fix name definition order. There's no <strong>good</strong> reason why a full name should
be first and elided names defined later.</p>
</li>
<li><p class="first">Add a <tt class="docutils literal">&#64;h</tt> &quot;header goes here&quot; command to allow weaving any <strong>pyWeb</strong> required addons to
a LaTeX header, HTML header or RST header.
These are extra <tt class="docutils literal">..&nbsp; include::</tt>, <tt class="docutils literal">\\usepackage{fancyvrb}</tt> or maybe an HTML CSS reference
that come from <strong>pyWeb</strong> and need to be folded into otherwise boilerplate documents.</p>
</li>
<li><p class="first">Update the <tt class="docutils literal"><span class="pre">-indent</span></tt> option to accept a numeric argument with the
specific indentation value. This becomes a kind of &quot;noindent&quot; with a given
value. The <tt class="docutils literal"><span class="pre">-noindent</span></tt> would then be the same as <tt class="docutils literal"><span class="pre">-indent</span> 0</tt>.</p>
</li>
<li><p class="first">Offer a basic XHTML template that uses <tt class="docutils literal">CDATA</tt> sections instead of quoting.
Does require the standard quoting for the <tt class="docutils literal">CDATA</tt> end tag.</p>
</li>
<li><p class="first">The <tt class="docutils literal">createUsedBy()</tt> method can be done incrementally by
accumulating a list of forward references to chunks; as each
new chunk is added, any references to the chunk are removed from
the forward references list, and a call is made to the Web's
setUsage method.  References backward to already existing chunks
are easily resolved with a simple lookup.</p>
</li>
<li><p class="first">Note that the overall <tt class="docutils literal">Web</tt> is a bit like a <tt class="docutils literal">NamedChunk</tt> that contains <tt class="docutils literal">Chunks</tt>.
This similarity could be factored out.
While this will create a more proper <strong>Composition</strong> pattern implementation, it
leads to the question of why nest <tt class="docutils literal">&#64;d</tt> or <tt class="docutils literal">&#64;o</tt> chunks in the first place?</p>
</li>
</ol>
<div class="section" id="other-thoughts">
<h2><a class="toc-backref" href="#toc-entry-89">Other Thoughts</a></h2>
<p>There are two possible projects that might prove useful.</p>
<ul class="simple">
<li>Jinja2 for better templates.</li>
<li>pyYAML for slightly cleaner encoding of logging configuration
or other configuration.</li>
</ul>
<p>There are advantages and disadvantages to depending on other projects.
The disadvantage is a (very low, but still present) barrier to adoption.
The advantage of adding these two projects might be some simplification.</p>
<!-- pyweb/done.w -->
</div>
</div>
<div class="section" id="change-log">
<h1><a class="toc-backref" href="#toc-entry-90">Change Log</a></h1>
<p>Changes for 3.1</p>
<ul class="simple">
<li>Change to Python 3.10.</li>
<li>Add type hints, f-strings, pathlib.</li>
<li>Replace some complex elif blocks with match statements</li>
<li>Remove the Jedit configuration file as an output.</li>
<li>Add a <tt class="docutils literal">Makefile</tt>, <tt class="docutils literal">pyproject.toml</tt>, <tt class="docutils literal">requirements.txt</tt> and <tt class="docutils literal"><span class="pre">requirements-dev.txt</span></tt>.</li>
</ul>
<p>Changes for 3.0</p>
<ul class="simple">
<li>Move to GitHub</li>
</ul>
<p>Changes for 2.3.2.</p>
<ul class="simple">
<li>Fix all <tt class="docutils literal">{:s}</tt> format strings to be <tt class="docutils literal">{!s}</tt>.</li>
</ul>
<p>Changes for 2.3.1.</p>
<ul class="simple">
<li>Cleanup some stray comment errors.</li>
<li>Revise the documentation structure and organization.</li>
<li>Tweak the error messages.</li>
</ul>
<p>Changes for 2.3.</p>
<ul class="simple">
<li>Changed to Python 3.3 -- Fixed <tt class="docutils literal">except</tt>, <tt class="docutils literal">raise</tt> and <tt class="docutils literal">%</tt>.</li>
<li>Removed <tt class="docutils literal">doWrite()</tt> and simplified <tt class="docutils literal">doOpen()</tt> and <tt class="docutils literal">doClose()</tt>.</li>
<li>Cleaned up RST output to be much nicer.</li>
<li>Change the baseline <tt class="docutils literal">pyweb.w</tt> file to be RST instead of HTML.
docutils required to produce HTML from the woven output.</li>
<li>Removed the unconstrained <tt class="docutils literal">eval()</tt> function. Provided a slim set of globals.
<tt class="docutils literal">os</tt> is really just <tt class="docutils literal">os.path</tt>.
Any <tt class="docutils literal">os.getcwd()</tt> can be changed to <tt class="docutils literal"><span class="pre">os.path.realpath('.')</span></tt>.
<tt class="docutils literal">time</tt> was removed and replaced with <tt class="docutils literal">datetime</tt>.
Any <tt class="docutils literal">time.asctime()</tt> must be <tt class="docutils literal"><span class="pre">datetime.datetime.now().ctime()</span></tt>.</li>
<li>Resolved a small dispute between <tt class="docutils literal">weaveReferenceTo()</tt> (wrong) and <tt class="docutils literal">tangle()</tt> (right).
for NamedChunks. The issue was one of failure to understand the differences
between weaving -- where indentation is localized -- and tangling -- where indentation
must be tracked globally. Root cause was a huge problem in <tt class="docutils literal">codeBlock()</tt> which didn't
really weave properly at all.</li>
<li>Fix the tokenizer and parsing. Stop using a complex tokenizer and use a simpler
iterator over the tokens with <tt class="docutils literal">StopIteration</tt> exception handling.</li>
<li>Replace <tt class="docutils literal">optparse</tt> with <tt class="docutils literal">argparse</tt>.</li>
<li>Get rid of the global <tt class="docutils literal">logger</tt> variable.</li>
<li>Remove the filename as part of <tt class="docutils literal">Web()</tt> initial creation.
A basename comes from the initial <tt class="docutils literal">.w</tt> file loaded by the <tt class="docutils literal">WebReader</tt>.</li>
<li>Fix the Action class hierarchy so that composite actions are simpler.</li>
<li>Change references to return <tt class="docutils literal">Chunk</tt> objects, not <tt class="docutils literal">(name,sequence)</tt> pairs.</li>
<li>Make the ref list separator in <tt class="docutils literal">Weaver reference <span class="pre">summary...</span></tt> a proper template
feature, not a hidden punctuation mark in the code.</li>
<li>Configure <tt class="docutils literal">Web.reference_style</tt> properly so that simple or transitive references
can be included as a command-line option. The default is Simple.
Add the <tt class="docutils literal"><span class="pre">-r</span></tt> option so that <tt class="docutils literal"><span class="pre">-rt</span></tt> includes transitive references.</li>
<li>Reduce the &quot;hard-coded&quot; punctuation. For example, the <tt class="docutils literal">&quot;, &quot;</tt> in
<tt class="docutils literal">&#64;d Web <span class="pre">weave...</span></tt> <tt class="docutils literal">weaveChunk()</tt>.  This was moved into a template.</li>
<li>Add an <tt class="docutils literal">__enter__()</tt> and <tt class="docutils literal">__exit__()</tt> to make an <tt class="docutils literal">Emitter</tt>
into a proper Context Manager that can be used with a <tt class="docutils literal">with</tt> statement.</li>
<li>Add the <tt class="docutils literal"><span class="pre">-n</span></tt> option to include tangler line numbers if the <tt class="docutils literal">&#64;o</tt> includes
the comment characters.</li>
<li>Cleanup the <tt class="docutils literal">TanglerMake</tt> unit tests to remove the <tt class="docutils literal">sleep()</tt>
used to assure that the timestamps really are different.</li>
<li>Cleanup the syntax for adding a comment template to <tt class="docutils literal">&#64;o</tt>. Use <tt class="docutils literal"><span class="pre">-start</span></tt> and <tt class="docutils literal"><span class="pre">-end</span></tt>
before the filename.</li>
<li>Cleanup the syntax for noindent named chunks. Use <tt class="docutils literal"><span class="pre">-noindent</span></tt> before the chunk name.
This creates a distinct <tt class="docutils literal">NamedChunk_Noindent</tt> instance that handles indentation
differently from other <tt class="docutils literal">Chunk</tt> subclasses.</li>
<li>Cleanup the <tt class="docutils literal">TangleAction</tt> summary.</li>
<li>Clean up the error messages. Raising an exception seems
heavy-handed and confusing.  Count errors instead.</li>
</ul>
<p>Changes since version 1.4</p>
<ul class="simple">
<li>Removed home-brewed logger.</li>
<li>Replaced <tt class="docutils literal">getopt</tt> with <tt class="docutils literal">optparse</tt>.</li>
<li>Replaced LaTeX markup.</li>
<li>Corrected significant problems in cross-reference resolution.</li>
<li>Replaced all HTML and LaTeX-specific features with a much simpler template
engine which applies a template to a Chunk.  The Templates are separate
configuration items.  The big issue with templates are conditional processing
and the use of loops to handle multiple references in a transitive closure.
While it's nice to depend on Jinja2, it's also nice to be totally stand-alone.
Sigh.  Choices include the no-logic <tt class="docutils literal">string.Template</tt> in the standard library
or the <tt class="docutils literal">Templite+</tt> Recipe 576663.</li>
<li>Looked at SCons API.  Renamed &quot;Operation&quot; to &quot;Action&quot;; renamed &quot;perform&quot; to &quot;__call__&quot;.
Consider having &quot;__call__&quot; which does logging, then call &quot;execute&quot;.</li>
<li>Eliminated the EmitterFactory; replace this with simple injection of
the proper template configuration.</li>
<li>Removed the <tt class="docutils literal">&#64;O</tt> command; it was essentially a variant template for LaTeX.</li>
<li>Disentangled indentation and quoting in the codeBlock.
Indentation rules vary between Tangling and Weaving.
Quoting is unique to a woven codeBlock.  Fix <tt class="docutils literal">referenceTo()</tt>  to write
indented without code quoting.</li>
<li>Offer a basic RST template.
Note that colorizing may be easier to handle with an RST template.
The weaving markup template degenerates
to <tt class="docutils literal">..&nbsp;&nbsp; <span class="pre">parsed-literal::</span></tt> and indent.  By doing this,
the RST output from <em>pyWeb</em> can be run through DocUtils <tt class="docutils literal">rst2html.py</tt>
or perhaps <em>Sphix</em> to create final HTML. The hard part is the indent.</li>
<li>Tweaked (but didn't fix) ReferenceCommand tangle and all setIndent/clrIndent operations.
Only a ReferenceCommand actually cares about indentation.  And that indentation
is totally based on the &quot;context&quot; plus the text in the Command immediate in front
of the ReferenceCommand.</li>
</ul>
</div>
<div class="section" id="indices">
<h1><a class="toc-backref" href="#toc-entry-91">Indices</a></h1>
<div class="section" id="files">
<h2><a class="toc-backref" href="#toc-entry-92">Files</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">.nojekyll:</th><td class="field-body">→(<a class="reference internal" href="#target-183">183</a>)</td>
</tr>
<tr class="field"><th class="field-name">MANIFEST.in:</th><td class="field-body">→(<a class="reference internal" href="#target-178">178</a>)</td>
</tr>
<tr class="field"><th class="field-name">Makefile:</th><td class="field-body">→(<a class="reference internal" href="#target-185">185</a>)</td>
</tr>
<tr class="field"><th class="field-name">README:</th><td class="field-body">→(<a class="reference internal" href="#target-180">180</a>)</td>
</tr>
<tr class="field"><th class="field-name">docutils.conf:</th><td class="field-body">→(<a class="reference internal" href="#target-181">181</a>)</td>
</tr>
<tr class="field"><th class="field-name">index.html:</th><td class="field-body">→(<a class="reference internal" href="#target-184">184</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">jedit/pyweb.xml:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-187">187</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">page-layout.css:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-182">182</a>)</td>
</tr>
<tr class="field"><th class="field-name">pyproject.toml:</th><td class="field-body">→(<a class="reference internal" href="#target-186">186</a>)</td>
</tr>
<tr class="field"><th class="field-name">pyweb.py:</th><td class="field-body">→(<a class="reference internal" href="#target-157">157</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">requirements-dev.txt:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-179">179</a>)</td>
</tr>
<tr class="field"><th class="field-name">setup.py:</th><td class="field-body">→(<a class="reference internal" href="#target-177">177</a>)</td>
</tr>
<tr class="field"><th class="field-name">tangle.py:</th><td class="field-body">→(<a class="reference internal" href="#target-172">172</a>)</td>
</tr>
<tr class="field"><th class="field-name">weave.py:</th><td class="field-body">→(<a class="reference internal" href="#target-173">173</a>)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="macros">
<h2><a class="toc-backref" href="#toc-entry-93">Macros</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name" colspan="2">Action call method actually does the real work:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-142">142</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Action class hierarchy - used to describe actions of the application:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-140">140</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Action final summary of what was done:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-143">143</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Action superclass has common features of all actions:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-141">141</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ActionSequence append adds a new action to the sequence:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-146">146</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ActionSequence call method delegates the sequence of ations:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-145">145</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ActionSequence subclass that holds a sequence of other actions:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-144">144</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ActionSequence summary summarizes each step:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-147">147</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Application Class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-163">163</a>) →(<a class="reference internal" href="#target-164">164</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Application class process all files:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-167">167</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Application default options:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-165">165</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Application parse command line:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-166">166</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Base Class Definitions:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-1">1</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk add to the web:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-56">56</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk append a command:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-54">54</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk append text:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-55">55</a>)</td>
</tr>
<tr class="field"><th class="field-name">Chunk class:</th><td class="field-body">→(<a class="reference internal" href="#target-53">53</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk class hierarchy - used to describe input chunks:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-52">52</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk examination:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">starts with, matches pattern:
→(<a class="reference internal" href="#target-59">59</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk generate references from this Chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-60">60</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk indent adjustments:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-64">64</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk references to this Chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-61">61</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk superclass make Content definition:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-57">57</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk tangle this Chunk into a code file:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-63">63</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Chunk weave this Chunk into the documentation:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-62">62</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">CodeCommand class to contain a program source code block:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-83">83</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Command analysis features:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">starts-with and Regular Expression search:
→(<a class="reference internal" href="#target-80">80</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Command class hierarchy - used to describe individual commands:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-78">78</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Command superclass:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-79">79</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Command tangle and weave functions:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-81">81</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Emitter class hierarchy - used to control output files:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-2">2</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Emitter core open, close and write:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-5">5</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Emitter doClose, to be overridden by subclasses:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-7">7</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Emitter doOpen, to be overridden by subclasses:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-6">6</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Emitter indent control:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">set, clear and reset:
→(<a class="reference internal" href="#target-11">11</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Emitter superclass:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-4">4</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Emitter write a block of code:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-8">8</a>) →(<a class="reference internal" href="#target-9">9</a>) →(<a class="reference internal" href="#target-10">10</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Error class - defines the errors raised:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-96">96</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">FileXrefCommand class for an output file cross-reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-85">85</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML code chunk begin:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-34">34</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML code chunk end:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-35">35</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML output file begin:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-36">36</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML output file end:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-37">37</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML reference to a chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-40">40</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML references summary at the end of a chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-38">38</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML short references summary at the end of a chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-43">43</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML simple cross reference markup:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-41">41</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML subclass of Weaver:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-32">32</a>) →(<a class="reference internal" href="#target-33">33</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML write a line of code:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-39">39</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">HTML write user id cross reference line:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-42">42</a>)</td>
</tr>
<tr class="field"><th class="field-name">Imports:</th><td class="field-body">→(<a class="reference internal" href="#target-3">3</a>) →(<a class="reference internal" href="#target-12">12</a>) →(<a class="reference internal" href="#target-48">48</a>) →(<a class="reference internal" href="#target-58">58</a>) →(<a class="reference internal" href="#target-98">98</a>) →(<a class="reference internal" href="#target-126">126</a>) →(<a class="reference internal" href="#target-131">131</a>) →(<a class="reference internal" href="#target-134">134</a>) →(<a class="reference internal" href="#target-136">136</a>) →(<a class="reference internal" href="#target-158">158</a>) →(<a class="reference internal" href="#target-162">162</a>) →(<a class="reference internal" href="#target-168">168</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Interface Functions:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-171">171</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LaTeX code chunk begin:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-25">25</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LaTeX code chunk end:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-26">26</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LaTeX file output begin:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-27">27</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LaTeX file output end:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-28">28</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LaTeX reference to a chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-31">31</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LaTeX references summary at the end of a chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-29">29</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LaTeX subclass of Weaver:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-24">24</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LaTeX write a line of code:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-30">30</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LoadAction call method loads the input files:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-155">155</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LoadAction subclass loads the document web:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-154">154</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">LoadAction summary provides lines read:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-156">156</a>)</td>
</tr>
<tr class="field"><th class="field-name">Logging Setup:</th><td class="field-body">→(<a class="reference internal" href="#target-169">169</a>) →(<a class="reference internal" href="#target-170">170</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">MacroXrefCommand class for a named chunk cross-reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-86">86</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">NamedChunk add to the web:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-67">67</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">NamedChunk class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-65">65</a>) →(<a class="reference internal" href="#target-70">70</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">NamedChunk tangle into the source file:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-69">69</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">NamedChunk user identifiers set and get:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-66">66</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">NamedChunk weave into the documentation:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-68">68</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">NamedDocumentChunk class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-75">75</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">NamedDocumentChunk tangle:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-77">77</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">NamedDocumentChunk weave:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-76">76</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Option Parser class - locates optional values on commands:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-137">137</a>) →(<a class="reference internal" href="#target-138">138</a>) →(<a class="reference internal" href="#target-139">139</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">OutputChunk add to the web:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-72">72</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">OutputChunk class:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-71">71</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">OutputChunk tangle:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-74">74</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">OutputChunk weave:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-73">73</a>)</td>
</tr>
<tr class="field"><th class="field-name">Overheads:</th><td class="field-body">→(<a class="reference internal" href="#target-159">159</a>) →(<a class="reference internal" href="#target-160">160</a>) →(<a class="reference internal" href="#target-161">161</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">RST subclass of Weaver:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-23">23</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Reference class hierarchy - strategies for references to a chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-93">93</a>) →(<a class="reference internal" href="#target-94">94</a>) →(<a class="reference internal" href="#target-95">95</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ReferenceCommand class for chunk references:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-88">88</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ReferenceCommand refers to a chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-90">90</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ReferenceCommand resolve a referenced chunk name:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-89">89</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ReferenceCommand tangle a referenced chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-92">92</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ReferenceCommand weave a reference to a chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-91">91</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">TangleAction call method does tangling of the output files:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-152">152</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">TangleAction subclass initiates the tangle action:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-151">151</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">TangleAction summary method provides total lines tangled:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-153">153</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangler code chunk begin:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-46">46</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangler code chunk end:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-47">47</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangler doOpen, and doClose overrides:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-45">45</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tangler subclass of Emitter to create source files with no markup:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-44">44</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">TanglerMake doClose override, comparing temporary to original:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-51">51</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">TanglerMake doOpen override, using a temporary file:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-50">50</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">TanglerMake subclass which is make-sensitive:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-49">49</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">TextCommand class to contain a document text block:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-82">82</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Tokenizer class - breaks input into tokens:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-135">135</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">UserIdXrefCommand class for a user identifier cross-reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-87">87</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">WeaveAction call method to pick the language:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-149">149</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">WeaveAction subclass initiates the weave action:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-148">148</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">WeaveAction summary of language choice:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-150">150</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weaver code chunk begin-end:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-18">18</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weaver cross reference output methods:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-21">21</a>) →(<a class="reference internal" href="#target-22">22</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weaver doOpen, doClose and addIndent overrides:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-14">14</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weaver document chunk begin-end:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-16">16</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weaver file chunk begin-end:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-19">19</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weaver quoted characters:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-15">15</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weaver reference command output:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-20">20</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weaver reference summary, used by code chunk and file chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-17">17</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Weaver subclass of Emitter to create documentation:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-13">13</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web Chunk check reference counts are all one:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-107">107</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web Chunk cross reference methods:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-106">106</a>) →(<a class="reference internal" href="#target-108">108</a>) →(<a class="reference internal" href="#target-109">109</a>) →(<a class="reference internal" href="#target-110">110</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web Chunk name resolution methods:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-104">104</a>) →(<a class="reference internal" href="#target-105">105</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web add a named macro chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-102">102</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web add an anonymous chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-101">101</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web add an output file definition chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-103">103</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web add full chunk names, ignoring abbreviated names:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-100">100</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web class - describes the overall &quot;web&quot; of chunks:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-97">97</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web construction methods used by Chunks and WebReader:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-99">99</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web determination of the language from the first chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-113">113</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web tangle the output files:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-114">114</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">Web weave the output document:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-115">115</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">WebReader class - parses the input file, building the Web structure:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-116">116</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">WebReader command literals:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-133">133</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">WebReader handle a command string:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-117">117</a>) →(<a class="reference internal" href="#target-129">129</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">WebReader load the web:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-132">132</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">WebReader location in the input stream:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-130">130</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">XrefCommand superclass for all cross-reference commands:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-84">84</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">add a reference command to the current chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-125">125</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">add an expression command to the current chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-127">127</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">assign user identifiers to the current chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-124">124</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">collect all user identifiers from a given map into ux:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-111">111</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">double at-sign replacement, append this character to previous TextCommand:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-128">128</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">find user identifier usage and update ux from the given map:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-112">112</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">finish a chunk, start a new Chunk adding it to the web:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-122">122</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">include another file:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-121">121</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">major commands segment the input into separate Chunks:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-118">118</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">minor commands add Commands to the current Chunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-123">123</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">props for JEdit mode:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-188">188</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">rules for JEdit PyWeb XML-Like Constructs:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-190">190</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">rules for JEdit PyWeb and RST:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-189">189</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">start a NamedChunk or NamedDocumentChunk, adding it to the web:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-120">120</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">start an OutputChunk, adding it to the web:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-119">119</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">weave.py custom weaver definition to customize the Weaver being used:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-175">175</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">weave.py overheads for correct operation of a script:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">→(<a class="reference internal" href="#target-174">174</a>)</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">weaver.py processing:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">load and weave the document:
→(<a class="reference internal" href="#target-176">176</a>)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="user-identifiers">
<h2><a class="toc-backref" href="#toc-entry-94">User Identifiers</a></h2>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Action:</th><td class="field-body">[<a class="reference internal" href="#target-141">141</a>] <a class="reference internal" href="#target-144">144</a> <a class="reference internal" href="#target-146">146</a> <a class="reference internal" href="#target-148">148</a> <a class="reference internal" href="#target-151">151</a> <a class="reference internal" href="#target-154">154</a></td>
</tr>
<tr class="field"><th class="field-name">ActionSequence:</th><td class="field-body">[<a class="reference internal" href="#target-144">144</a>] <a class="reference internal" href="#target-165">165</a></td>
</tr>
<tr class="field"><th class="field-name">Application:</th><td class="field-body">[<a class="reference internal" href="#target-163">163</a>] <a class="reference internal" href="#target-171">171</a></td>
</tr>
<tr class="field"><th class="field-name">Chunk:</th><td class="field-body"><a class="reference internal" href="#target-16">16</a> <a class="reference internal" href="#target-17">17</a> <a class="reference internal" href="#target-18">18</a> <a class="reference internal" href="#target-19">19</a> <a class="reference internal" href="#target-46">46</a> <a class="reference internal" href="#target-47">47</a> [<a class="reference internal" href="#target-53">53</a>] <a class="reference internal" href="#target-59">59</a> <a class="reference internal" href="#target-60">60</a> <a class="reference internal" href="#target-65">65</a> <a class="reference internal" href="#target-79">79</a> <a class="reference internal" href="#target-88">88</a> <a class="reference internal" href="#target-92">92</a> <a class="reference internal" href="#target-93">93</a> <a class="reference internal" href="#target-94">94</a> <a class="reference internal" href="#target-95">95</a> <a class="reference internal" href="#target-97">97</a> <a class="reference internal" href="#target-101">101</a> <a class="reference internal" href="#target-102">102</a> <a class="reference internal" href="#target-103">103</a> <a class="reference internal" href="#target-105">105</a> <a class="reference internal" href="#target-106">106</a> <a class="reference internal" href="#target-110">110</a> <a class="reference internal" href="#target-116">116</a> <a class="reference internal" href="#target-121">121</a> <a class="reference internal" href="#target-122">122</a> <a class="reference internal" href="#target-125">125</a> <a class="reference internal" href="#target-132">132</a></td>
</tr>
<tr class="field"><th class="field-name">CodeCommand:</th><td class="field-body"><a class="reference internal" href="#target-65">65</a> [<a class="reference internal" href="#target-83">83</a>]</td>
</tr>
<tr class="field"><th class="field-name">Command:</th><td class="field-body"><a class="reference internal" href="#target-53">53</a> <a class="reference internal" href="#target-54">54</a> <a class="reference internal" href="#target-57">57</a> <a class="reference internal" href="#target-65">65</a> <a class="reference internal" href="#target-75">75</a> [<a class="reference internal" href="#target-79">79</a>] <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-84">84</a> <a class="reference internal" href="#target-88">88</a> <a class="reference internal" href="#target-167">167</a></td>
</tr>
<tr class="field"><th class="field-name">Emitter:</th><td class="field-body">[<a class="reference internal" href="#target-4">4</a>] <a class="reference internal" href="#target-5">5</a> <a class="reference internal" href="#target-13">13</a> <a class="reference internal" href="#target-44">44</a></td>
</tr>
<tr class="field"><th class="field-name">Error:</th><td class="field-body"><a class="reference internal" href="#target-60">60</a> <a class="reference internal" href="#target-63">63</a> <a class="reference internal" href="#target-69">69</a> <a class="reference internal" href="#target-77">77</a> <a class="reference internal" href="#target-84">84</a> <a class="reference internal" href="#target-92">92</a> [<a class="reference internal" href="#target-96">96</a>] <a class="reference internal" href="#target-102">102</a> <a class="reference internal" href="#target-104">104</a> <a class="reference internal" href="#target-105">105</a> <a class="reference internal" href="#target-115">115</a> <a class="reference internal" href="#target-120">120</a> <a class="reference internal" href="#target-121">121</a> <a class="reference internal" href="#target-127">127</a> <a class="reference internal" href="#target-139">139</a> <a class="reference internal" href="#target-149">149</a> <a class="reference internal" href="#target-152">152</a> <a class="reference internal" href="#target-155">155</a> <a class="reference internal" href="#target-166">166</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">FileXrefCommand:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">[<a class="reference internal" href="#target-85">85</a>] <a class="reference internal" href="#target-123">123</a></td>
</tr>
<tr class="field"><th class="field-name">HTML:</th><td class="field-body"><a class="reference internal" href="#target-32">32</a> [<a class="reference internal" href="#target-33">33</a>] <a class="reference internal" href="#target-113">113</a> <a class="reference internal" href="#target-164">164</a> <a class="reference internal" href="#target-175">175</a></td>
</tr>
<tr class="field"><th class="field-name">LaTeX:</th><td class="field-body">[<a class="reference internal" href="#target-24">24</a>] <a class="reference internal" href="#target-113">113</a> <a class="reference internal" href="#target-164">164</a></td>
</tr>
<tr class="field"><th class="field-name">LoadAction:</th><td class="field-body">[<a class="reference internal" href="#target-154">154</a>] <a class="reference internal" href="#target-165">165</a> <a class="reference internal" href="#target-172">172</a> <a class="reference internal" href="#target-176">176</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">MacroXrefCommand:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">[<a class="reference internal" href="#target-86">86</a>] <a class="reference internal" href="#target-123">123</a></td>
</tr>
<tr class="field"><th class="field-name">NamedChunk:</th><td class="field-body"><a class="reference internal" href="#target-59">59</a> [<a class="reference internal" href="#target-65">65</a>] <a class="reference internal" href="#target-70">70</a> <a class="reference internal" href="#target-71">71</a> <a class="reference internal" href="#target-75">75</a> <a class="reference internal" href="#target-120">120</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">NamedDocumentChunk:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">[<a class="reference internal" href="#target-75">75</a>] <a class="reference internal" href="#target-120">120</a></td>
</tr>
<tr class="field"><th class="field-name">OutputChunk:</th><td class="field-body">[<a class="reference internal" href="#target-71">71</a>] <a class="reference internal" href="#target-119">119</a></td>
</tr>
<tr class="field"><th class="field-name">Path:</th><td class="field-body">[<a class="reference internal" href="#target-3">3</a>] <a class="reference internal" href="#target-4">4</a> <a class="reference internal" href="#target-5">5</a> <a class="reference internal" href="#target-6">6</a> <a class="reference internal" href="#target-14">14</a> <a class="reference internal" href="#target-45">45</a> <a class="reference internal" href="#target-50">50</a> <a class="reference internal" href="#target-53">53</a> <a class="reference internal" href="#target-97">97</a> <a class="reference internal" href="#target-114">114</a> <a class="reference internal" href="#target-116">116</a> <a class="reference internal" href="#target-121">121</a> <a class="reference internal" href="#target-132">132</a> <a class="reference internal" href="#target-166">166</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">ReferenceCommand:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">[<a class="reference internal" href="#target-88">88</a>] <a class="reference internal" href="#target-125">125</a></td>
</tr>
<tr class="field"><th class="field-name">TangleAction:</th><td class="field-body">[<a class="reference internal" href="#target-151">151</a>] <a class="reference internal" href="#target-165">165</a> <a class="reference internal" href="#target-172">172</a></td>
</tr>
<tr class="field"><th class="field-name">Tangler:</th><td class="field-body"><a class="reference internal" href="#target-4">4</a> [<a class="reference internal" href="#target-44">44</a>] <a class="reference internal" href="#target-49">49</a> <a class="reference internal" href="#target-63">63</a> <a class="reference internal" href="#target-64">64</a> <a class="reference internal" href="#target-69">69</a> <a class="reference internal" href="#target-70">70</a> <a class="reference internal" href="#target-74">74</a> <a class="reference internal" href="#target-77">77</a> <a class="reference internal" href="#target-81">81</a> <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-83">83</a> <a class="reference internal" href="#target-84">84</a> <a class="reference internal" href="#target-92">92</a> <a class="reference internal" href="#target-114">114</a> <a class="reference internal" href="#target-166">166</a></td>
</tr>
<tr class="field"><th class="field-name">TanglerMake:</th><td class="field-body">[<a class="reference internal" href="#target-49">49</a>] <a class="reference internal" href="#target-166">166</a> <a class="reference internal" href="#target-170">170</a> <a class="reference internal" href="#target-172">172</a> <a class="reference internal" href="#target-176">176</a></td>
</tr>
<tr class="field"><th class="field-name">TextCommand:</th><td class="field-body"><a class="reference internal" href="#target-55">55</a> <a class="reference internal" href="#target-57">57</a> <a class="reference internal" href="#target-69">69</a> <a class="reference internal" href="#target-75">75</a> [<a class="reference internal" href="#target-82">82</a>] <a class="reference internal" href="#target-83">83</a></td>
</tr>
<tr class="field"><th class="field-name">Tokenizer:</th><td class="field-body"><a class="reference internal" href="#target-116">116</a> <a class="reference internal" href="#target-132">132</a> [<a class="reference internal" href="#target-135">135</a>]</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">UserIdXrefCommand:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body">[<a class="reference internal" href="#target-87">87</a>] <a class="reference internal" href="#target-123">123</a></td>
</tr>
<tr class="field"><th class="field-name">WeaveAction:</th><td class="field-body">[<a class="reference internal" href="#target-148">148</a>] <a class="reference internal" href="#target-165">165</a> <a class="reference internal" href="#target-176">176</a></td>
</tr>
<tr class="field"><th class="field-name">Weaver:</th><td class="field-body">[<a class="reference internal" href="#target-13">13</a>] <a class="reference internal" href="#target-23">23</a> <a class="reference internal" href="#target-24">24</a> <a class="reference internal" href="#target-32">32</a> <a class="reference internal" href="#target-61">61</a> <a class="reference internal" href="#target-62">62</a> <a class="reference internal" href="#target-68">68</a> <a class="reference internal" href="#target-73">73</a> <a class="reference internal" href="#target-76">76</a> <a class="reference internal" href="#target-81">81</a> <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-83">83</a> <a class="reference internal" href="#target-84">84</a> <a class="reference internal" href="#target-85">85</a> <a class="reference internal" href="#target-86">86</a> <a class="reference internal" href="#target-87">87</a> <a class="reference internal" href="#target-91">91</a> <a class="reference internal" href="#target-113">113</a> <a class="reference internal" href="#target-115">115</a> <a class="reference internal" href="#target-166">166</a> <a class="reference internal" href="#target-167">167</a></td>
</tr>
<tr class="field"><th class="field-name">Web:</th><td class="field-body"><a class="reference internal" href="#target-46">46</a> <a class="reference internal" href="#target-53">53</a> <a class="reference internal" href="#target-56">56</a> <a class="reference internal" href="#target-60">60</a> <a class="reference internal" href="#target-62">62</a> <a class="reference internal" href="#target-63">63</a> <a class="reference internal" href="#target-64">64</a> <a class="reference internal" href="#target-67">67</a> <a class="reference internal" href="#target-68">68</a> <a class="reference internal" href="#target-69">69</a> <a class="reference internal" href="#target-70">70</a> <a class="reference internal" href="#target-72">72</a> <a class="reference internal" href="#target-73">73</a> <a class="reference internal" href="#target-74">74</a> <a class="reference internal" href="#target-76">76</a> <a class="reference internal" href="#target-77">77</a> <a class="reference internal" href="#target-81">81</a> <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-83">83</a> <a class="reference internal" href="#target-84">84</a> <a class="reference internal" href="#target-85">85</a> <a class="reference internal" href="#target-86">86</a> <a class="reference internal" href="#target-87">87</a> <a class="reference internal" href="#target-89">89</a> <a class="reference internal" href="#target-90">90</a> <a class="reference internal" href="#target-91">91</a> <a class="reference internal" href="#target-92">92</a> [<a class="reference internal" href="#target-97">97</a>] <a class="reference internal" href="#target-116">116</a> <a class="reference internal" href="#target-132">132</a> <a class="reference internal" href="#target-141">141</a> <a class="reference internal" href="#target-155">155</a> <a class="reference internal" href="#target-167">167</a> <a class="reference internal" href="#target-172">172</a> <a class="reference internal" href="#target-176">176</a> <a class="reference internal" href="#target-180">180</a></td>
</tr>
<tr class="field"><th class="field-name">WebReader:</th><td class="field-body">[<a class="reference internal" href="#target-116">116</a>] <a class="reference internal" href="#target-121">121</a> <a class="reference internal" href="#target-132">132</a> <a class="reference internal" href="#target-166">166</a> <a class="reference internal" href="#target-170">170</a> <a class="reference internal" href="#target-172">172</a> <a class="reference internal" href="#target-176">176</a></td>
</tr>
<tr class="field"><th class="field-name">XrefCommand:</th><td class="field-body">[<a class="reference internal" href="#target-84">84</a>] <a class="reference internal" href="#target-85">85</a> <a class="reference internal" href="#target-86">86</a> <a class="reference internal" href="#target-87">87</a></td>
</tr>
<tr class="field"><th class="field-name">__enter__:</th><td class="field-body">[<a class="reference internal" href="#target-5">5</a>] <a class="reference internal" href="#target-169">169</a></td>
</tr>
<tr class="field"><th class="field-name">__exit__:</th><td class="field-body">[<a class="reference internal" href="#target-5">5</a>] <a class="reference internal" href="#target-169">169</a></td>
</tr>
<tr class="field"><th class="field-name">__version__:</th><td class="field-body"><a class="reference internal" href="#target-127">127</a> [<a class="reference internal" href="#target-161">161</a>]</td>
</tr>
<tr class="field"><th class="field-name">_gatherUserId:</th><td class="field-body">[<a class="reference internal" href="#target-110">110</a>]</td>
</tr>
<tr class="field"><th class="field-name">_updateUserId:</th><td class="field-body">[<a class="reference internal" href="#target-110">110</a>]</td>
</tr>
<tr class="field"><th class="field-name">add:</th><td class="field-body"><a class="reference internal" href="#target-56">56</a> [<a class="reference internal" href="#target-101">101</a>]</td>
</tr>
<tr class="field"><th class="field-name">addDefName:</th><td class="field-body">[<a class="reference internal" href="#target-100">100</a>] <a class="reference internal" href="#target-102">102</a> <a class="reference internal" href="#target-125">125</a></td>
</tr>
<tr class="field"><th class="field-name">addIndent:</th><td class="field-body"><a class="reference internal" href="#target-11">11</a> [<a class="reference internal" href="#target-14">14</a>] <a class="reference internal" href="#target-64">64</a> <a class="reference internal" href="#target-68">68</a></td>
</tr>
<tr class="field"><th class="field-name">addNamed:</th><td class="field-body"><a class="reference internal" href="#target-67">67</a> [<a class="reference internal" href="#target-102">102</a>]</td>
</tr>
<tr class="field"><th class="field-name">addOutput:</th><td class="field-body"><a class="reference internal" href="#target-72">72</a> [<a class="reference internal" href="#target-103">103</a>]</td>
</tr>
<tr class="field"><th class="field-name">append:</th><td class="field-body"><a class="reference internal" href="#target-11">11</a> <a class="reference internal" href="#target-14">14</a> <a class="reference internal" href="#target-54">54</a> <a class="reference internal" href="#target-55">55</a> <a class="reference internal" href="#target-95">95</a> <a class="reference internal" href="#target-101">101</a> <a class="reference internal" href="#target-102">102</a> <a class="reference internal" href="#target-103">103</a> <a class="reference internal" href="#target-106">106</a> <a class="reference internal" href="#target-112">112</a> <a class="reference internal" href="#target-123">123</a> <a class="reference internal" href="#target-125">125</a> <a class="reference internal" href="#target-139">139</a> [<a class="reference internal" href="#target-146">146</a>]</td>
</tr>
<tr class="field"><th class="field-name">appendText:</th><td class="field-body">[<a class="reference internal" href="#target-55">55</a>] <a class="reference internal" href="#target-125">125</a> <a class="reference internal" href="#target-127">127</a> <a class="reference internal" href="#target-128">128</a> <a class="reference internal" href="#target-132">132</a></td>
</tr>
<tr class="field"><th class="field-name">argparse:</th><td class="field-body"><a class="reference internal" href="#target-141">141</a> [<a class="reference internal" href="#target-162">162</a>] <a class="reference internal" href="#target-165">165</a> <a class="reference internal" href="#target-166">166</a> <a class="reference internal" href="#target-167">167</a> <a class="reference internal" href="#target-172">172</a> <a class="reference internal" href="#target-174">174</a> <a class="reference internal" href="#target-176">176</a></td>
</tr>
<tr class="field"><th class="field-name">builtins:</th><td class="field-body">[<a class="reference internal" href="#target-126">126</a>] <a class="reference internal" href="#target-127">127</a></td>
</tr>
<tr class="field"><th class="field-name">chunkXref:</th><td class="field-body"><a class="reference internal" href="#target-86">86</a> [<a class="reference internal" href="#target-109">109</a>]</td>
</tr>
<tr class="field"><th class="field-name">close:</th><td class="field-body">[<a class="reference internal" href="#target-5">5</a>] <a class="reference internal" href="#target-14">14</a> <a class="reference internal" href="#target-45">45</a> <a class="reference internal" href="#target-51">51</a></td>
</tr>
<tr class="field"><th class="field-name">clrIndent:</th><td class="field-body">[<a class="reference internal" href="#target-11">11</a>] <a class="reference internal" href="#target-64">64</a> <a class="reference internal" href="#target-68">68</a> <a class="reference internal" href="#target-70">70</a></td>
</tr>
<tr class="field"><th class="field-name">codeBegin:</th><td class="field-body"><a class="reference internal" href="#target-18">18</a> [<a class="reference internal" href="#target-46">46</a>] <a class="reference internal" href="#target-68">68</a> <a class="reference internal" href="#target-69">69</a></td>
</tr>
<tr class="field"><th class="field-name">codeBlock:</th><td class="field-body">[<a class="reference internal" href="#target-8">8</a>] <a class="reference internal" href="#target-68">68</a> <a class="reference internal" href="#target-83">83</a></td>
</tr>
<tr class="field"><th class="field-name">codeEnd:</th><td class="field-body"><a class="reference internal" href="#target-18">18</a> [<a class="reference internal" href="#target-47">47</a>] <a class="reference internal" href="#target-68">68</a> <a class="reference internal" href="#target-69">69</a></td>
</tr>
<tr class="field"><th class="field-name">codeFinish:</th><td class="field-body"><a class="reference internal" href="#target-5">5</a> <a class="reference internal" href="#target-10">10</a> [<a class="reference internal" href="#target-14">14</a>]</td>
</tr>
<tr class="field"><th class="field-name">createUsedBy:</th><td class="field-body">[<a class="reference internal" href="#target-106">106</a>] <a class="reference internal" href="#target-155">155</a></td>
</tr>
<tr class="field"><th class="field-name">datetime:</th><td class="field-body"><a class="reference internal" href="#target-127">127</a> [<a class="reference internal" href="#target-158">158</a>]</td>
</tr>
<tr class="field"><th class="field-name">doClose:</th><td class="field-body"><a class="reference internal" href="#target-5">5</a> <a class="reference internal" href="#target-7">7</a> <a class="reference internal" href="#target-14">14</a> <a class="reference internal" href="#target-45">45</a> [<a class="reference internal" href="#target-51">51</a>]</td>
</tr>
<tr class="field"><th class="field-name">doOpen:</th><td class="field-body"><a class="reference internal" href="#target-5">5</a> <a class="reference internal" href="#target-6">6</a> <a class="reference internal" href="#target-14">14</a> <a class="reference internal" href="#target-45">45</a> [<a class="reference internal" href="#target-50">50</a>]</td>
</tr>
<tr class="field"><th class="field-name">docBegin:</th><td class="field-body">[<a class="reference internal" href="#target-16">16</a>] <a class="reference internal" href="#target-62">62</a></td>
</tr>
<tr class="field"><th class="field-name">docEnd:</th><td class="field-body">[<a class="reference internal" href="#target-16">16</a>] <a class="reference internal" href="#target-62">62</a></td>
</tr>
<tr class="field"><th class="field-name">duration:</th><td class="field-body">[<a class="reference internal" href="#target-143">143</a>] <a class="reference internal" href="#target-150">150</a> <a class="reference internal" href="#target-153">153</a> <a class="reference internal" href="#target-156">156</a></td>
</tr>
<tr class="field"><th class="field-name">expand:</th><td class="field-body"><a class="reference internal" href="#target-76">76</a> <a class="reference internal" href="#target-125">125</a> <a class="reference internal" href="#target-165">165</a> [<a class="reference internal" href="#target-166">166</a>]</td>
</tr>
<tr class="field"><th class="field-name">expect:</th><td class="field-body"><a class="reference internal" href="#target-119">119</a> <a class="reference internal" href="#target-120">120</a> <a class="reference internal" href="#target-125">125</a> <a class="reference internal" href="#target-127">127</a> [<a class="reference internal" href="#target-129">129</a>]</td>
</tr>
<tr class="field"><th class="field-name">fileBegin:</th><td class="field-body"><a class="reference internal" href="#target-19">19</a> [<a class="reference internal" href="#target-36">36</a>] <a class="reference internal" href="#target-73">73</a></td>
</tr>
<tr class="field"><th class="field-name">fileEnd:</th><td class="field-body"><a class="reference internal" href="#target-19">19</a> [<a class="reference internal" href="#target-37">37</a>] <a class="reference internal" href="#target-73">73</a></td>
</tr>
<tr class="field"><th class="field-name">fileXref:</th><td class="field-body"><a class="reference internal" href="#target-85">85</a> [<a class="reference internal" href="#target-109">109</a>]</td>
</tr>
<tr class="field"><th class="field-name">filecmp:</th><td class="field-body">[<a class="reference internal" href="#target-48">48</a>] <a class="reference internal" href="#target-51">51</a></td>
</tr>
<tr class="field"><th class="field-name">formatXref:</th><td class="field-body">[<a class="reference internal" href="#target-84">84</a>] <a class="reference internal" href="#target-85">85</a> <a class="reference internal" href="#target-86">86</a></td>
</tr>
<tr class="field"><th class="field-name">fullNameFor:</th><td class="field-body"><a class="reference internal" href="#target-68">68</a> <a class="reference internal" href="#target-73">73</a> <a class="reference internal" href="#target-89">89</a> <a class="reference internal" href="#target-100">100</a> [<a class="reference internal" href="#target-104">104</a>] <a class="reference internal" href="#target-105">105</a> <a class="reference internal" href="#target-106">106</a></td>
</tr>
<tr class="field"><th class="field-name">genReferences:</th><td class="field-body">[<a class="reference internal" href="#target-60">60</a>] <a class="reference internal" href="#target-106">106</a></td>
</tr>
<tr class="field"><th class="field-name">getUserIDRefs:</th><td class="field-body"><a class="reference internal" href="#target-59">59</a> [<a class="reference internal" href="#target-66">66</a>] <a class="reference internal" href="#target-111">111</a></td>
</tr>
<tr class="field"><th class="field-name">getchunk:</th><td class="field-body"><a class="reference internal" href="#target-89">89</a> [<a class="reference internal" href="#target-105">105</a>] <a class="reference internal" href="#target-106">106</a> <a class="reference internal" href="#target-115">115</a></td>
</tr>
<tr class="field"><th class="field-name">handleCommand:</th><td class="field-body">[<a class="reference internal" href="#target-117">117</a>] <a class="reference internal" href="#target-132">132</a></td>
</tr>
<tr class="field"><th class="field-name">language:</th><td class="field-body">[<a class="reference internal" href="#target-113">113</a>] <a class="reference internal" href="#target-149">149</a> <a class="reference internal" href="#target-160">160</a> <a class="reference internal" href="#target-180">180</a></td>
</tr>
<tr class="field"><th class="field-name">lineNumber:</th><td class="field-body"><a class="reference internal" href="#target-18">18</a> <a class="reference internal" href="#target-19">19</a> <a class="reference internal" href="#target-34">34</a> <a class="reference internal" href="#target-36">36</a> <a class="reference internal" href="#target-46">46</a> <a class="reference internal" href="#target-55">55</a> <a class="reference internal" href="#target-57">57</a> [<a class="reference internal" href="#target-59">59</a>] <a class="reference internal" href="#target-65">65</a> <a class="reference internal" href="#target-69">69</a> <a class="reference internal" href="#target-75">75</a> <a class="reference internal" href="#target-79">79</a> <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-84">84</a> <a class="reference internal" href="#target-88">88</a> <a class="reference internal" href="#target-121">121</a> <a class="reference internal" href="#target-123">123</a> <a class="reference internal" href="#target-125">125</a> <a class="reference internal" href="#target-127">127</a> <a class="reference internal" href="#target-128">128</a> <a class="reference internal" href="#target-130">130</a> <a class="reference internal" href="#target-132">132</a> <a class="reference internal" href="#target-135">135</a> <a class="reference internal" href="#target-175">175</a></td>
</tr>
<tr class="field"><th class="field-name">load:</th><td class="field-body"><a class="reference internal" href="#target-121">121</a> [<a class="reference internal" href="#target-132">132</a>] <a class="reference internal" href="#target-155">155</a> <a class="reference internal" href="#target-165">165</a> <a class="reference internal" href="#target-167">167</a></td>
</tr>
<tr class="field"><th class="field-name">location:</th><td class="field-body"><a class="reference internal" href="#target-117">117</a> <a class="reference internal" href="#target-124">124</a> <a class="reference internal" href="#target-127">127</a> <a class="reference internal" href="#target-129">129</a> [<a class="reference internal" href="#target-130">130</a>]</td>
</tr>
<tr class="field"><th class="field-name">logging:</th><td class="field-body"><a class="reference internal" href="#target-4">4</a> <a class="reference internal" href="#target-53">53</a> <a class="reference internal" href="#target-79">79</a> <a class="reference internal" href="#target-93">93</a> <a class="reference internal" href="#target-97">97</a> <a class="reference internal" href="#target-116">116</a> <a class="reference internal" href="#target-141">141</a> <a class="reference internal" href="#target-163">163</a> <a class="reference internal" href="#target-165">165</a> <a class="reference internal" href="#target-166">166</a> <a class="reference internal" href="#target-167">167</a> [<a class="reference internal" href="#target-168">168</a>] <a class="reference internal" href="#target-169">169</a> <a class="reference internal" href="#target-170">170</a> <a class="reference internal" href="#target-172">172</a> <a class="reference internal" href="#target-174">174</a> <a class="reference internal" href="#target-176">176</a></td>
</tr>
<tr class="field"><th class="field-name">logging.config:</th><td class="field-body">[<a class="reference internal" href="#target-168">168</a>] <a class="reference internal" href="#target-169">169</a></td>
</tr>
<tr class="field"><th class="field-name">main:</th><td class="field-body">[<a class="reference internal" href="#target-171">171</a>]</td>
</tr>
<tr class="field"><th class="field-name">makeContent:</th><td class="field-body"><a class="reference internal" href="#target-55">55</a> [<a class="reference internal" href="#target-57">57</a>] <a class="reference internal" href="#target-65">65</a> <a class="reference internal" href="#target-75">75</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">multi_reference:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body"><a class="reference internal" href="#target-107">107</a> [<a class="reference internal" href="#target-108">108</a>]</td>
</tr>
<tr class="field"><th class="field-name">no_definition:</th><td class="field-body"><a class="reference internal" href="#target-107">107</a> [<a class="reference internal" href="#target-108">108</a>]</td>
</tr>
<tr class="field"><th class="field-name">no_reference:</th><td class="field-body"><a class="reference internal" href="#target-107">107</a> [<a class="reference internal" href="#target-108">108</a>]</td>
</tr>
<tr class="field"><th class="field-name">open:</th><td class="field-body">[<a class="reference internal" href="#target-5">5</a>] <a class="reference internal" href="#target-14">14</a> <a class="reference internal" href="#target-45">45</a> <a class="reference internal" href="#target-114">114</a> <a class="reference internal" href="#target-115">115</a> <a class="reference internal" href="#target-127">127</a> <a class="reference internal" href="#target-132">132</a></td>
</tr>
<tr class="field"><th class="field-name">os:</th><td class="field-body"><a class="reference internal" href="#target-50">50</a> <a class="reference internal" href="#target-51">51</a> <a class="reference internal" href="#target-127">127</a> [<a class="reference internal" href="#target-158">158</a>]</td>
</tr>
<tr class="field"><th class="field-name">parse:</th><td class="field-body"><a class="reference internal" href="#target-119">119</a> <a class="reference internal" href="#target-120">120</a> [<a class="reference internal" href="#target-132">132</a>] <a class="reference internal" href="#target-139">139</a></td>
</tr>
<tr class="field"><th class="field-name">parseArgs:</th><td class="field-body">[<a class="reference internal" href="#target-166">166</a>] <a class="reference internal" href="#target-171">171</a></td>
</tr>
<tr class="field"><th class="field-name">perform:</th><td class="field-body">[<a class="reference internal" href="#target-155">155</a>]</td>
</tr>
<tr class="field"><th class="field-name">platform:</th><td class="field-body">[<a class="reference internal" href="#target-126">126</a>] <a class="reference internal" href="#target-127">127</a></td>
</tr>
<tr class="field"><th class="field-name">process:</th><td class="field-body"><a class="reference internal" href="#target-127">127</a> [<a class="reference internal" href="#target-167">167</a>] <a class="reference internal" href="#target-171">171</a></td>
</tr>
<tr class="field"><th class="field-name">quote:</th><td class="field-body">[<a class="reference internal" href="#target-9">9</a>] <a class="reference internal" href="#target-83">83</a></td>
</tr>
<tr class="field"><th class="field-name">quoted_chars:</th><td class="field-body"><a class="reference internal" href="#target-9">9</a> <a class="reference internal" href="#target-15">15</a> <a class="reference internal" href="#target-30">30</a> [<a class="reference internal" href="#target-39">39</a>]</td>
</tr>
<tr class="field"><th class="field-name">re:</th><td class="field-body"><a class="reference internal" href="#target-112">112</a> [<a class="reference internal" href="#target-134">134</a>] <a class="reference internal" href="#target-135">135</a> <a class="reference internal" href="#target-180">180</a></td>
</tr>
<tr class="field"><th class="field-name">readdIndent:</th><td class="field-body"><a class="reference internal" href="#target-4">4</a> [<a class="reference internal" href="#target-11">11</a>] <a class="reference internal" href="#target-14">14</a></td>
</tr>
<tr class="field"><th class="field-name">ref:</th><td class="field-body"><a class="reference internal" href="#target-29">29</a> <a class="reference internal" href="#target-60">60</a> [<a class="reference internal" href="#target-81">81</a>] <a class="reference internal" href="#target-90">90</a> <a class="reference internal" href="#target-101">101</a> <a class="reference internal" href="#target-102">102</a> <a class="reference internal" href="#target-103">103</a></td>
</tr>
<tr class="field"><th class="field-name">referenceSep:</th><td class="field-body">[<a class="reference internal" href="#target-20">20</a>] <a class="reference internal" href="#target-115">115</a></td>
</tr>
<tr class="field"><th class="field-name">referenceTo:</th><td class="field-body"><a class="reference internal" href="#target-20">20</a> <a class="reference internal" href="#target-21">21</a> [<a class="reference internal" href="#target-40">40</a>] <a class="reference internal" href="#target-68">68</a></td>
</tr>
<tr class="field"><th class="field-name">references:</th><td class="field-body"><a class="reference internal" href="#target-17">17</a> <a class="reference internal" href="#target-18">18</a> <a class="reference internal" href="#target-19">19</a> <a class="reference internal" href="#target-20">20</a> <a class="reference internal" href="#target-26">26</a> <a class="reference internal" href="#target-33">33</a> <a class="reference internal" href="#target-35">35</a> <a class="reference internal" href="#target-37">37</a> [<a class="reference internal" href="#target-43">43</a>] <a class="reference internal" href="#target-53">53</a> <a class="reference internal" href="#target-60">60</a> <a class="reference internal" href="#target-61">61</a> <a class="reference internal" href="#target-107">107</a> <a class="reference internal" href="#target-124">124</a> <a class="reference internal" href="#target-160">160</a> <a class="reference internal" href="#target-165">165</a> <a class="reference internal" href="#target-175">175</a></td>
</tr>
<tr class="field"><th class="field-name">resolve:</th><td class="field-body"><a class="reference internal" href="#target-69">69</a> [<a class="reference internal" href="#target-89">89</a>] <a class="reference internal" href="#target-90">90</a> <a class="reference internal" href="#target-91">91</a> <a class="reference internal" href="#target-92">92</a> <a class="reference internal" href="#target-105">105</a></td>
</tr>
<tr class="field"><th class="field-name">searchForRE:</th><td class="field-body"><a class="reference internal" href="#target-59">59</a> [<a class="reference internal" href="#target-80">80</a>] <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-112">112</a></td>
</tr>
<tr class="field"><th class="field-name">setIndent:</th><td class="field-body">[<a class="reference internal" href="#target-11">11</a>] <a class="reference internal" href="#target-70">70</a></td>
</tr>
<tr class="field"><th class="field-name">setUserIDRefs:</th><td class="field-body"><a class="reference internal" href="#target-59">59</a> [<a class="reference internal" href="#target-66">66</a>] <a class="reference internal" href="#target-124">124</a></td>
</tr>
<tr class="field"><th class="field-name">shlex:</th><td class="field-body">[<a class="reference internal" href="#target-136">136</a>] <a class="reference internal" href="#target-139">139</a></td>
</tr>
<tr class="field"><th class="field-name">startswith:</th><td class="field-body"><a class="reference internal" href="#target-59">59</a> [<a class="reference internal" href="#target-80">80</a>] <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-104">104</a> <a class="reference internal" href="#target-113">113</a> <a class="reference internal" href="#target-132">132</a> <a class="reference internal" href="#target-139">139</a> <a class="reference internal" href="#target-167">167</a></td>
</tr>
<tr class="field"><th class="field-name">string:</th><td class="field-body">[<a class="reference internal" href="#target-12">12</a>] <a class="reference internal" href="#target-17">17</a> <a class="reference internal" href="#target-18">18</a> <a class="reference internal" href="#target-19">19</a> <a class="reference internal" href="#target-20">20</a> <a class="reference internal" href="#target-21">21</a> <a class="reference internal" href="#target-22">22</a> <a class="reference internal" href="#target-25">25</a> <a class="reference internal" href="#target-26">26</a> <a class="reference internal" href="#target-29">29</a> <a class="reference internal" href="#target-31">31</a> <a class="reference internal" href="#target-34">34</a> <a class="reference internal" href="#target-35">35</a> <a class="reference internal" href="#target-36">36</a> <a class="reference internal" href="#target-37">37</a> <a class="reference internal" href="#target-38">38</a> <a class="reference internal" href="#target-40">40</a> <a class="reference internal" href="#target-41">41</a> <a class="reference internal" href="#target-42">42</a> <a class="reference internal" href="#target-43">43</a> <a class="reference internal" href="#target-174">174</a> <a class="reference internal" href="#target-175">175</a></td>
</tr>
<tr class="field"><th class="field-name">summary:</th><td class="field-body"><a class="reference internal" href="#target-143">143</a> <a class="reference internal" href="#target-147">147</a> <a class="reference internal" href="#target-150">150</a> <a class="reference internal" href="#target-153">153</a> [<a class="reference internal" href="#target-156">156</a>] <a class="reference internal" href="#target-167">167</a> <a class="reference internal" href="#target-172">172</a> <a class="reference internal" href="#target-176">176</a></td>
</tr>
<tr class="field"><th class="field-name">sys:</th><td class="field-body">[<a class="reference internal" href="#target-126">126</a>] <a class="reference internal" href="#target-127">127</a> <a class="reference internal" href="#target-170">170</a> <a class="reference internal" href="#target-171">171</a></td>
</tr>
<tr class="field"><th class="field-name">tangle:</th><td class="field-body"><a class="reference internal" href="#target-46">46</a> <a class="reference internal" href="#target-63">63</a> <a class="reference internal" href="#target-69">69</a> <a class="reference internal" href="#target-71">71</a> <a class="reference internal" href="#target-74">74</a> <a class="reference internal" href="#target-75">75</a> <a class="reference internal" href="#target-77">77</a> <a class="reference internal" href="#target-81">81</a> <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-83">83</a> <a class="reference internal" href="#target-84">84</a> <a class="reference internal" href="#target-92">92</a> [<a class="reference internal" href="#target-114">114</a>] <a class="reference internal" href="#target-152">152</a> <a class="reference internal" href="#target-165">165</a> <a class="reference internal" href="#target-172">172</a> <a class="reference internal" href="#target-180">180</a></td>
</tr>
<tr class="field"><th class="field-name">tempfile:</th><td class="field-body">[<a class="reference internal" href="#target-48">48</a>] <a class="reference internal" href="#target-50">50</a></td>
</tr>
<tr class="field"><th class="field-name">time:</th><td class="field-body"><a class="reference internal" href="#target-127">127</a> <a class="reference internal" href="#target-142">142</a> <a class="reference internal" href="#target-143">143</a> [<a class="reference internal" href="#target-158">158</a>]</td>
</tr>
<tr class="field"><th class="field-name">types:</th><td class="field-body"><a class="reference internal" href="#target-13">13</a> <a class="reference internal" href="#target-127">127</a> [<a class="reference internal" href="#target-158">158</a>]</td>
</tr>
<tr class="field"><th class="field-name">usedBy:</th><td class="field-body">[<a class="reference internal" href="#target-90">90</a>]</td>
</tr>
<tr class="field"><th class="field-name">userNamesXref:</th><td class="field-body"><a class="reference internal" href="#target-87">87</a> [<a class="reference internal" href="#target-110">110</a>]</td>
</tr>
<tr class="field"><th class="field-name">weakref:</th><td class="field-body"><a class="reference internal" href="#target-53">53</a> [<a class="reference internal" href="#target-98">98</a>] <a class="reference internal" href="#target-101">101</a> <a class="reference internal" href="#target-102">102</a> <a class="reference internal" href="#target-103">103</a></td>
</tr>
<tr class="field"><th class="field-name">weave:</th><td class="field-body"><a class="reference internal" href="#target-62">62</a> <a class="reference internal" href="#target-68">68</a> <a class="reference internal" href="#target-73">73</a> <a class="reference internal" href="#target-76">76</a> <a class="reference internal" href="#target-81">81</a> <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-83">83</a> <a class="reference internal" href="#target-85">85</a> <a class="reference internal" href="#target-86">86</a> <a class="reference internal" href="#target-87">87</a> <a class="reference internal" href="#target-91">91</a> [<a class="reference internal" href="#target-115">115</a>] <a class="reference internal" href="#target-149">149</a> <a class="reference internal" href="#target-165">165</a> <a class="reference internal" href="#target-174">174</a> <a class="reference internal" href="#target-180">180</a></td>
</tr>
<tr class="field"><th class="field-name">weaveChunk:</th><td class="field-body"><a class="reference internal" href="#target-91">91</a> [<a class="reference internal" href="#target-115">115</a>]</td>
</tr>
<tr class="field"><th class="field-name" colspan="2">weaveReferenceTo:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body"><a class="reference internal" href="#target-62">62</a> <a class="reference internal" href="#target-68">68</a> [<a class="reference internal" href="#target-76">76</a>] <a class="reference internal" href="#target-115">115</a></td>
</tr>
<tr class="field"><th class="field-name" colspan="2">weaveShortReferenceTo:</th></tr>
<tr class="field"><td>&nbsp;</td><td class="field-body"><a class="reference internal" href="#target-62">62</a> <a class="reference internal" href="#target-68">68</a> [<a class="reference internal" href="#target-76">76</a>] <a class="reference internal" href="#target-115">115</a></td>
</tr>
<tr class="field"><th class="field-name">webAdd:</th><td class="field-body"><a class="reference internal" href="#target-56">56</a> <a class="reference internal" href="#target-67">67</a> [<a class="reference internal" href="#target-72">72</a>] <a class="reference internal" href="#target-119">119</a> <a class="reference internal" href="#target-120">120</a> <a class="reference internal" href="#target-121">121</a> <a class="reference internal" href="#target-122">122</a> <a class="reference internal" href="#target-132">132</a></td>
</tr>
<tr class="field"><th class="field-name">write:</th><td class="field-body">[<a class="reference internal" href="#target-5">5</a>] <a class="reference internal" href="#target-8">8</a> <a class="reference internal" href="#target-10">10</a> <a class="reference internal" href="#target-18">18</a> <a class="reference internal" href="#target-19">19</a> <a class="reference internal" href="#target-21">21</a> <a class="reference internal" href="#target-22">22</a> <a class="reference internal" href="#target-46">46</a> <a class="reference internal" href="#target-82">82</a> <a class="reference internal" href="#target-115">115</a></td>
</tr>
<tr class="field"><th class="field-name">xrefDefLine:</th><td class="field-body"><a class="reference internal" href="#target-22">22</a> [<a class="reference internal" href="#target-42">42</a>] <a class="reference internal" href="#target-87">87</a></td>
</tr>
<tr class="field"><th class="field-name">xrefFoot:</th><td class="field-body"><a class="reference internal" href="#target-21">21</a> [<a class="reference internal" href="#target-41">41</a>] <a class="reference internal" href="#target-84">84</a> <a class="reference internal" href="#target-87">87</a></td>
</tr>
<tr class="field"><th class="field-name">xrefHead:</th><td class="field-body"><a class="reference internal" href="#target-21">21</a> [<a class="reference internal" href="#target-41">41</a>] <a class="reference internal" href="#target-84">84</a> <a class="reference internal" href="#target-87">87</a></td>
</tr>
<tr class="field"><th class="field-name">xrefLine:</th><td class="field-body"><a class="reference internal" href="#target-21">21</a> [<a class="reference internal" href="#target-41">41</a>] <a class="reference internal" href="#target-84">84</a></td>
</tr>
</tbody>
</table>
<hr class="docutils" />
<blockquote class="small">
Created by /Users/slott/Documents/Projects/PyWebTool-3/pyweb/pyweb.py at Fri Jun 10 13:42:20 2022.</blockquote>
<p class="small">Source pyweb.w modified Fri Jun 10 10:48:04 2022.</p>
<blockquote class="small">
<p>pyweb.__version__ '3.0'.</p>
<p>Working directory '/Users/slott/Documents/Projects/py-web-tool'.</p>
</blockquote>
</div>
</div>
</div>
</body>
</html>
